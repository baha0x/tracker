<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Masturbation Tracker</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Manrope:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        :root[data-theme="dark"] {
            --bg-primary: #0a0a0a;
            --bg-secondary: #141414;
            --bg-tertiary: #1a1a1a;
            --text-primary: #ffffff;
            --text-secondary: #a0a0a0;
            --text-tertiary: #606060;
            --accent: #ff6b9d;
            --accent-dim: #ff4d8d;
            --danger: #ff4444;
            --warning: #ffaa00;
            --success: #4ade80;
            --border: #2a2a2a;
            --shadow: rgba(0, 0, 0, 0.5);
            --chart-1: #ff6b9d;
            --chart-2: #6b8dff;
            --chart-3: #6bffb8;
            --chart-4: #ffaa00;
        }
        :root[data-theme="light"] {
            --bg-primary: #ffffff;
            --bg-secondary: #f5f5f5;
            --bg-tertiary: #ebebeb;
            --text-primary: #0a0a0a;
            --text-secondary: #606060;
            --text-tertiary: #a0a0a0;
            --accent: #ff4d8d;
            --accent-dim: #ff1a75;
            --danger: #dd3333;
            --warning: #e69500;
            --success: #22c55e;
            --border: #e0e0e0;
            --shadow: rgba(0, 0, 0, 0.1);
            --chart-1: #ff4d8d;
            --chart-2: #4d6bff;
            --chart-3: #4dffa6;
            --chart-4: #ff9500;
        }
        body {
            font-family: 'Manrope', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
            transition: background 0.3s ease, color 0.3s ease;
        }
        .app-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 30px 0;
            border-bottom: 1px solid var(--border);
            margin-bottom: 40px;
            flex-wrap: wrap;
            gap: 15px;
        }
        .logo {
            font-family: 'JetBrains Mono', monospace;
            font-size: 24px;
            font-weight: 700;
            letter-spacing: -0.02em;
            background: linear-gradient(135deg, var(--accent) 0%, #ff8e6b 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientShift 3s ease infinite;
        }
        @keyframes gradientShift {
            0%, 100% { filter: hue-rotate(0deg); }
            50% { filter: hue-rotate(10deg); }
        }
        .header-right {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        .theme-toggle {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            color: var(--text-primary);
            padding: 10px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.2s ease;
        }
        .theme-toggle:hover {
            background: var(--accent);
            border-color: var(--accent);
            transform: scale(1.05);
        }
        .nav {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .nav-btn {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-secondary);
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Manrope', sans-serif;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        .nav-btn:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border-color: var(--accent);
            transform: translateY(-2px);
        }
        .nav-btn.active {
            background: var(--accent);
            color: var(--bg-primary);
            border-color: var(--accent);
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(255, 107, 157, 0.3);
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        .stat-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 24px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        .stat-card:hover {
            transform: translateY(-4px);
            border-color: var(--accent);
            box-shadow: 0 10px 40px var(--shadow);
        }
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--accent), #ff8e6b);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .stat-card:hover::before {
            opacity: 1;
        }
        .stat-label {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-tertiary);
            margin-bottom: 8px;
            font-weight: 600;
        }
        .stat-value {
            font-size: 36px;
            font-weight: 800;
            font-family: 'JetBrains Mono', monospace;
            color: var(--accent);
            line-height: 1;
            margin-bottom: 8px;
        }
        .stat-sublabel {
            font-size: 14px;
            color: var(--text-secondary);
        }
        .section-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 20px;
            color: var(--text-primary);
        }
        .action-btn {
            background: var(--accent);
            color: var(--bg-primary);
            border: none;
            padding: 14px 28px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: 'Manrope', sans-serif;
        }
        .action-btn:hover {
            background: var(--accent-dim);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 107, 157, 0.3);
        }
        .action-btn:active {
            transform: translateY(0);
        }
        .delete-btn {
            background: var(--danger);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: 'Manrope', sans-serif;
        }
        .delete-btn:hover {
            background: #cc0000;
            transform: translateY(-2px);
        }
        .entry-form {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 40px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }
        .form-input, .form-select, .form-textarea {
            width: 100%;
            background: var(--bg-primary);
            border: 1px solid var(--border);
            color: var(--text-primary);
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 14px;
            font-family: 'Manrope', sans-serif;
            transition: all 0.2s ease;
        }
        .form-textarea {
            min-height: 80px;
            resize: vertical;
        }
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(255, 107, 157, 0.1);
        }
        .tags-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }
        .tag-btn {
            background: var(--bg-primary);
            border: 2px solid var(--border);
            color: var(--text-secondary);
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.2s ease;
            font-family: 'Manrope', sans-serif;
        }
        .tag-btn:hover {
            border-color: var(--accent);
            color: var(--accent);
            transform: scale(1.05);
        }
        .tag-btn.active {
            background: var(--accent);
            border-color: var(--accent);
            color: var(--bg-primary);
            transform: scale(1.05);
        }
        .filter-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }
        .filter-tag {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            color: var(--text-secondary);
            padding: 6px 12px;
            border-radius: 16px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s ease;
        }
        .filter-tag:hover {
            border-color: var(--accent);
            color: var(--accent);
        }
        .filter-tag.active {
            background: var(--accent);
            border-color: var(--accent);
            color: var(--bg-primary);
        }
        .chart-container {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
        }
        .history-item {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        .history-item:hover {
            border-color: var(--accent);
            transform: translateX(4px);
            box-shadow: 0 4px 12px var(--shadow);
        }
        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .history-date {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
        }
        .history-time {
            font-size: 14px;
            color: var(--text-tertiary);
            font-family: 'JetBrains Mono', monospace;
        }
        .history-details {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        .history-badge {
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }
        .history-field {
            font-size: 13px;
            color: var(--text-secondary);
            margin-top: 4px;
        }
        .nofap-container {
            background: linear-gradient(135deg, #1a1a2e 0%, #2e1a1a 100%);
            border: 2px solid var(--accent);
            border-radius: 24px;
            padding: 40px;
            margin-bottom: 40px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        [data-theme="light"] .nofap-container {
            background: linear-gradient(135deg, #f5e8e8 0%, #e6c8c8 100%);
        }
        .nofap-container::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 107, 157, 0.1) 0%, transparent 70%);
            animation: pulse 3s ease-in-out infinite;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }
        .nofap-day-count {
            font-size: 80px;
            font-weight: 900;
            font-family: 'JetBrains Mono', monospace;
            color: var(--accent);
            line-height: 1;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
            animation: bounceIn 0.5s ease;
        }
        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); opacity: 1; }
        }
        .nofap-label {
            font-size: 18px;
            color: var(--text-secondary);
            margin-bottom: 30px;
            position: relative;
            z-index: 1;
        }
        .nofap-milestone {
            background: rgba(255, 107, 157, 0.1);
            border: 1px solid var(--accent);
            border-radius: 12px;
            padding: 15px;
            margin: 20px 0;
            position: relative;
            z-index: 1;
        }
        .nofap-milestone-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--accent);
            margin-bottom: 8px;
        }
        .nofap-milestone-desc {
            font-size: 14px;
            color: var(--text-secondary);
        }
        .nofap-record {
            font-size: 16px;
            color: var(--text-tertiary);
            margin-bottom: 20px;
            position: relative;
            z-index: 1;
        }
        .nofap-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            position: relative;
            z-index: 1;
        }
        .nofap-reset-btn {
            background: var(--danger);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .nofap-reset-btn:hover {
            background: #cc0000;
            transform: scale(1.05);
        }
        .nofap-history {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 20px;
            margin-top: 30px;
        }
        .nofap-attempt {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid var(--border);
        }
        .nofap-attempt:last-child {
            border-bottom: none;
        }
        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .analytics-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 24px;
            transition: all 0.3s ease;
        }
        .analytics-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px var(--shadow);
        }
        .analytics-card h3 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--text-primary);
        }
        .bar-chart {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .bar-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .bar-label {
            min-width: 80px;
            font-size: 13px;
            color: var(--text-secondary);
        }
        .bar-visual {
            flex: 1;
            height: 24px;
            background: var(--bg-tertiary);
            border-radius: 4px;
            position: relative;
            overflow: hidden;
        }
        .bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), #ff8e6b);
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        .bar-value {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
            min-width: 30px;
        }
        .comparison-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
        }
        .comparison-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--border);
        }
        .comparison-item:last-child {
            border-bottom: none;
        }
        .comparison-label {
            font-size: 14px;
            color: var(--text-secondary);
        }
        .comparison-value {
            font-size: 18px;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
        }
        .comparison-value.positive {
            color: var(--success);
        }
        .comparison-value.negative {
            color: var(--danger);
        }
        .fade-in {
            animation: fadeIn 0.5s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .insights-card {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
        }
        .insight-item {
            display: flex;
            align-items: start;
            gap: 15px;
            padding: 15px 0;
            border-bottom: 1px solid var(--border);
        }
        .insight-item:last-child {
            border-bottom: none;
        }
        .insight-icon {
            font-size: 24px;
        }
        .insight-text {
            flex: 1;
        }
        .insight-title {
            font-size: 15px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }
        .insight-desc {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.5;
        }
        .calendar-container {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
        }
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        .calendar-month {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
        }
        .calendar-nav-btn {
            background: var(--bg-primary);
            border: 1px solid var(--border);
            color: var(--text-secondary);
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        .calendar-nav-btn:hover {
            background: var(--accent);
            color: var(--bg-primary);
            border-color: var(--accent);
        }
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            margin-top: 15px;
        }
        .calendar-day-label {
            text-align: center;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-tertiary);
            padding: 8px 0;
        }
        .calendar-day {
            aspect-ratio: 1;
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }
        .calendar-day:hover {
            border-color: var(--accent);
            transform: scale(1.05);
        }
        .calendar-day.empty {
            background: transparent;
            border: none;
            cursor: default;
        }
        .calendar-day.empty:hover {
            transform: none;
        }
        .calendar-day.today {
            border: 2px solid var(--accent);
            font-weight: 700;
        }
        .calendar-day.low {
            background: rgba(255, 107, 157, 0.1);
        }
        .calendar-day.medium {
            background: rgba(255, 107, 157, 0.3);
        }
        .calendar-day.high {
            background: rgba(255, 107, 157, 0.5);
        }
        .calendar-day-number {
            font-size: 14px;
            font-weight: 500;
            color: var(--text-primary);
        }
        .calendar-day-count {
            position: absolute;
            top: 4px;
            right: 4px;
            background: var(--accent);
            color: var(--bg-primary);
            font-size: 10px;
            font-weight: 700;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .heatmap-container {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
            overflow-x: auto;
        }
        .heatmap-grid {
            display: grid;
            grid-template-columns: auto repeat(53, 12px);
            gap: 3px;
            min-width: 700px;
        }
        .heatmap-month-label {
            font-size: 10px;
            color: var(--text-tertiary);
            padding: 2px 0;
        }
        .heatmap-cell {
            width: 12px;
            height: 12px;
            background: var(--bg-tertiary);
            border-radius: 2px;
            transition: all 0.2s ease;
        }
        .heatmap-cell:hover {
            transform: scale(1.3);
            border: 1px solid var(--accent);
        }
        .heatmap-cell.level-1 {
            background: rgba(255, 107, 157, 0.2);
        }
        .heatmap-cell.level-2 {
            background: rgba(255, 107, 157, 0.4);
        }
        .heatmap-cell.level-3 {
            background: rgba(255, 107, 157, 0.6);
        }
        .heatmap-cell.level-4 {
            background: rgba(255, 107, 157, 0.9);
        }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 999;
            backdrop-filter: blur(4px);
            animation: fadeIn 0.2s ease;
        }
        .day-detail-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 30px;
            z-index: 1000;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px var(--shadow);
            animation: scaleIn 0.3s ease;
        }
        @keyframes scaleIn {
            from { transform: translate(-50%, -50%) scale(0.9); opacity: 0; }
            to { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .modal-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
        }
        .modal-close {
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-size: 32px;
            cursor: pointer;
            line-height: 1;
            transition: color 0.2s ease;
        }
        .modal-close:hover {
            color: var(--danger);
        }
        .modal-entry {
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 12px;
        }
        .modal-entry-time {
            font-size: 13px;
            color: var(--text-tertiary);
            margin-bottom: 8px;
            font-family: 'JetBrains Mono', monospace;
        }
        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            font-size: 14px;
            color: var(--text-secondary);
        }
        .checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        .slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: var(--bg-tertiary);
            outline: none;
            -webkit-appearance: none;
        }
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--accent);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 0 0 8px rgba(255, 107, 157, 0.2);
        }
        .slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--accent);
            cursor: pointer;
            border: none;
        }
        .slider-value {
            text-align: center;
            margin-top: 5px;
            font-size: 14px;
            color: var(--text-secondary);
        }
        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
        }
        .achievement-card {
            background: var(--bg-secondary);
            border: 2px solid var(--border);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
        }
        .achievement-card.unlocked {
            border-color: var(--accent);
            box-shadow: 0 0 20px rgba(255, 107, 157, 0.2);
            animation: achievementUnlock 0.5s ease;
        }
        @keyframes achievementUnlock {
            0% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
        }
        .achievement-card.locked {
            opacity: 0.5;
            filter: grayscale(1);
        }
        .achievement-icon {
            font-size: 48px;
            margin-bottom: 12px;
        }
        .achievement-title {
            font-size: 15px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 6px;
        }
        .achievement-desc {
            font-size: 12px;
            color: var(--text-secondary);
            line-height: 1.4;
        }
        .achievement-progress {
            margin-top: 12px;
            height: 6px;
            background: var(--bg-tertiary);
            border-radius: 3px;
            overflow: hidden;
        }
        .achievement-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), #ff8e6b);
            border-radius: 3px;
            transition: width 0.5s ease;
        }
        .edit-btn {
            background: var(--chart-2);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-left: 10px;
        }
        .edit-btn:hover {
            background: #4a5fff;
            transform: translateY(-2px);
        }
        .goal-progress {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 10px;
        }
        .progress-circle {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: conic-gradient(var(--accent) 0% 0%, var(--bg-tertiary) 0% 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        .progress-circle::before {
            content: '';
            position: absolute;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: var(--bg-secondary);
        }
        .progress-text {
            position: relative;
            z-index: 1;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 700;
            color: var(--text-primary);
            font-size: 16px;
        }
        .goal-label {
            font-size: 14px;
            color: var(--text-secondary);
        }
        .quick-stats {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        .quick-stat {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 15px;
            flex: 1;
            min-width: 150px;
            transition: all 0.3s ease;
        }
        .quick-stat:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--shadow);
        }
        .quick-stat-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--accent);
            font-family: 'JetBrains Mono', monospace;
        }
        .quick-stat-label {
            font-size: 12px;
            color: var(--text-tertiary);
            margin-top: 5px;
        }
        .motivation-quote {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            font-style: italic;
            color: var(--text-secondary);
            border-left: 4px solid var(--accent);
        }
        .trigger-heatmap {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
        }
        .trigger-heatmap-grid {
            display: grid;
            grid-template-columns: auto repeat(7, 1fr);
            gap: 5px;
            margin-top: 15px;
        }
        .trigger-heatmap-label {
            font-size: 11px;
            color: var(--text-tertiary);
            padding: 8px 5px;
            text-align: center;
        }
        .trigger-heatmap-cell {
            height: 30px;
            background: var(--bg-tertiary);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            color: var(--text-primary);
            transition: all 0.2s ease;
        }
        .trigger-heatmap-cell:hover {
            transform: scale(1.1);
        }
        .prediction-card {
            background: linear-gradient(135deg, rgba(107, 141, 255, 0.1) 0%, rgba(107, 255, 184, 0.1) 100%);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
        }
        .prediction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--border);
        }
        .prediction-item:last-child {
            border-bottom: none;
        }
        .energy-tracker {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
        }
        .energy-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }
        .energy-btn {
            background: var(--bg-primary);
            border: 2px solid var(--border);
            padding: 12px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
        }
        .energy-btn:hover {
            border-color: var(--accent);
            transform: scale(1.05);
        }
        .energy-btn.active {
            background: var(--accent);
            border-color: var(--accent);
            color: var(--bg-primary);
        }
        .success-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--success);
            color: white;
            padding: 16px 24px;
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
            z-index: 1001;
            animation: slideInRight 0.3s ease;
        }
        @keyframes slideInRight {
            from { transform: translateX(400px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @media (max-width: 768px) {
            .app-container {
                padding: 15px;
            }
            .header {
                flex-direction: column;
                align-items: flex-start;
            }
            .stats-grid {
                grid-template-columns: 1fr;
            }
            .nofap-day-count {
                font-size: 60px;
            }
            .analytics-grid {
                grid-template-columns: 1fr;
            }
            .logo {
                font-size: 20px;
            }
        }

        @media (max-width: 600px) {
            .nav {
                flex-wrap: nowrap;
                overflow-x: auto;
                padding-bottom: 6px;
            }
            .nav-btn { white-space: nowrap; }
            .entry-form { padding: 20px; }
            .calendar-grid { gap: 4px; }
            .calendar-day { font-size: 12px; }
        }
    
        @media (max-width: 480px) {
            .header { padding: 18px 0; margin-bottom: 20px; }
            .header-right { width: 100%; justify-content: space-between; }
            .nav { flex-wrap: nowrap; overflow-x: auto; -webkit-overflow-scrolling: touch; padding-bottom: 6px; }
            .nav-btn { white-space: nowrap; padding: 10px 14px; font-size: 13px; }
            .stats-grid { gap: 12px; margin-bottom: 22px; }
            .stat-card { padding: 18px; border-radius: 14px; }
            .stat-value { font-size: 28px; }
            .quick-stats { gap: 10px; }
            .quick-stat { min-width: 0; padding: 12px; }
            .quick-stat-value { font-size: 20px; }
            .entry-form { padding: 18px; border-radius: 14px; }
            .action-btn { width: 100%; }
            .nofap-container { padding: 22px; border-radius: 18px; }
            .nofap-day-count { font-size: 56px; }
            .day-detail-modal {
                width: 95%;
                max-height: 88vh;
                padding: 18px;
                border-radius: 16px;
            }
            .calendar-container { padding: 18px; }
            .calendar-grid { gap: 4px; }
            .calendar-day { border-radius: 8px; }
            .calendar-day-number { font-size: 12px; }
        }

</style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        function pad2(n) {
            return String(n).padStart(2, '0');
        }
        // YYYY-MM-DD in local time (no UTC drift)
        function formatLocalDate(d = new Date()) {
            return `${d.getFullYear()}-${pad2(d.getMonth() + 1)}-${pad2(d.getDate())}`;
        }
        // Parse YYYY-MM-DD as local date
        function parseLocalDate(dateStr) {
            return new Date(`${dateStr}T00:00:00`);
        }

        async function normalizeLegacyEntryDates(entries) {
            // One-time migration: fix legacy dates saved via UTC ISO (day shift) using timestamp.
            const MIGRATION_KEY = 'dateMigration_v1_done';
            if (localStorage.getItem(MIGRATION_KEY) === 'true') return entries;

            let changed = 0;
            for (const e of entries) {
                if (!e || !e.timestamp || !e.date) continue;
                const corrected = formatLocalDate(new Date(e.timestamp));
                if (e.date !== corrected) {
                    e.date = corrected;
                    try {
                        await updateEntry(e);
                        changed++;
                    } catch (err) {
                        // ignore per-entry failures; keep going
                    }
                }
            }
            localStorage.setItem(MIGRATION_KEY, 'true');
            if (changed > 0) {
                try { showSuccessNotification(`ðŸ› ï¸ Ð˜ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¾ Ð´Ð°Ñ‚: ${changed}`); } catch {}
            }
            return entries;
        }

        const DB_NAME = 'MasturbationTrackerDB';
        const DB_VERSION = 3;
        const STORE_NAME = 'entries';
        const PREDEFINED_TRIGGERS = [
            'ðŸ’¤ Ð¡Ñ‚Ñ€ÐµÑÑ',
            'ðŸ˜´ Ð¡ÐºÑƒÐºÐ°',
            'ðŸ˜” ÐžÐ´Ð¸Ð½Ð¾Ñ‡ÐµÑÑ‚Ð²Ð¾',
            'ðŸº ÐÐ»ÐºÐ¾Ð³Ð¾Ð»ÑŒ',
            'ðŸ“± Ð¡Ð¾Ñ†ÑÐµÑ‚Ð¸',
            'ðŸŒ™ ÐŸÐ¾Ð·Ð´Ð½Ð¾ Ð½Ð¾Ñ‡ÑŒÑŽ',
            'ðŸ’ª ÐŸÐ¾ÑÐ»Ðµ Ñ‚Ñ€ÐµÐ½Ð¸Ñ€Ð¾Ð²ÐºÐ¸',
            'ðŸŽ® ÐŸÐ¾ÑÐ»Ðµ Ð¸Ð³Ñ€',
            'ðŸ“º ÐŸÑ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ ÐºÐ¾Ð½Ñ‚ÐµÐ½Ñ‚Ð°',
            'ðŸ›Œ ÐŸÐµÑ€ÐµÐ´ ÑÐ½Ð¾Ð¼',
            'ðŸŒ… Ð£Ñ‚Ñ€Ð¾Ð¼',
            'ðŸ˜° Ð¢Ñ€ÐµÐ²Ð¾Ð³Ð°',
            'ðŸŽµ ÐŸÐ¾Ð´ Ð¼ÑƒÐ·Ñ‹ÐºÑƒ',
            'ðŸ  Ð”Ð¾Ð¼Ð° Ð¾Ð´Ð¸Ð½',
            'ðŸ’¼ ÐŸÐ¾ÑÐ»Ðµ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹',
            'ðŸŽ‰ Ð’Ñ‹Ñ…Ð¾Ð´Ð½Ñ‹Ðµ',
            'ðŸ˜¤ Ð Ð°Ð·Ð´Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ',
            'ðŸŒƒ Ð‘ÐµÑÑÐ¾Ð½Ð½Ð¸Ñ†Ð°'
        ];
        const PREDEFINED_MOODS = [
            'ðŸ˜Š Ð Ð°ÑÑÐ»Ð°Ð±Ð»ÐµÐ½Ð½Ñ‹Ð¹',
            'ðŸ˜¢ Ð“Ñ€ÑƒÑÑ‚Ð½Ñ‹Ð¹',
            'ðŸ˜  Ð Ð°Ð·Ð´Ñ€Ð°Ð¶ÐµÐ½Ð½Ñ‹Ð¹',
            'ðŸ˜´ Ð£ÑÑ‚Ð°Ð»Ñ‹Ð¹',
            'ðŸ˜Ž Ð’Ð¾Ð·Ð±ÑƒÐ¶Ð´ÐµÐ½Ð½Ñ‹Ð¹',
            'ðŸ˜Œ Ð£Ð´Ð¾Ð²Ð»ÐµÑ‚Ð²Ð¾Ñ€ÐµÐ½Ð½Ñ‹Ð¹',
            'ðŸ˜³ Ð’Ð¸Ð½Ð¾Ð²Ð½Ñ‹Ð¹',
            'ðŸ˜„ Ð Ð°Ð´Ð¾ÑÑ‚Ð½Ñ‹Ð¹',
            'ðŸ˜ ÐÐµÐ¹Ñ‚Ñ€Ð°Ð»ÑŒÐ½Ñ‹Ð¹',
            'ðŸ˜” Ð Ð°Ð·Ð¾Ñ‡Ð°Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ð¹',
            'ðŸ’ª Ð­Ð½ÐµÑ€Ð³Ð¸Ñ‡Ð½Ñ‹Ð¹',
            'ðŸ˜° Ð¢Ñ€ÐµÐ²Ð¾Ð¶Ð½Ñ‹Ð¹'
        ];
        const ACHIEVEMENTS = [
            { id: 'first_entry', icon: 'ðŸŒŸ', title: 'ÐÐ°Ñ‡Ð°Ð»Ð¾ Ð¿ÑƒÑ‚Ð¸', desc: 'ÐŸÐµÑ€Ð²Ð°Ñ Ð·Ð°Ð¿Ð¸ÑÑŒ Ð² Ñ‚Ñ€ÐµÐºÐµÑ€Ðµ' },
            { id: 'week_streak', icon: 'ðŸ”¥', title: 'ÐÐµÐ´ÐµÐ»Ñ ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»Ñ', desc: '7 Ð´Ð½ÐµÐ¹ Ð±ÐµÐ· Ð¼Ð°ÑÑ‚ÑƒÑ€Ð±Ð°Ñ†Ð¸Ð¸' },
            { id: 'month_control', icon: 'ðŸ’Ž', title: 'ÐœÐµÑÑÑ† Ð´Ð¸ÑÑ†Ð¸Ð¿Ð»Ð¸Ð½Ñ‹', desc: 'ÐœÐµÐ½ÑŒÑˆÐµ Ð»Ð¸Ð¼Ð¸Ñ‚Ð° Ð²ÐµÑÑŒ Ð¼ÐµÑÑÑ†' },
            { id: 'two_week_streak', icon: 'âš¡', title: 'Ð”Ð²Ðµ Ð½ÐµÐ´ÐµÐ»Ð¸ ÑÐ¸Ð»Ñ‹', desc: '14 Ð´Ð½ÐµÐ¹ Ð±ÐµÐ· Ð¼Ð°ÑÑ‚ÑƒÑ€Ð±Ð°Ñ†Ð¸Ð¸' },
            { id: 'month_streak', icon: 'ðŸ†', title: 'ÐœÐµÑÑÑ† ÑÐ¸Ð»Ñ‹', desc: '30 Ð´Ð½ÐµÐ¹ Ð±ÐµÐ· Ð¼Ð°ÑÑ‚ÑƒÑ€Ð±Ð°Ñ†Ð¸Ð¸' },
            { id: 'total_100', icon: 'ðŸ“Š', title: 'Ð’ÐµÑ‚ÐµÑ€Ð°Ð½ Ñ‚Ñ€ÐµÐºÐµÑ€Ð°', desc: '100+ Ð·Ð°Ð¿Ð¸ÑÐµÐ¹ Ð² Ð¸ÑÑ‚Ð¾Ñ€Ð¸Ð¸' },
            { id: 'low_frequency', icon: 'ðŸŽ¯', title: 'ÐšÐ¾Ð½Ñ‚Ñ€Ð¾Ð»ÑŒ Ñ‡Ð°ÑÑ‚Ð¾Ñ‚Ñ‹', desc: 'ÐÐµÐ´ÐµÐ»Ñ Ñ 0-1 Ð·Ð°Ð¿Ð¸ÑÑŒÑŽ' },
            { id: 'no_content_week', icon: 'ðŸ§ ', title: 'Ð¡Ð¸Ð»Ð° Ð²Ð¾Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ', desc: 'ÐÐµÐ´ÐµÐ»Ñ Ð±ÐµÐ· ÐºÐ¾Ð½Ñ‚ÐµÐ½Ñ‚Ð°' },
            { id: 'three_month_streak', icon: 'ðŸ’«', title: 'ÐšÐ²Ð°Ñ€Ñ‚Ð°Ð» Ñ‡ÐµÐ¼Ð¿Ð¸Ð¾Ð½Ð°', desc: '90 Ð´Ð½ÐµÐ¹ Ð±ÐµÐ· Ð¼Ð°ÑÑ‚ÑƒÑ€Ð±Ð°Ñ†Ð¸Ð¸' },
            { id: 'consistent_tracker', icon: 'ðŸ“', title: 'Ð”Ð¸ÑÑ†Ð¸Ð¿Ð»Ð¸Ð½Ð° Ð·Ð°Ð¿Ð¸ÑÐµÐ¹', desc: '30 Ð´Ð½ÐµÐ¹ Ð¿Ð¾Ð´Ñ€ÑÐ´ Ð²ÐµÐ´ÐµÐ½Ð¸Ñ Ñ‚Ñ€ÐµÐºÐµÑ€Ð°' },
            { id: 'early_bird', icon: 'ðŸŒ…', title: 'Ð£Ñ‚Ñ€ÐµÐ½Ð½Ð¸Ð¹ ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»ÑŒ', desc: 'ÐÐµÐ´ÐµÐ»Ñ Ð±ÐµÐ· ÑƒÑ‚Ñ€ÐµÐ½Ð½Ð¸Ñ… ÑÐµÑÑÐ¸Ð¹' },
            { id: 'night_owl', icon: 'ðŸŒ™', title: 'ÐÐ¾Ñ‡Ð½Ð¾Ð¹ ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»ÑŒ', desc: 'ÐÐµÐ´ÐµÐ»Ñ Ð±ÐµÐ· Ð½Ð¾Ñ‡Ð½Ñ‹Ñ… ÑÐµÑÑÐ¸Ð¹' },
        ];
        const MOTIVATION_QUOTES = [
            "ÐšÐ¾Ð½Ñ‚Ñ€Ð¾Ð»ÑŒ Ð½Ð°Ð´ ÑÐ¾Ð±Ð¾Ð¹ â€” Ð²Ñ‹ÑÑˆÐ°Ñ Ñ„Ð¾Ñ€Ð¼Ð° ÑÐ¸Ð»Ñ‹.",
            "ÐšÐ°Ð¶Ð´Ñ‹Ð¹ Ð´ÐµÐ½ÑŒ Ð±ÐµÐ· â€” ÑˆÐ°Ð³ Ðº Ð»ÑƒÑ‡ÑˆÐµÐ¹ Ð²ÐµÑ€ÑÐ¸Ð¸ ÑÐµÐ±Ñ.",
            "Ð¡Ð¸Ð»Ð° Ð²Ð¾Ð»Ð¸ ÐºÐ°Ðº Ð¼Ñ‹ÑˆÑ†Ð°: Ñ‡ÐµÐ¼ Ð±Ð¾Ð»ÑŒÑˆÐµ Ñ‚Ñ€ÐµÐ½Ð¸Ñ€ÑƒÐµÑˆÑŒ, Ñ‚ÐµÐ¼ ÑÐ¸Ð»ÑŒÐ½ÐµÐµ ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑÑ.",
            "Ð¢Ð²Ð¾Ñ ÑÐ½ÐµÑ€Ð³Ð¸Ñ â€” Ñ‚Ð²Ð¾Ð¹ ÑÐ°Ð¼Ñ‹Ð¹ Ñ†ÐµÐ½Ð½Ñ‹Ð¹ Ñ€ÐµÑÑƒÑ€Ñ.",
            "ÐœÐ°Ð»ÐµÐ½ÑŒÐºÐ¸Ðµ Ð¿Ð¾Ð±ÐµÐ´Ñ‹ ÐºÐ°Ð¶Ð´Ñ‹Ð¹ Ð´ÐµÐ½ÑŒ Ð¿Ñ€Ð¸Ð²Ð¾Ð´ÑÑ‚ Ðº Ð±Ð¾Ð»ÑŒÑˆÐ¸Ð¼ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸ÑÐ¼.",
            "Ð¡Ð°Ð¼Ð¾ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»ÑŒ â€” ÑÑ‚Ð¾ ÑÐ²Ð¾Ð±Ð¾Ð´Ð° Ð¾Ñ‚ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹.",
            "ÐšÐ°Ð¶Ð´Ñ‹Ð¹ Ñ€Ð°Ð·, ÐºÐ¾Ð³Ð´Ð° Ð³Ð¾Ð²Ð¾Ñ€Ð¸ÑˆÑŒ 'Ð½ÐµÑ‚' Ð¸Ð¼Ð¿ÑƒÐ»ÑŒÑÑƒ, ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸ÑˆÑŒÑÑ ÑÐ¸Ð»ÑŒÐ½ÐµÐµ.",
            "Ð”Ð¸ÑÑ†Ð¸Ð¿Ð»Ð¸Ð½Ð° â€” ÑÑ‚Ð¾ Ð²Ñ‹Ð±Ð¾Ñ€ Ð¼ÐµÐ¶Ð´Ñƒ Ñ‚ÐµÐ¼, Ñ‡Ñ‚Ð¾ Ñ…Ð¾Ñ‡ÐµÑˆÑŒ ÑÐµÐ¹Ñ‡Ð°Ñ, Ð¸ Ñ‚ÐµÐ¼, Ñ‡Ñ‚Ð¾ Ñ…Ð¾Ñ‡ÐµÑˆÑŒ Ð±Ð¾Ð»ÑŒÑˆÐµ Ð²ÑÐµÐ³Ð¾.",
            "Ð¡ÐµÐ³Ð¾Ð´Ð½ÑÑˆÐ½ÑÑ Ð±Ð¾Ð»ÑŒ â€” Ð·Ð°Ð²Ñ‚Ñ€Ð°ÑˆÐ½ÑÑ ÑÐ¸Ð»Ð°.",
            "Ð¢Ñ‹ ÑÐ¸Ð»ÑŒÐ½ÐµÐµ ÑÐ²Ð¾Ð¸Ñ… Ð¸Ð¼Ð¿ÑƒÐ»ÑŒÑÐ¾Ð².",
            "ÐšÐ°Ð¶Ð´Ñ‹Ð¹ Ð´ÐµÐ½ÑŒ Ð±ÐµÐ· â€” Ð¸Ð½Ð²ÐµÑÑ‚Ð¸Ñ†Ð¸Ñ Ð² ÑÐµÐ±Ñ.",
            "ÐšÐ¾Ð½Ñ‚Ñ€Ð¾Ð»ÑŒ Ð½Ð°Ñ‡Ð¸Ð½Ð°ÐµÑ‚ÑÑ Ñ Ð¾ÑÐ¾Ð·Ð½Ð°Ð½Ð½Ð¾ÑÑ‚Ð¸.",
            "Ð¢Ð²Ð¾Ð¹ Ð¿Ñ€Ð¾Ð³Ñ€ÐµÑÑ Ð²Ð´Ð¾Ñ…Ð½Ð¾Ð²Ð»ÑÐµÑ‚. ÐŸÑ€Ð¾Ð´Ð¾Ð»Ð¶Ð°Ð¹!",
            "Ð­Ð½ÐµÑ€Ð³Ð¸Ñ, ÐºÐ¾Ñ‚Ð¾Ñ€ÑƒÑŽ ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÐµÑˆÑŒ, Ð´ÐµÐ»Ð°ÐµÑ‚ Ñ‚ÐµÐ±Ñ Ð»ÑƒÑ‡ÑˆÐµ.",
            "ÐÐ°ÑÑ‚Ð¾ÑÑ‰Ð°Ñ ÑÐ¸Ð»Ð° â€” Ð² ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ð¸ ÑÐ¾Ð±Ð¾Ð¹."
        ];
        const NOFAP_MILESTONES = [
            { days: 1, title: 'ÐŸÐµÑ€Ð²Ñ‹Ð¹ Ð´ÐµÐ½ÑŒ', desc: 'ÐžÑ‚Ð»Ð¸Ñ‡Ð½Ð¾Ðµ Ð½Ð°Ñ‡Ð°Ð»Ð¾! Ð¢Ñ‹ Ð¿Ñ€Ð¸Ð½ÑÐ» Ñ€ÐµÑˆÐµÐ½Ð¸Ðµ Ð¸Ð·Ð¼ÐµÐ½Ð¸Ñ‚ÑŒÑÑ.', emoji: 'ðŸŽ¯' },
            { days: 3, title: '3 Ð´Ð½Ñ', desc: 'ÐŸÐµÑ€Ð²Ñ‹Ðµ Ð´Ð½Ð¸ ÑÐ°Ð¼Ñ‹Ðµ ÑÐ»Ð¾Ð¶Ð½Ñ‹Ðµ. Ð¢Ñ‹ ÑÐ¿Ñ€Ð°Ð²Ð»ÑÐµÑˆÑŒÑÑ!', emoji: 'ðŸ’ª' },
            { days: 7, title: 'ÐÐµÐ´ÐµÐ»Ñ', desc: 'ÐÐµÐ´ÐµÐ»Ñ Ð¿Ð¾Ð·Ð°Ð´Ð¸! Ð¢Ð²Ð¾Ñ ÑÐ¸Ð»Ð° Ð²Ð¾Ð»Ð¸ Ð²Ð¿ÐµÑ‡Ð°Ñ‚Ð»ÑÐµÑ‚.', emoji: 'ðŸ”¥' },
            { days: 14, title: '2 Ð½ÐµÐ´ÐµÐ»Ð¸', desc: 'Ð”Ð²Ðµ Ð½ÐµÐ´ÐµÐ»Ð¸! ÐŸÑ€Ð¸Ð²Ñ‹Ñ‡ÐºÐ¸ Ð½Ð°Ñ‡Ð¸Ð½Ð°ÑŽÑ‚ Ð¼ÐµÐ½ÑÑ‚ÑŒÑÑ.', emoji: 'âš¡' },
            { days: 21, title: '3 Ð½ÐµÐ´ÐµÐ»Ð¸', desc: 'ÐÐ¾Ð²Ð°Ñ Ð¿Ñ€Ð¸Ð²Ñ‹Ñ‡ÐºÐ° Ñ„Ð¾Ñ€Ð¼Ð¸Ñ€ÑƒÐµÑ‚ÑÑ! ÐŸÑ€Ð¾Ð´Ð¾Ð»Ð¶Ð°Ð¹.', emoji: 'ðŸŒŸ' },
            { days: 30, title: 'ÐœÐµÑÑÑ†', desc: 'Ð¦ÐµÐ»Ñ‹Ð¹ Ð¼ÐµÑÑÑ†! ÐÐµÐ²ÐµÑ€Ð¾ÑÑ‚Ð½Ð¾Ðµ Ð´Ð¾ÑÑ‚Ð¸Ð¶ÐµÐ½Ð¸Ðµ.', emoji: 'ðŸ†' },
            { days: 60, title: '2 Ð¼ÐµÑÑÑ†Ð°', desc: 'Ð”Ð²Ð° Ð¼ÐµÑÑÑ†Ð° ÑÐ¸Ð»Ñ‹ Ð²Ð¾Ð»Ð¸. Ð¢Ñ‹ Ð³ÐµÑ€Ð¾Ð¹!', emoji: 'ðŸ’Ž' },
            { days: 90, title: '3 Ð¼ÐµÑÑÑ†Ð°', desc: 'ÐšÐ²Ð°Ñ€Ñ‚Ð°Ð» Ð±ÐµÐ· ÑÑ€Ñ‹Ð²Ð¾Ð². Ð›ÐµÐ³ÐµÐ½Ð´Ð°Ñ€Ð½Ð¾!', emoji: 'ðŸ‘‘' },
            { days: 180, title: 'ÐŸÐ¾Ð»Ð³Ð¾Ð´Ð°', desc: 'ÐŸÐ¾Ð»Ð³Ð¾Ð´Ð° ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»Ñ. Ð¢Ñ‹ Ð¸Ð·Ð¼ÐµÐ½Ð¸Ð» ÑÐµÐ±Ñ!', emoji: 'ðŸŽ–ï¸' },
            { days: 365, title: 'Ð“Ð¾Ð´', desc: 'Ð¦ÐµÐ»Ñ‹Ð¹ Ð³Ð¾Ð´! Ð¢Ñ‹ Ð´Ð¾ÑÑ‚Ð¸Ð³ Ð½ÐµÐ²ÐµÑ€Ð¾ÑÑ‚Ð½Ð¾Ð³Ð¾!', emoji: 'ðŸŒˆ' }
        ];
        function initDB() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open(DB_NAME, DB_VERSION);
               
                request.onerror = () => reject(request.error);
                request.onsuccess = () => resolve(request.result);
               
                request.onupgradeneeded = (event) => {
                    const db = event.target.result;
                    if (!db.objectStoreNames.contains(STORE_NAME)) {
                        const objectStore = db.createObjectStore(STORE_NAME, { keyPath: 'id', autoIncrement: true });
                        objectStore.createIndex('date', 'date', { unique: false });
                        objectStore.createIndex('time', 'time', { unique: false });
                        objectStore.createIndex('type', 'type', { unique: false });
                    }
                };
            });
        }
        function addEntry(entry) {
            return initDB().then(db => {
                return new Promise((resolve, reject) => {
                    const transaction = db.transaction([STORE_NAME], 'readwrite');
                    const objectStore = transaction.objectStore(STORE_NAME);
                    const request = objectStore.add(entry);
                   
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            });
        }
        function updateEntry(entry) {
            return initDB().then(db => {
                return new Promise((resolve, reject) => {
                    const transaction = db.transaction([STORE_NAME], 'readwrite');
                    const objectStore = transaction.objectStore(STORE_NAME);
                    const request = objectStore.put(entry);
                   
                    request.onsuccess = () => resolve();
                    request.onerror = () => reject(request.error);
                });
            });
        }
        function getAllEntries() {
            return initDB().then(db => {
                return new Promise((resolve, reject) => {
                    const transaction = db.transaction([STORE_NAME], 'readonly');
                    const objectStore = transaction.objectStore(STORE_NAME);
                    const request = objectStore.getAll();
                   
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            });
        }
        function deleteEntry(id) {
            return initDB().then(db => {
                return new Promise((resolve, reject) => {
                    const transaction = db.transaction([STORE_NAME], 'readwrite');
                    const objectStore = transaction.objectStore(STORE_NAME);
                    const request = objectStore.delete(id);
                   
                    request.onsuccess = () => resolve();
                    request.onerror = () => reject(request.error);
                });
            });
        }
        function showSuccessNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'success-notification';
            notification.textContent = message;
            document.body.appendChild(notification);
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
        function App() {
            const [activeTab, setActiveTab] = useState('dashboard');
            const [entries, setEntries] = useState([]);
            const [userSettings, setUserSettings] = useState({
                dailyLimit: 1,
                weeklyLimit: 5,
                monthlyLimit: 15,
                adviceEnabled: true,
                theme: 'dark',
                notifications: false,
                goalDays: 30
            });
            const [unlockedAchievements, setUnlockedAchievements] = useState([]);
            const [nofapMode, setNofapMode] = useState(false);
            const [nofapStartDate, setNofapStartDate] = useState(null);
            const [nofapHistory, setNofapHistory] = useState([]);
            const [filterTags, setFilterTags] = useState([]);
            const [editingEntry, setEditingEntry] = useState(null);
            const [motivationQuote, setMotivationQuote] = useState('');
            useEffect(() => {
                const savedSettings = localStorage.getItem('userSettings');
                if (savedSettings) {
                    const parsed = JSON.parse(savedSettings);
                    setUserSettings(parsed);
                    document.documentElement.setAttribute('data-theme', parsed.theme || 'dark');
                }
                const savedAchievements = localStorage.getItem('achievements');
                if (savedAchievements) setUnlockedAchievements(JSON.parse(savedAchievements));
                const savedNofap = localStorage.getItem('nofapMode');
                if (savedNofap === 'true') setNofapMode(true);
                const savedNofapStart = localStorage.getItem('nofapStartDate');
                if (savedNofapStart) setNofapStartDate(new Date(savedNofapStart));
                const savedNofapHistory = localStorage.getItem('nofapHistory');
                if (savedNofapHistory) setNofapHistory(JSON.parse(savedNofapHistory));
                setMotivationQuote(MOTIVATION_QUOTES[Math.floor(Math.random() * MOTIVATION_QUOTES.length)]);
                loadEntries();
            }, []);
            useEffect(() => {
                checkAchievements();
            }, [entries, userSettings]);
            const loadEntries = async () => {
                const data = await getAllEntries();
                await normalizeLegacyEntryDates(data);
                setEntries(data);
            };
            const handleAddEntry = async (newEntry) => {
                const entryWithId = { ...newEntry, id: Date.now() };
                await addEntry(entryWithId);
                await loadEntries();
                showSuccessNotification('âœ… Ð—Ð°Ð¿Ð¸ÑÑŒ Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð°');
                if (nofapMode) {
                    resetNofap(true);
                }
            };
            const handleEditEntry = async (updatedEntry) => {
                await updateEntry(updatedEntry);
                await loadEntries();
                setEditingEntry(null);
                showSuccessNotification('âœï¸ Ð—Ð°Ð¿Ð¸ÑÑŒ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð°');
            };
            const handleDeleteEntry = async (id) => {
                await deleteEntry(id);
                await loadEntries();
                showSuccessNotification('ðŸ—‘ï¸ Ð—Ð°Ð¿Ð¸ÑÑŒ ÑƒÐ´Ð°Ð»ÐµÐ½Ð°');
            };
            const checkAchievements = () => {
                const streak = getStreak();
                const newUnlocked = [];
                ACHIEVEMENTS.forEach(a => {
                    if (unlockedAchievements.includes(a.id)) return;
                    let unlocked = false;
                    switch(a.id) {
                        case 'first_entry':
                            unlocked = entries.length >= 1;
                            break;
                        case 'week_streak':
                            unlocked = streak >= 7;
                            break;
                        case 'month_control':
                            const thisMonth = formatLocalDate(new Date()).slice(0, 7);
                            const monthEntries = entries.filter(entry => entry.date.startsWith(thisMonth));
                            unlocked = monthEntries.length < userSettings.monthlyLimit && monthEntries.length > 0;
                            break;
                        case 'two_week_streak':
                            unlocked = streak >= 14;
                            break;
                        case 'month_streak':
                            unlocked = streak >= 30;
                            break;
                        case 'total_100':
                            unlocked = entries.length >= 100;
                            break;
                        case 'low_frequency':
                            const lastWeekEntries = entries.filter(e => {
                                const weekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);
                                return parseLocalDate(e.date) >= weekAgo;
                            });
                            unlocked = lastWeekEntries.length <= 1;
                            break;
                        case 'no_content_week':
                            const lastWeekNoContent = entries.filter(e => {
                                const weekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);
                                return parseLocalDate(e.date) >= weekAgo && !e.contentUsed;
                            });
                            const weekTotal = entries.filter(e => {
                                const weekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);
                                return parseLocalDate(e.date) >= weekAgo;
                            });
                            unlocked = lastWeekNoContent.length === weekTotal.length && weekTotal.length >= 5;
                            break;
                        case 'three_month_streak':
                            unlocked = streak >= 90;
                            break;
                        case 'consistent_tracker':
                            let consecutiveDays = 0;
                            const today = new Date();
                            for (let i = 0; i < 30; i++) {
                                const checkDate = new Date(today);
                                checkDate.setDate(checkDate.getDate() - i);
                                const dateStr = formatLocalDate(checkDate);
                                const hasEntry = entries.some(e => e.date === dateStr);
                                if (!hasEntry) break;
                                consecutiveDays++;
                            }
                            unlocked = consecutiveDays >= 30;
                            break;
                        case 'early_bird':
                            const morningEntries = entries.filter(e => {
                                const weekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);
                                const hour = parseInt(e.time.split(':')[0]);
                                return parseLocalDate(e.date) >= weekAgo && hour >= 5 && hour < 12;
                            });
                            unlocked = morningEntries.length === 0;
                            break;
                        case 'night_owl':
                            const nightEntries = entries.filter(e => {
                                const weekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);
                                const hour = parseInt(e.time.split(':')[0]);
                                return parseLocalDate(e.date) >= weekAgo && (hour >= 22 || hour < 5);
                            });
                            unlocked = nightEntries.length === 0;
                            break;
                    }
                    if (unlocked) {
                        newUnlocked.push(a.id);
                        if (typeof confetti !== 'undefined') {
                            confetti({
                                particleCount: 100,
                                spread: 70,
                                origin: { y: 0.6 }
                            });
                        }
                    }
                });
                if (newUnlocked.length > 0) {
                    const updated = [...unlockedAchievements, ...newUnlocked];
                    setUnlockedAchievements(updated);
                    localStorage.setItem('achievements', JSON.stringify(updated));
                    showSuccessNotification(`ðŸ† ÐÐ¾Ð²Ð¾Ðµ Ð´Ð¾ÑÑ‚Ð¸Ð¶ÐµÐ½Ð¸Ðµ Ñ€Ð°Ð·Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð¾!`);
                }
            };
            const getStreak = () => {
                if (entries.length === 0) return 0;
                let streak = 0;
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                for (let i = 0; i < 365; i++) {
                    const checkDate = new Date(today);
                    checkDate.setDate(checkDate.getDate() - i);
                    const dateStr = formatLocalDate(checkDate);
                    const hasEntry = entries.some(e => e.date === dateStr);
                    if (hasEntry) break;
                    streak++;
                }
                return streak;
            };
            const toggleTheme = () => {
                const newTheme = userSettings.theme === 'dark' ? 'light' : 'dark';
                const updated = { ...userSettings, theme: newTheme };
                setUserSettings(updated);
                localStorage.setItem('userSettings', JSON.stringify(updated));
                document.documentElement.setAttribute('data-theme', newTheme);
            };
            const startNofap = () => {
                setNofapMode(true);
                const now = new Date();
                setNofapStartDate(now);
                localStorage.setItem('nofapMode', 'true');
                localStorage.setItem('nofapStartDate', now.toISOString());
                if (typeof confetti !== 'undefined') {
                    confetti({
                        particleCount: 150,
                        spread: 100,
                        origin: { y: 0.6 }
                    });
                }
                showSuccessNotification('ðŸ”¥ NoFap Challenge Ð½Ð°Ñ‡Ð°Ð»ÑÑ!');
            };
            const resetNofap = (auto = false) => {
                if (!auto && !confirm('Ð¡Ð±Ñ€Ð¾ÑÐ¸Ñ‚ÑŒ Ñ‚ÐµÐºÑƒÑ‰Ð¸Ð¹ ÑÑ‚Ñ€Ð¸Ðº? ÐŸÑ€Ð¾Ð³Ñ€ÐµÑÑ ÑÐ¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑÑ Ð² Ð¸ÑÑ‚Ð¾Ñ€Ð¸Ð¸.')) return;
                const days = getNofapDays();
                if (days > 0) {
                    const newHistory = [...nofapHistory, { days, date: new Date().toISOString() }];
                    setNofapHistory(newHistory);
                    localStorage.setItem('nofapHistory', JSON.stringify(newHistory));
                }
                const now = new Date();
                setNofapStartDate(now);
                localStorage.setItem('nofapStartDate', now.toISOString());
            };
            const stopNofap = () => {
                if (!confirm('Ð’Ñ‹Ð¹Ñ‚Ð¸ Ð¸Ð· Ñ€ÐµÐ¶Ð¸Ð¼Ð° NoFap? Ð¢ÐµÐºÑƒÑ‰Ð¸Ð¹ ÑÑ‚Ñ€Ð¸Ðº ÑÐ¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑÑ.')) return;
                setNofapMode(false);
                localStorage.removeItem('nofapMode');
                showSuccessNotification('ðŸ‘‹ Ð ÐµÐ¶Ð¸Ð¼ NoFap Ð·Ð°Ð²ÐµÑ€ÑˆÑ‘Ð½');
            };
            const getNofapDays = () => {
                if (!nofapStartDate) return 0;
                const now = new Date();
                const start = new Date(nofapStartDate);
                const diff = now - start;
                return Math.floor(diff / (1000 * 60 * 60 * 24));
            };
            const getNofapRecord = () => {
                if (nofapHistory.length === 0) return getNofapDays();
                const historyMax = Math.max(...nofapHistory.map(h => h.days));
                return Math.max(historyMax, getNofapDays());
            };
            const getGoalProgress = () => {
                const days = getNofapDays();
                return Math.min((days / userSettings.goalDays) * 100, 100);
            };
            const getWeeklyStats = () => {
                const weekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);
                const weekEntries = entries.filter(e => parseLocalDate(e.date) >= weekAgo);
                const totalDuration = weekEntries.reduce((sum, e) => sum + (e.duration || 0), 0);
                const avgArousal = weekEntries.length > 0 
                    ? weekEntries.reduce((sum, e) => sum + (e.arousalLevel || 5), 0) / weekEntries.length 
                    : 0;
                const withContent = weekEntries.filter(e => e.contentUsed).length;
                return { count: weekEntries.length, totalDuration, avgArousal, withContent };
            };
            const getCurrentMilestone = () => {
                const days = getNofapDays();
                const milestones = [...NOFAP_MILESTONES].reverse();
                return milestones.find(m => days >= m.days) || null;
            };
            return (
                <div className="app-container">
                    <header className="header">
                        <div className="logo">MASTURBATION TRACKER</div>
                        <div className="header-right">
                            <button className="theme-toggle" onClick={toggleTheme}>
                                {userSettings.theme === 'dark' ? 'â˜€ï¸' : 'ðŸŒ™'}
                            </button>
                            <nav className="nav">
                                <button className={`nav-btn ${activeTab === 'dashboard' ? 'active' : ''}`} onClick={() => setActiveTab('dashboard')}>ðŸ“Š Ð”Ð°ÑˆÐ±Ð¾Ñ€Ð´</button>
                                <button className={`nav-btn ${activeTab === 'analytics' ? 'active' : ''}`} onClick={() => setActiveTab('analytics')}>ðŸ“ˆ ÐÐ½Ð°Ð»Ð¸Ñ‚Ð¸ÐºÐ°</button>
                                <button className={`nav-btn ${activeTab === 'calendar' ? 'active' : ''}`} onClick={() => setActiveTab('calendar')}>ðŸ“… ÐšÐ°Ð»ÐµÐ½Ð´Ð°Ñ€ÑŒ</button>
                                <button className={`nav-btn ${activeTab === 'history' ? 'active' : ''}`} onClick={() => setActiveTab('history')}>ðŸ“ Ð˜ÑÑ‚Ð¾Ñ€Ð¸Ñ</button>
                                <button className={`nav-btn ${activeTab === 'achievements' ? 'active' : ''}`} onClick={() => setActiveTab('achievements')}>ðŸ† Ð”Ð¾ÑÑ‚Ð¸Ð¶ÐµÐ½Ð¸Ñ</button>
                                <button className={`nav-btn ${activeTab === 'settings' ? 'active' : ''}`} onClick={() => setActiveTab('settings')}>âš™ï¸ ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸</button>
                            </nav>
                        </div>
                    </header>
                    {activeTab === 'dashboard' && <Dashboard entries={entries} onAddEntry={handleAddEntry} onEditEntry={handleEditEntry} editingEntry={editingEntry} setEditingEntry={setEditingEntry} userSettings={userSettings} getStreak={getStreak} nofapMode={nofapMode} nofapDays={getNofapDays()} nofapRecord={getNofapRecord()} startNofap={startNofap} resetNofap={resetNofap} stopNofap={stopNofap} goalProgress={getGoalProgress()} weeklyStats={getWeeklyStats()} motivationQuote={motivationQuote} getCurrentMilestone={getCurrentMilestone} />}
                    {activeTab === 'analytics' && <Analytics entries={entries} filterTags={filterTags} setFilterTags={setFilterTags} />}
                    {activeTab === 'calendar' && <Calendar entries={entries} />}
                    {activeTab === 'history' && <History entries={entries} onDeleteEntry={handleDeleteEntry} onEditEntry={handleEditEntry} editingEntry={editingEntry} setEditingEntry={setEditingEntry} filterTags={filterTags} setFilterTags={setFilterTags} />}
                    {activeTab === 'achievements' && <Achievements entries={entries} unlockedAchievements={unlockedAchievements} userSettings={userSettings} getStreak={getStreak} />}
                    {activeTab === 'settings' && <Settings userSettings={userSettings} setUserSettings={setUserSettings} entries={entries} />}
                    {editingEntry && <EditEntryModal entry={editingEntry} onSave={handleEditEntry} onCancel={() => setEditingEntry(null)} />}
                </div>
            );
        }
        function Dashboard({ entries, onAddEntry, onEditEntry, editingEntry, setEditingEntry, userSettings, getStreak, nofapMode, nofapDays, nofapRecord, startNofap, resetNofap, stopNofap, goalProgress, weeklyStats, motivationQuote, getCurrentMilestone }) {
            const [mood, setMood] = useState('');
            const [customMood, setCustomMood] = useState('');
            const [arousalLevel, setArousalLevel] = useState(5);
            const [location, setLocation] = useState('');
            const [duration, setDuration] = useState(0);
            const [contentUsed, setContentUsed] = useState(false);
            const [orgasm, setOrgasm] = useState(false);
            const [selectedTriggers, setSelectedTriggers] = useState([]);
            const [customTrigger, setCustomTrigger] = useState('');
            const [note, setNote] = useState('');
            const [showForm, setShowForm] = useState(false);
            const today = formatLocalDate(new Date());
            const todayEntries = entries.filter(e => e.date === today);
            const weekAgo = formatLocalDate(new Date(Date.now() - 7 * 24 * 60 * 60 * 1000));
            const weekEntries = entries.filter(e => e.date >= weekAgo);
            const streak = getStreak();
            const handleSubmit = () => {
                const now = new Date();
                const entry = {
                    id: Date.now(),
                    date: formatLocalDate(now),
                    time: now.toTimeString().split(' ')[0].substring(0, 5),
                    type: 'ÐœÐ°ÑÑ‚ÑƒÑ€Ð±Ð°Ñ†Ð¸Ñ',
                    mood,
                    arousalLevel,
                    location: location || 'ÐÐµ ÑƒÐºÐ°Ð·Ð°Ð½Ð¾',
                    duration,
                    contentUsed,
                    orgasm,
                    triggers: selectedTriggers,
                    note,
                    timestamp: now.toISOString()
                };
                onAddEntry(entry);
                setMood('');
                setCustomMood('');
                setArousalLevel(5);
                setLocation('');
                setDuration(0);
                setContentUsed(false);
                setOrgasm(false);
                setSelectedTriggers([]);
                setCustomTrigger('');
                setNote('');
                setShowForm(false);
            };
            const toggleTrigger = (trigger) => {
                if (selectedTriggers.includes(trigger)) {
                    setSelectedTriggers(selectedTriggers.filter(t => t !== trigger));
                } else {
                    setSelectedTriggers([...selectedTriggers, trigger]);
                }
            };
            const addCustomTrigger = () => {
                if (customTrigger.trim() && !selectedTriggers.includes(customTrigger.trim())) {
                    setSelectedTriggers([...selectedTriggers, customTrigger.trim()]);
                    setCustomTrigger('');
                }
            };
            const toggleMood = (moodVal) => {
                setMood(moodVal === mood ? '' : moodVal);
            };
            const addCustomMood = () => {
                if (customMood.trim()) {
                    setMood(customMood.trim());
                    setCustomMood('');
                }
            };
            const todayWarning = todayEntries.length >= userSettings.dailyLimit ? 'âš ï¸ ÐŸÑ€ÐµÐ²Ñ‹ÑˆÐµÐ½ Ð´Ð½ÐµÐ²Ð½Ð¾Ð¹ Ð»Ð¸Ð¼Ð¸Ñ‚!' : '';
            const weekWarning = weekEntries.length >= userSettings.weeklyLimit ? 'âš ï¸ ÐŸÑ€ÐµÐ²Ñ‹ÑˆÐµÐ½ Ð½ÐµÐ´ÐµÐ»ÑŒÐ½Ñ‹Ð¹ Ð»Ð¸Ð¼Ð¸Ñ‚!' : '';
            const advice = userSettings.adviceEnabled ? (todayWarning || weekWarning || 'Ð’ÑÑ‘ Ð² Ð½Ð¾Ñ€Ð¼Ðµ ðŸ‘Œ') : '';
            const totalDuration = entries.reduce((sum, e) => sum + (e.duration || 0), 0);
            const avgDuration = entries.length > 0 ? Math.round(totalDuration / entries.length) : 0;
            const currentMilestone = getCurrentMilestone();
            return (
                <div className="fade-in">
                    <div className="motivation-quote">
                        ðŸ’­ {motivationQuote}
                    </div>
                    {nofapMode && (
                        <div className="nofap-container">
                            <div className="nofap-day-count">Ð”ÐµÐ½ÑŒ {nofapDays}</div>
                            <div className="nofap-label">NoFap Challenge</div>
                            {currentMilestone && (
                                <div className="nofap-milestone">
                                    <div className="nofap-milestone-title">{currentMilestone.emoji} {currentMilestone.title}</div>
                                    <div className="nofap-milestone-desc">{currentMilestone.desc}</div>
                                </div>
                            )}
                            <div className="goal-progress">
                                <div className="progress-circle" style={{background: `conic-gradient(var(--accent) 0% ${goalProgress}%, var(--bg-tertiary) ${goalProgress}% 100%)`}}>
                                    <div className="progress-text">{Math.round(goalProgress)}%</div>
                                </div>
                                <div>
                                    <div className="nofap-record">ðŸ† Ð¦ÐµÐ»ÑŒ: {userSettings.goalDays} Ð´Ð½ÐµÐ¹</div>
                                    <div className="nofap-record">ðŸ“ˆ Ð ÐµÐºÐ¾Ñ€Ð´: {nofapRecord} Ð´Ð½ÐµÐ¹</div>
                                    <div className="nofap-record">ðŸ’ª Ð¡ÐµÐ¹Ñ‡Ð°Ñ: {nofapDays} Ð´Ð½ÐµÐ¹</div>
                                </div>
                            </div>
                            <div className="nofap-buttons">
                                <button className="nofap-reset-btn" onClick={() => resetNofap()}>ðŸ”„ Ð¡Ð±Ñ€Ð¾ÑÐ¸Ñ‚ÑŒ ÑÑ‚Ñ€Ð¸Ðº</button>
                                <button className="nav-btn" onClick={stopNofap}>ðŸšª Ð’Ñ‹Ð¹Ñ‚Ð¸ Ð¸Ð· Ñ€ÐµÐ¶Ð¸Ð¼Ð°</button>
                            </div>
                        </div>
                    )}
                    {!nofapMode && (
                        <div style={{ marginBottom: '30px', textAlign: 'center' }}>
                            <button className="action-btn" onClick={startNofap}>ðŸ”¥ ÐÐ°Ñ‡Ð°Ñ‚ÑŒ NoFap Challenge</button>
                        </div>
                    )}
                    <div className="quick-stats">
                        <div className="quick-stat">
                            <div className="quick-stat-value">{streak}</div>
                            <div className="quick-stat-label">Ð”Ð½ÐµÐ¹ Ð±ÐµÐ·</div>
                        </div>
                        <div className="quick-stat">
                            <div className="quick-stat-value">{todayEntries.length}/{userSettings.dailyLimit}</div>
                            <div className="quick-stat-label">Ð¡ÐµÐ³Ð¾Ð´Ð½Ñ / Ð»Ð¸Ð¼Ð¸Ñ‚</div>
                        </div>
                        <div className="quick-stat">
                            <div className="quick-stat-value">{weeklyStats.count}</div>
                            <div className="quick-stat-label">Ð—Ð° Ð½ÐµÐ´ÐµÐ»ÑŽ</div>
                        </div>
                        <div className="quick-stat">
                            <div className="quick-stat-value">{avgDuration} Ð¼Ð¸Ð½</div>
                            <div className="quick-stat-label">Ð¡Ñ€ÐµÐ´Ð½ÐµÐµ Ð²Ñ€ÐµÐ¼Ñ</div>
                        </div>
                    </div>
                    <div className="stats-grid">
                        <div className="stat-card">
                            <div className="stat-label">ÐÐµÐ´ÐµÐ»ÑŒÐ½Ð°Ñ ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ°</div>
                            <div className="stat-value">{weeklyStats.count}</div>
                            <div className="stat-sublabel">Ð—Ð°Ð¿Ð¸ÑÐµÐ¹: {weeklyStats.count} | Ð¡ ÐºÐ¾Ð½Ñ‚ÐµÐ½Ñ‚Ð¾Ð¼: {weeklyStats.withContent}</div>
                            <div className="stat-sublabel">ÐžÐ±Ñ‰ÐµÐµ Ð²Ñ€ÐµÐ¼Ñ: {Math.round(weeklyStats.totalDuration)} Ð¼Ð¸Ð½</div>
                            <div className="stat-sublabel">Ð¡Ñ€ÐµÐ´Ð½ÐµÐµ Ð²Ð¾Ð·Ð±ÑƒÐ¶Ð´ÐµÐ½Ð¸Ðµ: {weeklyStats.avgArousal.toFixed(1)}/10</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-label">ÐžÐ±Ñ‰Ð°Ñ ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ°</div>
                            <div className="stat-value">{entries.length}</div>
                            <div className="stat-sublabel">Ð’ÑÐµÐ³Ð¾ Ð·Ð°Ð¿Ð¸ÑÐµÐ¹</div>
                            <div className="stat-sublabel">ÐžÐ±Ñ‰ÐµÐµ Ð²Ñ€ÐµÐ¼Ñ: {Math.round(totalDuration / 60)} Ñ‡Ð°ÑÐ¾Ð²</div>
                            <div className="stat-sublabel">Ð¡Ñ€ÐµÐ´Ð½ÐµÐµ: {avgDuration} Ð¼Ð¸Ð½ Ð½Ð° ÑÐµÑÑÐ¸ÑŽ</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-label">Ð¦ÐµÐ»Ð¸ Ð¸ Ð»Ð¸Ð¼Ð¸Ñ‚Ñ‹</div>
                            <div className="stat-value">{userSettings.dailyLimit}/{userSettings.weeklyLimit}</div>
                            <div className="stat-sublabel">Ð”ÐµÐ½ÑŒ/Ð½ÐµÐ´ÐµÐ»Ñ</div>
                            <div className="stat-sublabel">ÐœÐµÑÑÑ‡Ð½Ñ‹Ð¹ Ð»Ð¸Ð¼Ð¸Ñ‚: {userSettings.monthlyLimit}</div>
                            <div className="stat-sublabel">ÐŸÑ€Ð¾Ð³Ñ€ÐµÑÑ NoFap: {Math.round(goalProgress)}%</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-label">Ð­Ñ„Ñ„ÐµÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚ÑŒ</div>
                            <div className="stat-value">{Math.round((entries.filter(e => e.orgasm).length / entries.length) * 100 || 0)}%</div>
                            <div className="stat-sublabel">Ð”Ð¾ÑÑ‚Ð¸Ð¶ÐµÐ½Ð¸Ðµ Ð¾Ñ€Ð³Ð°Ð·Ð¼Ð°</div>
                            <div className="stat-sublabel">Ð¡ ÐºÐ¾Ð½Ñ‚ÐµÐ½Ñ‚Ð¾Ð¼: {Math.round((entries.filter(e => e.contentUsed).length / entries.length) * 100 || 0)}%</div>
                            <div className="stat-sublabel">Ð¡Ñ€ÐµÐ´Ð½ÐµÐµ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½Ð¸Ðµ: {entries.length > 0 ? 'ðŸ˜Š' : 'ðŸ˜'}</div>
                        </div>
                    </div>
                    {advice && (
                        <div style={{ marginBottom: '20px', padding: '15px', background: advice.includes('ÐŸÑ€ÐµÐ²Ñ‹ÑˆÐµÐ½') ? 'var(--danger)' : 'var(--success)', borderRadius: '10px', color: 'white', fontWeight: '600' }}>
                            {advice}
                        </div>
                    )}
                    <button
                        className="action-btn"
                        style={{ width: '100%', marginBottom: '20px' }}
                        onClick={() => setShowForm(v => !v)}
                    >
                        {showForm ? 'âœ– Ð¡ÐºÑ€Ñ‹Ñ‚ÑŒ Ñ„Ð¾Ñ€Ð¼Ñƒ' : 'âž• Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð·Ð°Ð¿Ð¸ÑÑŒ'}
                    </button>
                    {showForm && (
                    <div className="entry-form">
                        <h2 className="section-title">âœï¸ Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð·Ð°Ð¿Ð¸ÑÑŒ Ð¾ Ð¼Ð°ÑÑ‚ÑƒÑ€Ð±Ð°Ñ†Ð¸Ð¸</h2>
                        <div className="form-group">
                            <label className="form-label">ÐÐ°ÑÑ‚Ñ€Ð¾ÐµÐ½Ð¸Ðµ Ð¿Ð¾ÑÐ»Ðµ</label>
                            <div className="tags-container">
                                {PREDEFINED_MOODS.map(moodVal => (
                                    <button
                                        key={moodVal}
                                        className={`tag-btn ${mood === moodVal ? 'active' : ''}`}
                                        onClick={() => toggleMood(moodVal)}
                                    >
                                        {moodVal}
                                    </button>
                                ))}
                            </div>
                            <div style={{ display: 'flex', gap: '10px', marginTop: '10px' }}>
                                <input
                                    type="text"
                                    className="form-input"
                                    value={customMood}
                                    onChange={(e) => setCustomMood(e.target.value)}
                                    onKeyPress={(e) => e.key === 'Enter' && addCustomMood()}
                                    placeholder="Ð¡Ð²Ð¾Ñ‘ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½Ð¸Ðµ..."
                                />
                                <button className="nav-btn" onClick={addCustomMood}>Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ</button>
                            </div>
                        </div>
                        <div className="form-group">
                            <label className="form-label">Ð£Ñ€Ð¾Ð²ÐµÐ½ÑŒ Ð²Ð¾Ð·Ð±ÑƒÐ¶Ð´ÐµÐ½Ð¸Ñ Ð¿ÐµÑ€ÐµÐ´: {arousalLevel}/10</label>
                            <input type="range" min="1" max="10" value={arousalLevel} onChange={(e) => setArousalLevel(parseInt(e.target.value))} className="slider" />
                            <div className="slider-value">{arousalLevel}/10</div>
                        </div>
                        <div className="form-group">
                            <label className="form-label">ÐœÐµÑÑ‚Ð¾ (Ð½ÐµÐ¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾)</label>
                            <input type="text" className="form-input" value={location} onChange={(e) => setLocation(e.target.value)} placeholder="Ð´Ð¾Ð¼, Ñ€Ð°Ð±Ð¾Ñ‚Ð°, Ð²Ð°Ð½Ð½Ð°Ñ Ð¸ Ñ‚.Ð´." />
                        </div>
                        <div className="form-group">
                            <label className="form-label">Ð”Ð»Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ (Ð¼Ð¸Ð½ÑƒÑ‚Ñ‹)</label>
                            <input type="number" className="form-input" min="0" max="180" value={duration} onChange={(e) => setDuration(parseInt(e.target.value) || 0)} placeholder="0" />
                        </div>
                        <div className="form-group">
                            <label className="checkbox-label">
                                <input type="checkbox" checked={contentUsed} onChange={(e) => setContentUsed(e.target.checked)} className="checkbox" />
                                Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð»ÑÑ ÐºÐ¾Ð½Ñ‚ÐµÐ½Ñ‚ (Ð¿Ð¾Ñ€Ð½Ð¾, Ñ„Ð¾Ñ‚Ð¾ Ð¸ Ñ‚.Ð´.)
                            </label>
                        </div>
                        <div className="form-group">
                            <label className="checkbox-label">
                                <input type="checkbox" checked={orgasm} onChange={(e) => setOrgasm(e.target.checked)} className="checkbox" />
                                Ð”Ð¾ÑÑ‚Ð¸Ð³Ð½ÑƒÑ‚ Ð¾Ñ€Ð³Ð°Ð·Ð¼
                            </label>
                        </div>
                        <div className="form-group">
                            <label className="form-label">Ð¢Ñ€Ð¸Ð³Ð³ÐµÑ€Ñ‹ / Ð¿Ñ€Ð¸Ñ‡Ð¸Ð½Ñ‹ (Ð½ÐµÐ¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾)</label>
                            <div className="tags-container">
                                {PREDEFINED_TRIGGERS.map(trigger => (
                                    <button
                                        key={trigger}
                                        className={`tag-btn ${selectedTriggers.includes(trigger) ? 'active' : ''}`}
                                        onClick={() => toggleTrigger(trigger)}
                                    >
                                        {trigger}
                                    </button>
                                ))}
                            </div>
                        </div>
                        <div className="form-group">
                            <label className="form-label">Ð¡Ð²Ð¾Ð¹ Ñ‚Ñ€Ð¸Ð³Ð³ÐµÑ€</label>
                            <div style={{ display: 'flex', gap: '10px' }}>
                                <input
                                    type="text"
                                    className="form-input"
                                    value={customTrigger}
                                    onChange={(e) => setCustomTrigger(e.target.value)}
                                    onKeyPress={(e) => e.key === 'Enter' && addCustomTrigger()}
                                    placeholder="Ð’Ð²ÐµÐ´Ð¸ ÑÐ²Ð¾Ð¹ Ñ‚Ñ€Ð¸Ð³Ð³ÐµÑ€..."
                                />
                                <button className="nav-btn" onClick={addCustomTrigger}>Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ</button>
                            </div>
                        </div>
                        {selectedTriggers.length > 0 && (
                            <div style={{ marginBottom: '20px' }}>
                                <div className="form-label">Ð’Ñ‹Ð±Ñ€Ð°Ð½Ð¾ Ñ‚Ñ€Ð¸Ð³Ð³ÐµÑ€Ð¾Ð²: {selectedTriggers.length}</div>
                                <div className="tags-container">
                                    {selectedTriggers.map(trigger => (
                                        <span key={trigger} className="history-badge">{trigger}</span>
                                    ))}
                                </div>
                            </div>
                        )}
                        <div className="form-group">
                            <label className="form-label">Ð—Ð°Ð¼ÐµÑ‚ÐºÐ¸ / Ð¼Ñ‹ÑÐ»Ð¸ Ð¿Ð¾ÑÐ»Ðµ (Ð½ÐµÐ¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾)</label>
                            <textarea className="form-textarea" value={note} onChange={(e) => setNote(e.target.value)} placeholder="ÐšÐ°Ðº ÑÐµÐ±Ñ Ñ‡ÑƒÐ²ÑÑ‚Ð²ÑƒÐµÑˆÑŒ? Ð§Ñ‚Ð¾ Ð´ÑƒÐ¼Ð°ÐµÑˆÑŒ Ð¾Ð± ÑÑ‚Ð¾Ð¼? Ð•ÑÑ‚ÑŒ Ð»Ð¸ ÑÐ¾Ð¶Ð°Ð»ÐµÐ½Ð¸Ñ?"></textarea>
                        </div>
                        <button className="action-btn" onClick={handleSubmit}>
                            âž• Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð·Ð°Ð¿Ð¸ÑÑŒ Ð¾ Ð¼Ð°ÑÑ‚ÑƒÑ€Ð±Ð°Ñ†Ð¸Ð¸
                        </button>
                    </div>
                    )}
                </div>
            );
        }
        function EditEntryModal({ entry, onSave, onCancel }) {
            const [mood, setMood] = useState(entry.mood || '');
            const [arousalLevel, setArousalLevel] = useState(entry.arousalLevel || 5);
            const [location, setLocation] = useState(entry.location || '');
            const [duration, setDuration] = useState(entry.duration || 0);
            const [contentUsed, setContentUsed] = useState(entry.contentUsed || false);
            const [orgasm, setOrgasm] = useState(entry.orgasm || false);
            const [selectedTriggers, setSelectedTriggers] = useState(entry.triggers || []);
            const [customTrigger, setCustomTrigger] = useState('');
            const [note, setNote] = useState(entry.note || '');
            const handleSave = () => {
                onSave({
                    ...entry,
                    mood,
                    arousalLevel,
                    location,
                    duration,
                    contentUsed,
                    orgasm,
                    triggers: selectedTriggers,
                    note
                });
            };
            const toggleTrigger = (trigger) => {
                if (selectedTriggers.includes(trigger)) {
                    setSelectedTriggers(selectedTriggers.filter(t => t !== trigger));
                } else {
                    setSelectedTriggers([...selectedTriggers, trigger]);
                }
            };
            const addCustomTrigger = () => {
                if (customTrigger.trim() && !selectedTriggers.includes(customTrigger.trim())) {
                    setSelectedTriggers([...selectedTriggers, customTrigger.trim()]);
                    setCustomTrigger('');
                }
            };
            const toggleMood = (moodVal) => {
                setMood(moodVal === mood ? '' : moodVal);
            };
            return (
                <>
                    <div className="modal-overlay" onClick={onCancel}></div>
                    <div className="day-detail-modal">
                        <div className="modal-header">
                            <div className="modal-title">âœï¸ Ð ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð·Ð°Ð¿Ð¸ÑÑŒ</div>
                            <button className="modal-close" onClick={onCancel}>Ã—</button>
                        </div>
                        <div className="form-group">
                            <label className="form-label">ÐÐ°ÑÑ‚Ñ€Ð¾ÐµÐ½Ð¸Ðµ Ð¿Ð¾ÑÐ»Ðµ</label>
                            <div className="tags-container">
                                {PREDEFINED_MOODS.map(moodVal => (
                                    <button
                                        key={moodVal}
                                        className={`tag-btn ${mood === moodVal ? 'active' : ''}`}
                                        onClick={() => toggleMood(moodVal)}
                                    >
                                        {moodVal}
                                    </button>
                                ))}
                            </div>
                        </div>
                        <div className="form-group">
                            <label className="form-label">Ð£Ñ€Ð¾Ð²ÐµÐ½ÑŒ Ð²Ð¾Ð·Ð±ÑƒÐ¶Ð´ÐµÐ½Ð¸Ñ: {arousalLevel}/10</label>
                            <input type="range" min="1" max="10" value={arousalLevel} onChange={(e) => setArousalLevel(parseInt(e.target.value))} className="slider" />
                        </div>
                        <div className="form-group">
                            <label className="form-label">ÐœÐµÑÑ‚Ð¾</label>
                            <input type="text" className="form-input" value={location} onChange={(e) => setLocation(e.target.value)} />
                        </div>
                        <div className="form-group">
                            <label className="form-label">Ð”Ð»Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ (Ð¼Ð¸Ð½ÑƒÑ‚Ñ‹)</label>
                            <input type="number" className="form-input" value={duration} onChange={(e) => setDuration(parseInt(e.target.value) || 0)} />
                        </div>
                        <div className="form-group">
                            <label className="checkbox-label">
                                <input type="checkbox" checked={contentUsed} onChange={(e) => setContentUsed(e.target.checked)} className="checkbox" />
                                Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð»ÑÑ ÐºÐ¾Ð½Ñ‚ÐµÐ½Ñ‚
                            </label>
                        </div>
                        <div className="form-group">
                            <label className="checkbox-label">
                                <input type="checkbox" checked={orgasm} onChange={(e) => setOrgasm(e.target.checked)} className="checkbox" />
                                Ð”Ð¾ÑÑ‚Ð¸Ð³Ð½ÑƒÑ‚ Ð¾Ñ€Ð³Ð°Ð·Ð¼
                            </label>
                        </div>
                        <div className="form-group">
                            <label className="form-label">Ð¢Ñ€Ð¸Ð³Ð³ÐµÑ€Ñ‹</label>
                            <div className="tags-container">
                                {PREDEFINED_TRIGGERS.map(trigger => (
                                    <button
                                        key={trigger}
                                        className={`tag-btn ${selectedTriggers.includes(trigger) ? 'active' : ''}`}
                                        onClick={() => toggleTrigger(trigger)}
                                    >
                                        {trigger}
                                    </button>
                                ))}
                            </div>
                            <div style={{ display: 'flex', gap: '10px', marginTop: '10px' }}>
                                <input
                                    type="text"
                                    className="form-input"
                                    value={customTrigger}
                                    onChange={(e) => setCustomTrigger(e.target.value)}
                                    onKeyPress={(e) => e.key === 'Enter' && addCustomTrigger()}
                                    placeholder="Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ñ‚Ñ€Ð¸Ð³Ð³ÐµÑ€..."
                                />
                                <button className="nav-btn" onClick={addCustomTrigger}>Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ</button>
                            </div>
                        </div>
                        <div className="form-group">
                            <label className="form-label">Ð—Ð°Ð¼ÐµÑ‚ÐºÐ¸</label>
                            <textarea className="form-textarea" value={note} onChange={(e) => setNote(e.target.value)}></textarea>
                        </div>
                        <div style={{ display: 'flex', gap: '10px', marginTop: '20px' }}>
                            <button className="action-btn" onClick={handleSave}>ðŸ’¾ Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ</button>
                            <button className="nav-btn" onClick={onCancel}>âŒ ÐžÑ‚Ð¼ÐµÐ½Ð°</button>
                        </div>
                    </div>
                </>
            );
        }
        function Analytics({ entries, filterTags, setFilterTags }) {
            const allTriggers = [...new Set(entries.flatMap(e => e.triggers || []))];
            const filteredEntries = filterTags.length > 0
                ? entries.filter(e => e.triggers?.some(trigger => filterTags.includes(trigger)))
                : entries;
            const toggleFilterTag = (tag) => {
                if (filterTags.includes(tag)) {
                    setFilterTags(filterTags.filter(t => t !== tag));
                } else {
                    setFilterTags([...filterTags, tag]);
                }
            };
            const timeOfDayData = () => {
                const hours = {};
                for (let i = 0; i < 24; i++) hours[i] = 0;
                filteredEntries.forEach(e => {
                    const hour = parseInt(e.time.split(':')[0]);
                    hours[hour]++;
                });
                const timeRanges = {
                    'ÐÐ¾Ñ‡ÑŒ (00-06)': [0,1,2,3,4,5],
                    'Ð£Ñ‚Ñ€Ð¾ (06-12)': [6,7,8,9,10,11],
                    'Ð”ÐµÐ½ÑŒ (12-18)': [12,13,14,15,16,17],
                    'Ð’ÐµÑ‡ÐµÑ€ (18-24)': [18,19,20,21,22,23]
                };
                return Object.entries(timeRanges).map(([label, hourRange]) => ({
                    label,
                    value: hourRange.reduce((sum, h) => sum + hours[h], 0)
                }));
            };
            const dayOfWeekData = () => {
                const days = ['Ð’Ñ', 'ÐŸÐ½', 'Ð’Ñ‚', 'Ð¡Ñ€', 'Ð§Ñ‚', 'ÐŸÑ‚', 'Ð¡Ð±'];
                const counts = [0, 0, 0, 0, 0, 0, 0];
                filteredEntries.forEach(e => {
                    const date = new Date(e.date + 'T00:00:00');
                    counts[date.getDay()]++;
                });
                return days.map((day, idx) => ({ label: day, value: counts[idx] }));
            };
            const triggerStats = () => {
                const triggerCounts = {};
                filteredEntries.forEach(e => {
                    (e.triggers || []).forEach(trigger => {
                        triggerCounts[trigger] = (triggerCounts[trigger] || 0) + 1;
                    });
                });
                return Object.entries(triggerCounts)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 10)
                    .map(([trigger, count]) => ({ label: trigger, value: count }));
            };
            const moodStats = () => {
                const moodCounts = {};
                filteredEntries.forEach(e => {
                    if (e.mood) {
                        moodCounts[e.mood] = (moodCounts[e.mood] || 0) + 1;
                    }
                });
                return Object.entries(moodCounts)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 10)
                    .map(([mood, count]) => ({ label: mood, value: count }));
            };
            const periodComparison = () => {
                const now = new Date();
                const thisMonthStart = formatLocalDate(new Date(now.getFullYear(), now.getMonth(), 1));
                const lastMonthStart = formatLocalDate(new Date(now.getFullYear(), now.getMonth() - 1, 1));
                const lastMonthEnd = formatLocalDate(new Date(now.getFullYear(), now.getMonth(), 0));
                const thisMonth = entries.filter(e => e.date >= thisMonthStart).length;
                const lastMonth = entries.filter(e => e.date >= lastMonthStart && e.date <= lastMonthEnd).length;
                const diff = thisMonth - lastMonth;
                const percent = lastMonth > 0 ? ((diff / lastMonth) * 100).toFixed(0) : 0;
                return { thisMonth, lastMonth, diff, percent };
            };
            const monthlyData = () => {
                const months = {};
                filteredEntries.forEach(e => {
                    const monthKey = e.date.slice(0, 7);
                    months[monthKey] = (months[monthKey] || 0) + 1;
                });
                const sortedMonths = Object.keys(months).sort();
                return {
                    labels: sortedMonths.map(m => {
                        const [, month] = m.split('-');
                        return new Date(2000, parseInt(month) - 1).toLocaleString('ru-RU', { month: 'short' });
                    }),
                    values: sortedMonths.map(m => months[m])
                };
            };
            const getTriggerDayHeatmap = () => {
                const topTriggers = triggerStats().slice(0, 5);
                const days = ['ÐŸÐ½', 'Ð’Ñ‚', 'Ð¡Ñ€', 'Ð§Ñ‚', 'ÐŸÑ‚', 'Ð¡Ð±', 'Ð’Ñ'];
                const heatmapData = {};
                topTriggers.forEach(t => {
                    heatmapData[t.label] = [0, 0, 0, 0, 0, 0, 0];
                });
                filteredEntries.forEach(e => {
                    const date = new Date(e.date + 'T00:00:00');
                    const dayIndex = (date.getDay() + 6) % 7;
                    (e.triggers || []).forEach(trigger => {
                        if (heatmapData[trigger]) {
                            heatmapData[trigger][dayIndex]++;
                        }
                    });
                });
                return { topTriggers: topTriggers.map(t => t.label), days, data: heatmapData };
            };
            const getWeeklyTrend = () => {
                const weeks = {};
                filteredEntries.forEach(e => {
                    const date = parseLocalDate(e.date);
                    const weekStart = new Date(date);
                    weekStart.setDate(date.getDate() - date.getDay());
                    const weekKey = formatLocalDate(weekStart);
                    weeks[weekKey] = (weeks[weekKey] || 0) + 1;
                });
                const sortedWeeks = Object.keys(weeks).sort().slice(-8);
                return {
                    labels: sortedWeeks.map((w, i) => `ÐÐµÐ´ ${i + 1}`),
                    values: sortedWeeks.map(w => weeks[w])
                };
            };
            const getPrediction = () => {
                const last4Weeks = filteredEntries.filter(e => {
                    const fourWeeksAgo = new Date(Date.now() - 28 * 24 * 60 * 60 * 1000);
                    return parseLocalDate(e.date) >= fourWeeksAgo;
                });
                const avgPerWeek = last4Weeks.length / 4;
                const predicted = Math.round(avgPerWeek);
                return predicted;
            };
            const chartRef = useRef(null);
            const durationChartRef = useRef(null);
            const weeklyTrendRef = useRef(null);
            useEffect(() => {
                if (chartRef.current) {
                    const ctx = chartRef.current.getContext('2d');
                    const { labels, values } = monthlyData();
                    new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: labels,
                            datasets: [{
                                label: 'Ð§Ð°ÑÑ‚Ð¾Ñ‚Ð° Ð¼Ð°ÑÑ‚ÑƒÑ€Ð±Ð°Ñ†Ð¸Ð¸ Ð¿Ð¾ Ð¼ÐµÑÑÑ†Ð°Ð¼',
                                data: values,
                                borderColor: 'var(--accent)',
                                backgroundColor: 'rgba(255, 107, 157, 0.2)',
                                fill: true,
                                tension: 0.4
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    grid: { color: 'var(--border)' },
                                    ticks: { color: 'var(--text-secondary)' }
                                },
                                x: {
                                    grid: { color: 'var(--border)' },
                                    ticks: { color: 'var(--text-secondary)' }
                                }
                            },
                            plugins: {
                                legend: { labels: { color: 'var(--text-primary)' } }
                            }
                        }
                    });
                }
                if (durationChartRef.current) {
                    const ctx = durationChartRef.current.getContext('2d');
                    const durations = filteredEntries.slice(-20).map(e => e.duration || 0);
                    new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: durations.map((_, i) => i + 1),
                            datasets: [{
                                label: 'Ð”Ð»Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ ÑÐµÑÑÐ¸Ð¹ (Ð¼Ð¸Ð½)',
                                data: durations,
                                backgroundColor: 'rgba(255, 107, 157, 0.5)',
                                borderColor: 'var(--accent)',
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    grid: { color: 'var(--border)' },
                                    ticks: { color: 'var(--text-secondary)' }
                                },
                                x: {
                                    grid: { color: 'var(--border)' },
                                    ticks: { color: 'var(--text-secondary)' }
                                }
                            },
                            plugins: {
                                legend: { labels: { color: 'var(--text-primary)' } }
                            }
                        }
                    });
                }
                if (weeklyTrendRef.current) {
                    const ctx = weeklyTrendRef.current.getContext('2d');
                    const { labels, values } = getWeeklyTrend();
                    new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: labels,
                            datasets: [{
                                label: 'Ð¢Ñ€ÐµÐ½Ð´ Ð¿Ð¾ Ð½ÐµÐ´ÐµÐ»ÑÐ¼',
                                data: values,
                                borderColor: 'var(--chart-2)',
                                backgroundColor: 'rgba(107, 141, 255, 0.2)',
                                fill: true,
                                tension: 0.4
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    grid: { color: 'var(--border)' },
                                    ticks: { color: 'var(--text-secondary)' }
                                },
                                x: {
                                    grid: { color: 'var(--border)' },
                                    ticks: { color: 'var(--text-secondary)' }
                                }
                            },
                            plugins: {
                                legend: { labels: { color: 'var(--text-primary)' } }
                            }
                        }
                    });
                }
            }, [filteredEntries]);
            const timeData = timeOfDayData();
            const dayData = dayOfWeekData();
            const triggers = triggerStats();
            const moods = moodStats();
            const comparison = periodComparison();
            const maxTime = Math.max(...timeData.map(d => d.value), 1);
            const maxDay = Math.max(...dayData.map(d => d.value), 1);
            const maxTrigger = Math.max(...triggers.map(d => d.value), 1);
            const maxMood = Math.max(...moods.map(d => d.value), 1);
            const totalDuration = filteredEntries.reduce((sum, e) => sum + (e.duration || 0), 0);
            const avgDuration = filteredEntries.length > 0 ? Math.round(totalDuration / filteredEntries.length) : 0;
            const orgasmRate = filteredEntries.length > 0 ? Math.round((filteredEntries.filter(e => e.orgasm).length / filteredEntries.length) * 100) : 0;
            const contentRate = filteredEntries.length > 0 ? Math.round((filteredEntries.filter(e => e.contentUsed).length / filteredEntries.length) * 100) : 0;
            const avgArousal = filteredEntries.length > 0 
                ? filteredEntries.reduce((sum, e) => sum + (e.arousalLevel || 5), 0) / filteredEntries.length 
                : 0;
            const triggerHeatmap = getTriggerDayHeatmap();
            const prediction = getPrediction();
            const insights = [];
            const topTime = timeData.reduce((a, b) => a.value > b.value ? a : b);
            if (topTime.value > 0) {
                insights.push({
                    icon: 'â°',
                    title: 'ÐŸÐ¸ÐºÐ¾Ð²Ð¾Ðµ Ð²Ñ€ÐµÐ¼Ñ',
                    desc: `${topTime.label} â€” ${((topTime.value / filteredEntries.length) * 100).toFixed(0)}% Ñ‚Ð²Ð¾Ð¸Ñ… ÑÐµÑÑÐ¸Ð¹`
                });
            }
            const topDay = dayData.reduce((a, b) => a.value > b.value ? a : b);
            if (topDay.value > 0) {
                insights.push({
                    icon: 'ðŸ“…',
                    title: 'Ð¡Ð°Ð¼Ñ‹Ð¹ Ð°ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ð¹ Ð´ÐµÐ½ÑŒ',
                    desc: `${topDay.label} â€” ${topDay.value} Ð·Ð°Ð¿Ð¸ÑÐµÐ¹`
                });
            }
            if (triggers.length > 0) {
                insights.push({
                    icon: 'ðŸŽ¯',
                    title: 'Ð“Ð»Ð°Ð²Ð½Ñ‹Ð¹ Ñ‚Ñ€Ð¸Ð³Ð³ÐµÑ€',
                    desc: `${triggers[0].label} â€” ${((triggers[0].value / filteredEntries.length) * 100).toFixed(0)}% Ð·Ð°Ð¿Ð¸ÑÐµÐ¹`
                });
            }
            if (comparison.percent < 0) {
                insights.push({
                    icon: 'ðŸ“‰',
                    title: 'ÐŸÐ¾Ð»Ð¾Ð¶Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð°Ñ Ð´Ð¸Ð½Ð°Ð¼Ð¸ÐºÐ°',
                    desc: `Ð­Ñ‚Ð¾Ñ‚ Ð¼ÐµÑÑÑ†: ${comparison.thisMonth} Ð·Ð°Ð¿Ð¸ÑÐµÐ¹ (${Math.abs(comparison.percent)}% Ð¼ÐµÐ½ÑŒÑˆÐµ)`
                });
            } else if (comparison.percent > 0) {
                insights.push({
                    icon: 'ðŸ“ˆ',
                    title: 'Ð Ð¾ÑÑ‚ Ð°ÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚Ð¸',
                    desc: `Ð­Ñ‚Ð¾Ñ‚ Ð¼ÐµÑÑÑ†: ${comparison.thisMonth} Ð·Ð°Ð¿Ð¸ÑÐµÐ¹ (+${comparison.percent}%)`
                });
            }
            if (prediction > 0) {
                insights.push({
                    icon: 'ðŸ”®',
                    title: 'ÐŸÑ€Ð¾Ð³Ð½Ð¾Ð· Ð½Ð° Ð½ÐµÐ´ÐµÐ»ÑŽ',
                    desc: `ÐÐ° Ð¾ÑÐ½Ð¾Ð²Ðµ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ñ… 4 Ð½ÐµÐ´ÐµÐ»ÑŒ, Ð¾Ð¶Ð¸Ð´Ð°ÐµÑ‚ÑÑ ~${prediction} ÑÐµÑÑÐ¸Ð¹`
                });
            }
            return (
                <div className="fade-in">
                    <h2 className="section-title">ðŸ“Š Ð Ð°ÑÑˆÐ¸Ñ€ÐµÐ½Ð½Ð°Ñ Ð°Ð½Ð°Ð»Ð¸Ñ‚Ð¸ÐºÐ° Ð¼Ð°ÑÑ‚ÑƒÑ€Ð±Ð°Ñ†Ð¸Ð¸</h2>
                    {allTriggers.length > 0 && (
                        <div style={{ marginBottom: '30px' }}>
                            <div className="form-label" style={{ marginBottom: '10px' }}>Ð¤Ð¸Ð»ÑŒÑ‚Ñ€ Ð¿Ð¾ Ñ‚Ñ€Ð¸Ð³Ð³ÐµÑ€Ð°Ð¼</div>
                            <div className="filter-tags">
                                {allTriggers.map(trigger => (
                                    <button
                                        key={trigger}
                                        className={`filter-tag ${filterTags.includes(trigger) ? 'active' : ''}`}
                                        onClick={() => toggleFilterTag(trigger)}
                                    >
                                        {trigger}
                                    </button>
                                ))}
                            </div>
                            {filterTags.length > 0 && (
                                <div style={{ marginTop: '10px', fontSize: '13px', color: 'var(--text-tertiary)' }}>
                                    ÐŸÐ¾ÐºÐ°Ð·Ð°Ð½Ð¾ ÑÐµÑÑÐ¸Ð¹: {filteredEntries.length} Ð¸Ð· {entries.length}
                                </div>
                            )}
                        </div>
                    )}
                    <div className="quick-stats">
                        <div className="quick-stat">
                            <div className="quick-stat-value">{avgDuration}</div>
                            <div className="quick-stat-label">Ð¡Ñ€ÐµÐ´Ð½ÐµÐµ Ð²Ñ€ÐµÐ¼Ñ (Ð¼Ð¸Ð½)</div>
                        </div>
                        <div className="quick-stat">
                            <div className="quick-stat-value">{orgasmRate}%</div>
                            <div className="quick-stat-label">Ð”Ð¾ÑÑ‚Ð¸Ð¶ÐµÐ½Ð¸Ðµ Ð¾Ñ€Ð³Ð°Ð·Ð¼Ð°</div>
                        </div>
                        <div className="quick-stat">
                            <div className="quick-stat-value">{contentRate}%</div>
                            <div className="quick-stat-label">Ð¡ ÐºÐ¾Ð½Ñ‚ÐµÐ½Ñ‚Ð¾Ð¼</div>
                        </div>
                        <div className="quick-stat">
                            <div className="quick-stat-value">{avgArousal.toFixed(1)}</div>
                            <div className="quick-stat-label">Ð¡Ñ€ÐµÐ´Ð½ÐµÐµ Ð²Ð¾Ð·Ð±ÑƒÐ¶Ð´ÐµÐ½Ð¸Ðµ</div>
                        </div>
                    </div>
                    {prediction > 0 && (
                        <div className="prediction-card">
                            <h3 className="section-title">ðŸ”® ÐŸÑ€Ð¾Ð³Ð½Ð¾Ð· Ð¸ Ñ‚Ñ€ÐµÐ½Ð´Ñ‹</h3>
                            <div className="prediction-item">
                                <div className="comparison-label">ÐŸÑ€Ð¾Ð³Ð½Ð¾Ð· Ð½Ð° ÑÑ‚Ñƒ Ð½ÐµÐ´ÐµÐ»ÑŽ</div>
                                <div className="comparison-value" style={{ color: 'var(--chart-2)' }}>~{prediction}</div>
                            </div>
                            <div className="prediction-item">
                                <div className="comparison-label">Ð¡Ñ€ÐµÐ´Ð½ÑÑ Ñ‡Ð°ÑÑ‚Ð¾Ñ‚Ð° (4 Ð½ÐµÐ´ÐµÐ»Ð¸)</div>
                                <div className="comparison-value" style={{ color: 'var(--chart-3)' }}>{(prediction).toFixed(1)}/Ð½ÐµÐ´</div>
                            </div>
                        </div>
                    )}
                    {insights.length > 0 && (
                        <div className="insights-card">
                            <h3 className="section-title">ðŸ’¡ Ð˜Ð½ÑÐ°Ð¹Ñ‚Ñ‹ Ð¸ Ð¿Ð°Ñ‚Ñ‚ÐµÑ€Ð½Ñ‹</h3>
                            {insights.map((insight, idx) => (
                                <div key={idx} className="insight-item">
                                    <div className="insight-icon">{insight.icon}</div>
                                    <div className="insight-text">
                                        <div className="insight-title">{insight.title}</div>
                                        <div className="insight-desc">{insight.desc}</div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}
                    <div className="comparison-card">
                        <h3 className="section-title">Ð¡Ñ€Ð°Ð²Ð½ÐµÐ½Ð¸Ðµ Ð¼ÐµÑÑÑ†ÐµÐ²</h3>
                        <div className="comparison-item">
                            <div className="comparison-label">Ð­Ñ‚Ð¾Ñ‚ Ð¼ÐµÑÑÑ†</div>
                            <div className="comparison-value">{comparison.thisMonth}</div>
                        </div>
                        <div className="comparison-item">
                            <div className="comparison-label">ÐŸÑ€Ð¾ÑˆÐ»Ñ‹Ð¹ Ð¼ÐµÑÑÑ†</div>
                            <div className="comparison-value">{comparison.lastMonth}</div>
                        </div>
                        <div className="comparison-item">
                            <div className="comparison-label">Ð˜Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ</div>
                            <div className={`comparison-value ${comparison.diff < 0 ? 'positive' : comparison.diff > 0 ? 'negative' : ''}`}>
                                {comparison.diff > 0 ? '+' : ''}{comparison.diff} ({comparison.percent > 0 ? '+' : ''}{comparison.percent}%)
                            </div>
                        </div>
                    </div>
                    {triggerHeatmap.topTriggers.length > 0 && (
                        <div className="trigger-heatmap">
                            <h3 className="section-title">ðŸ—“ï¸ Ð¢Ñ€Ð¸Ð³Ð³ÐµÑ€Ñ‹ Ð¿Ð¾ Ð´Ð½ÑÐ¼ Ð½ÐµÐ´ÐµÐ»Ð¸</h3>
                            <div className="trigger-heatmap-grid">
                                <div></div>
                                {triggerHeatmap.days.map(day => (
                                    <div key={day} className="trigger-heatmap-label">{day}</div>
                                ))}
                                {triggerHeatmap.topTriggers.map(trigger => (
                                    <React.Fragment key={trigger}>
                                        <div className="trigger-heatmap-label" style={{ textAlign: 'left', minWidth: '100px' }}>{trigger}</div>
                                        {triggerHeatmap.data[trigger].map((count, idx) => {
                                            const maxCount = Math.max(...triggerHeatmap.data[trigger]);
                                            const intensity = maxCount > 0 ? count / maxCount : 0;
                                            const bgColor = intensity === 0 ? 'var(--bg-tertiary)' : `rgba(255, 107, 157, ${0.2 + intensity * 0.7})`;
                                            return (
                                                <div key={idx} className="trigger-heatmap-cell" style={{ background: bgColor }}>
                                                    {count > 0 ? count : ''}
                                                </div>
                                            );
                                        })}
                                    </React.Fragment>
                                ))}
                            </div>
                        </div>
                    )}
                    <div className="analytics-grid">
                        <div className="analytics-card">
                            <h3>ðŸ“ˆ Ð§Ð°ÑÑ‚Ð¾Ñ‚Ð° Ð¿Ð¾ Ð¼ÐµÑÑÑ†Ð°Ð¼</h3>
                            <div style={{ height: '200px' }}>
                                <canvas ref={chartRef}></canvas>
                            </div>
                        </div>
                        <div className="analytics-card">
                            <h3>ðŸ“Š Ð¢Ñ€ÐµÐ½Ð´ Ð¿Ð¾ Ð½ÐµÐ´ÐµÐ»ÑÐ¼</h3>
                            <div style={{ height: '200px' }}>
                                <canvas ref={weeklyTrendRef}></canvas>
                            </div>
                        </div>
                    </div>
                    <div className="analytics-grid">
                        <div className="analytics-card">
                            <h3>â±ï¸ Ð”Ð»Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ñ… ÑÐµÑÑÐ¸Ð¹</h3>
                            <div style={{ height: '200px' }}>
                                <canvas ref={durationChartRef}></canvas>
                            </div>
                        </div>
                    </div>
                    <div className="analytics-grid">
                        <div className="analytics-card">
                            <h3>â° Ð’Ñ€ÐµÐ¼Ñ ÑÑƒÑ‚Ð¾Ðº</h3>
                            <div className="bar-chart">
                                {timeData.map(item => (
                                    <div key={item.label} className="bar-item">
                                        <div className="bar-label">{item.label}</div>
                                        <div className="bar-visual">
                                            <div className="bar-fill" style={{ width: `${(item.value / maxTime) * 100}%` }}></div>
                                        </div>
                                        <div className="bar-value">{item.value}</div>
                                    </div>
                                ))}
                            </div>
                        </div>
                        <div className="analytics-card">
                            <h3>ðŸ“… Ð”Ð½Ð¸ Ð½ÐµÐ´ÐµÐ»Ð¸</h3>
                            <div className="bar-chart">
                                {dayData.map(item => (
                                    <div key={item.label} className="bar-item">
                                        <div className="bar-label">{item.label}</div>
                                        <div className="bar-visual">
                                            <div className="bar-fill" style={{ width: `${(item.value / maxDay) * 100}%` }}></div>
                                        </div>
                                        <div className="bar-value">{item.value}</div>
                                    </div>
                                ))}
                            </div>
                        </div>
                        {triggers.length > 0 && (
                            <div className="analytics-card">
                                <h3>ðŸŽ¯ Ð¢Ð¾Ð¿ Ñ‚Ñ€Ð¸Ð³Ð³ÐµÑ€Ð¾Ð²</h3>
                                <div className="bar-chart">
                                    {triggers.map(item => (
                                        <div key={item.label} className="bar-item">
                                            <div className="bar-label" style={{ minWidth: '120px', fontSize: '12px' }}>{item.label}</div>
                                            <div className="bar-visual">
                                                <div className="bar-fill" style={{ width: `${(item.value / maxTrigger) * 100}%` }}></div>
                                            </div>
                                            <div className="bar-value">{item.value}</div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}
                        {moods.length > 0 && (
                            <div className="analytics-card">
                                <h3>ðŸ˜Š Ð¢Ð¾Ð¿ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½Ð¸Ð¹ Ð¿Ð¾ÑÐ»Ðµ</h3>
                                <div className="bar-chart">
                                    {moods.map(item => (
                                        <div key={item.label} className="bar-item">
                                            <div className="bar-label" style={{ minWidth: '120px', fontSize: '12px' }}>{item.label}</div>
                                            <div className="bar-visual">
                                                <div className="bar-fill" style={{ width: `${(item.value / maxMood) * 100}%` }}></div>
                                            </div>
                                            <div className="bar-value">{item.value}</div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }
        function History({ entries, onDeleteEntry, onEditEntry, editingEntry, setEditingEntry, filterTags, setFilterTags }) {
            const allTriggers = [...new Set(entries.flatMap(e => e.triggers || []))];
            const filteredEntries = filterTags.length > 0
                ? entries.filter(e => e.triggers?.some(trigger => filterTags.includes(trigger)))
                : entries;
            const sortedEntries = [...filteredEntries].sort((a, b) => {
                const dateA = new Date(a.date + 'T' + a.time);
                const dateB = new Date(b.date + 'T' + b.time);
                return dateB - dateA;
            });
            const toggleFilterTag = (tag) => {
                if (filterTags.includes(tag)) {
                    setFilterTags(filterTags.filter(t => t !== tag));
                } else {
                    setFilterTags([...filterTags, tag]);
                }
            };
            return (
                <div className="fade-in">
                    <h2 className="section-title">ðŸ“ Ð˜ÑÑ‚Ð¾Ñ€Ð¸Ñ Ð¼Ð°ÑÑ‚ÑƒÑ€Ð±Ð°Ñ†Ð¸Ð¸ ({filteredEntries.length} Ð·Ð°Ð¿Ð¸ÑÐµÐ¹)</h2>
                    {allTriggers.length > 0 && (
                        <div style={{ marginBottom: '30px' }}>
                            <div className="form-label" style={{ marginBottom: '10px' }}>Ð¤Ð¸Ð»ÑŒÑ‚Ñ€ Ð¿Ð¾ Ñ‚Ñ€Ð¸Ð³Ð³ÐµÑ€Ð°Ð¼</div>
                            <div className="filter-tags">
                                {allTriggers.map(trigger => (
                                    <button
                                        key={trigger}
                                        className={`filter-tag ${filterTags.includes(trigger) ? 'active' : ''}`}
                                        onClick={() => toggleFilterTag(trigger)}
                                    >
                                        {trigger}
                                    </button>
                                ))}
                            </div>
                        </div>
                    )}
                    {sortedEntries.length === 0 && (
                        <div style={{ textAlign: 'center', padding: '60px 20px', color: 'var(--text-tertiary)' }}>
                            {filterTags.length > 0 ? 'ÐÐµÑ‚ Ð·Ð°Ð¿Ð¸ÑÐµÐ¹ Ñ Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½Ñ‹Ð¼Ð¸ Ñ‚Ñ€Ð¸Ð³Ð³ÐµÑ€Ð°Ð¼Ð¸' : 'Ð—Ð°Ð¿Ð¸ÑÐµÐ¹ Ð¿Ð¾ÐºÐ° Ð½ÐµÑ‚'}
                        </div>
                    )}
                    {sortedEntries.map(entry => (
                        <div key={entry.id} className="history-item" onClick={() => setEditingEntry(entry)}>
                            <div className="history-header">
                                <div className="history-date">{parseLocalDate(entry.date).toLocaleDateString('ru-RU', { day: 'numeric', month: 'long', year: 'numeric' })}</div>
                                <div className="history-time">â° {entry.time}</div>
                            </div>
                            <div className="history-details">
                                <span className="history-badge">ÐœÐ°ÑÑ‚ÑƒÑ€Ð±Ð°Ñ†Ð¸Ñ</span>
                                {entry.triggers && entry.triggers.length > 0 && entry.triggers.map(trigger => (
                                    <span key={trigger} className="history-badge">{trigger}</span>
                                ))}
                            </div>
                            {entry.mood && <div className="history-field">ÐÐ°ÑÑ‚Ñ€Ð¾ÐµÐ½Ð¸Ðµ Ð¿Ð¾ÑÐ»Ðµ: {entry.mood}</div>}
                            <div className="history-field">Ð’Ð¾Ð·Ð±ÑƒÐ¶Ð´ÐµÐ½Ð¸Ðµ Ð¿ÐµÑ€ÐµÐ´: {entry.arousalLevel}/10</div>
                            <div className="history-field">ÐœÐµÑÑ‚Ð¾: {entry.location}</div>
                            <div className="history-field">Ð”Ð»Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ: {entry.duration} Ð¼Ð¸Ð½</div>
                            <div className="history-field">ÐšÐ¾Ð½Ñ‚ÐµÐ½Ñ‚: {entry.contentUsed ? 'Ð”Ð°' : 'ÐÐµÑ‚'}</div>
                            <div className="history-field">ÐžÑ€Ð³Ð°Ð·Ð¼: {entry.orgasm ? 'Ð”Ð°' : 'ÐÐµÑ‚'}</div>
                            {entry.note && <div className="history-field">Ð—Ð°Ð¼ÐµÑ‚ÐºÐ¸: {entry.note}</div>}
                            <div style={{ marginTop: '10px', display: 'flex', gap: '10px' }}>
                                <button className="edit-btn" onClick={(e) => { e.stopPropagation(); setEditingEntry(entry); }}>
                                    âœï¸ Ð ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ
                                </button>
                                <button className="delete-btn" style={{ padding: '8px 16px', fontSize: '12px' }} onClick={(e) => {
                                    e.stopPropagation();
                                    if (confirm('Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ ÑÑ‚Ñƒ Ð·Ð°Ð¿Ð¸ÑÑŒ Ð¾ Ð¼Ð°ÑÑ‚ÑƒÑ€Ð±Ð°Ñ†Ð¸Ð¸?')) onDeleteEntry(entry.id);
                                }}>
                                    ðŸ—‘ï¸ Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ
                                </button>
                            </div>
                        </div>
                    ))}
                </div>
            );
        }
        function Calendar({ entries }) {
            const [currentDate, setCurrentDate] = useState(new Date());
            const [showModal, setShowModal] = useState(false);
            const [selectedDay, setSelectedDay] = useState(null);
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            const monthName = currentDate.toLocaleDateString('ru-RU', { month: 'long', year: 'numeric' });
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startDayOfWeek = firstDay.getDay();
            const weekDays = ['Ð’Ñ', 'ÐŸÐ½', 'Ð’Ñ‚', 'Ð¡Ñ€', 'Ð§Ñ‚', 'ÐŸÑ‚', 'Ð¡Ð±'];
            const calendarDays = [];
            for (let i = 0; i < startDayOfWeek; i++) {
                calendarDays.push({ isEmpty: true, key: `empty-${i}` });
            }
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month, day);
                const dateStr = formatLocalDate(date);
                const dayEntries = entries.filter(e => e.date === dateStr);
                let activityLevel = '';
                if (dayEntries.length > 0) {
                    if (dayEntries.length === 1) activityLevel = 'low';
                    else if (dayEntries.length === 2) activityLevel = 'medium';
                    else activityLevel = 'high';
                }
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                const isToday = date.getTime() === today.getTime();
                calendarDays.push({
                    day,
                    date,
                    dateStr,
                    entries: dayEntries,
                    activityLevel,
                    isToday,
                    isEmpty: false,
                    key: `day-${day}`
                });
            }
            const handleDayClick = (date, dayEntries) => {
                if (dayEntries.length > 0) {
                    setSelectedDay({ date, entries: dayEntries });
                    setShowModal(true);
                }
            };
            const yearlyData = [];
            const startOfYear = new Date(year, 0, 1);
            const endOfYear = new Date(year, 11, 31);
            let currentWeek = [];
            let weekStartDay = startOfYear.getDay();
            for (let i = 0; i < weekStartDay; i++) {
                currentWeek.push(null);
            }
            for (let d = new Date(startOfYear); d <= endOfYear; d.setDate(d.getDate() + 1)) {
                const dateStr = formatLocalDate(d);
                const dayEntries = entries.filter(e => e.date === dateStr);
                currentWeek.push({
                    date: new Date(d),
                    count: dayEntries.length
                });
                if (currentWeek.length === 7) {
                    yearlyData.push(currentWeek);
                    currentWeek = [];
                }
            }
            if (currentWeek.length > 0) {
                while (currentWeek.length < 7) {
                    currentWeek.push(null);
                }
                yearlyData.push(currentWeek);
            }
            const months = ['Ð¯Ð½Ð²', 'Ð¤ÐµÐ²', 'ÐœÐ°Ñ€', 'ÐÐ¿Ñ€', 'ÐœÐ°Ð¹', 'Ð˜ÑŽÐ½', 'Ð˜ÑŽÐ»', 'ÐÐ²Ð³', 'Ð¡ÐµÐ½', 'ÐžÐºÑ‚', 'ÐÐ¾Ñ', 'Ð”ÐµÐº'];
            return (
                <div className="fade-in">
                    <h2 className="section-title">ðŸ“… ÐšÐ°Ð»ÐµÐ½Ð´Ð°Ñ€ÑŒ Ð¼Ð°ÑÑ‚ÑƒÑ€Ð±Ð°Ñ†Ð¸Ð¸</h2>
                    <div className="heatmap-container">
                        <h3 style={{ marginBottom: '20px', fontSize: '16px', fontWeight: '600' }}>ðŸ”¥ ÐšÐ°Ñ€Ñ‚Ð° Ð°ÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚Ð¸ {year} Ð³Ð¾Ð´Ð°</h3>
                        <div className="heatmap-grid">
                            {months.map(month => <div key={month} className="heatmap-month-label">{month}</div>)}
                            {months.map(() => <div key={Math.random()}></div>)}
                            {yearlyData.map((week, weekIdx) => (
                                <React.Fragment key={weekIdx}>
                                    {weekIdx === 0 && <div></div>}
                                    {week.map((day, dayIdx) => (
                                        day === null ? <div key={`${weekIdx}-${dayIdx}`}></div> :
                                        <div key={`${weekIdx}-${dayIdx}`} className={`heatmap-cell ${day.count === 0 ? '' : `level-${Math.min(day.count, 4)}`}`} title={`${day.date.toLocaleDateString('ru-RU')}: ${day.count} ÑÐµÑÑÐ¸Ð¹ Ð¼Ð°ÑÑ‚ÑƒÑ€Ð±Ð°Ñ†Ð¸Ð¸`}></div>
                                    ))}
                                </React.Fragment>
                            ))}
                        </div>
                    </div>
                    <div className="calendar-container">
                        <div className="calendar-header">
                            <div className="calendar-month">{monthName}</div>
                            <div style={{ display: 'flex', gap: '10px', flexWrap: 'wrap' }}>
                                <button className="calendar-nav-btn" onClick={() => setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() - 1, 1))}>â† ÐÐ°Ð·Ð°Ð´</button>
                                <button className="calendar-nav-btn" onClick={() => setCurrentDate(new Date())}>Ð¡ÐµÐ³Ð¾Ð´Ð½Ñ</button>
                                <button className="calendar-nav-btn" onClick={() => setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 1))}>Ð’Ð¿ÐµÑ€Ñ‘Ð´ â†’</button>
                            </div>
                        </div>
                        <div className="calendar-grid">
                            {weekDays.map(day => <div key={day} className="calendar-day-label">{day}</div>)}
                        </div>
                        <div className="calendar-grid">
                            {calendarDays.map(dayInfo => {
                                if (dayInfo.isEmpty) {
                                    return <div key={dayInfo.key} className="calendar-day empty"></div>;
                                }
                                return (
                                    <div key={dayInfo.key} className={`calendar-day ${dayInfo.activityLevel} ${dayInfo.isToday ? 'today' : ''}`} onClick={() => handleDayClick(dayInfo.date, dayInfo.entries)}>
                                        <div className="calendar-day-number">{dayInfo.day}</div>
                                        {dayInfo.entries.length > 0 && <div className="calendar-day-count">{dayInfo.entries.length}</div>}
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                    {showModal && selectedDay && (
                        <>
                            <div className="modal-overlay" onClick={() => setShowModal(false)}></div>
                            <div className="day-detail-modal">
                                <div className="modal-header">
                                    <div className="modal-title">{selectedDay.date.toLocaleDateString('ru-RU', { day: 'numeric', month: 'long', year: 'numeric' })}</div>
                                    <button className="modal-close" onClick={() => setShowModal(false)}>Ã—</button>
                                </div>
                                <div style={{ marginBottom: '15px', color: 'var(--text-secondary)' }}>
                                    Ð¡ÐµÑÑÐ¸Ð¹ Ð¼Ð°ÑÑ‚ÑƒÑ€Ð±Ð°Ñ†Ð¸Ð¸: {selectedDay.entries.length}
                                </div>
                                {selectedDay.entries.map(entry => (
                                    <div key={entry.id} className="modal-entry">
                                        <div className="modal-entry-time">â° {entry.time}</div>
                                        <div className="history-details">
                                            <span className="history-badge">ÐœÐ°ÑÑ‚ÑƒÑ€Ð±Ð°Ñ†Ð¸Ñ</span>
                                            {entry.triggers && entry.triggers.length > 0 && entry.triggers.map(trigger => (
                                                <span key={trigger} className="history-badge">{trigger}</span>
                                            ))}
                                        </div>
                                        {entry.mood && <div className="history-field">ÐÐ°ÑÑ‚Ñ€Ð¾ÐµÐ½Ð¸Ðµ: {entry.mood}</div>}
                                        <div className="history-field">Ð’Ð¾Ð·Ð±ÑƒÐ¶Ð´ÐµÐ½Ð¸Ðµ: {entry.arousalLevel}/10</div>
                                        <div className="history-field">ÐœÐµÑÑ‚Ð¾: {entry.location}</div>
                                        <div className="history-field">Ð”Ð»Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ: {entry.duration} Ð¼Ð¸Ð½</div>
                                        <div className="history-field">ÐšÐ¾Ð½Ñ‚ÐµÐ½Ñ‚: {entry.contentUsed ? 'Ð”Ð°' : 'ÐÐµÑ‚'}</div>
                                        <div className="history-field">ÐžÑ€Ð³Ð°Ð·Ð¼: {entry.orgasm ? 'Ð”Ð°' : 'ÐÐµÑ‚'}</div>
                                        {entry.note && <div className="history-field">Ð—Ð°Ð¼ÐµÑ‚ÐºÐ¸: {entry.note}</div>}
                                    </div>
                                ))}
                            </div>
                        </>
                    )}
                </div>
            );
        }
        function Achievements({ entries, unlockedAchievements, userSettings, getStreak }) {
            const streak = getStreak();
            const calculateProgress = (achievementId) => {
                switch(achievementId) {
                    case 'first_entry':
                        return entries.length >= 1 ? 100 : 0;
                    case 'week_streak':
                        return Math.min((streak / 7) * 100, 100);
                    case 'month_control':
                        const thisMonth = formatLocalDate(new Date()).slice(0, 7);
                        const monthEntries = entries.filter(entry => entry.date.startsWith(thisMonth));
                        return monthEntries.length > 0 ? Math.min((monthEntries.length / userSettings.monthlyLimit) * 100, 100) : 0;
                    case 'two_week_streak':
                        return Math.min((streak / 14) * 100, 100);
                    case 'month_streak':
                        return Math.min((streak / 30) * 100, 100);
                    case 'total_100':
                        return Math.min((entries.length / 100) * 100, 100);
                    case 'low_frequency':
                        const lastWeekEntries = entries.filter(e => {
                            const weekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);
                            return parseLocalDate(e.date) >= weekAgo;
                        });
                        return lastWeekEntries.length <= 1 ? 100 : 50;
                    case 'no_content_week':
                        const lastWeekNoContent = entries.filter(e => {
                            const weekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);
                            return parseLocalDate(e.date) >= weekAgo && !e.contentUsed;
                        });
                        return Math.min((lastWeekNoContent.length / 5) * 100, 100);
                    case 'three_month_streak':
                        return Math.min((streak / 90) * 100, 100);
                    case 'consistent_tracker':
                        let consecutiveDays = 0;
                        const today = new Date();
                        for (let i = 0; i < 30; i++) {
                            const checkDate = new Date(today);
                            checkDate.setDate(checkDate.getDate() - i);
                            const dateStr = formatLocalDate(checkDate);
                            const hasEntry = entries.some(e => e.date === dateStr);
                            if (!hasEntry) break;
                            consecutiveDays++;
                        }
                        return Math.min((consecutiveDays / 30) * 100, 100);
                    case 'early_bird':
                        return 0;
                    case 'night_owl':
                        return 0;
                    default:
                        return 0;
                }
            };
            return (
                <div className="fade-in">
                    <h2 className="section-title">ðŸ† Ð”Ð¾ÑÑ‚Ð¸Ð¶ÐµÐ½Ð¸Ñ Ð² ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»Ðµ ({unlockedAchievements.length}/{ACHIEVEMENTS.length})</h2>
                    <div className="achievements-grid">
                        {ACHIEVEMENTS.map(achievement => {
                            const isUnlocked = unlockedAchievements.includes(achievement.id);
                            const progress = calculateProgress(achievement.id);
                            return (
                                <div key={achievement.id} className={`achievement-card ${isUnlocked ? 'unlocked' : 'locked'}`}>
                                    <div className="achievement-icon">{achievement.icon}</div>
                                    <div className="achievement-title">{achievement.title}</div>
                                    <div className="achievement-desc">{achievement.desc}</div>
                                    {!isUnlocked && (
                                        <div className="achievement-progress">
                                            <div className="achievement-progress-bar" style={{ width: `${progress}%` }}></div>
                                        </div>
                                    )}
                                </div>
                            );
                        })}
                    </div>
                </div>
            );
        }
        function Settings({ userSettings, setUserSettings, entries }) {
            const [localSettings, setLocalSettings] = useState(userSettings);
            const handleSave = () => {
                localStorage.setItem('userSettings', JSON.stringify(localSettings));
                setUserSettings(localSettings);
                document.documentElement.setAttribute('data-theme', localSettings.theme);
                showSuccessNotification('ðŸ’¾ ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ñ‹!');
            };
            const handleExport = () => {
                const headers = 'id,date,time,type,mood,arousalLevel,location,duration,contentUsed,orgasm,triggers,note\n';
                const rows = entries.map(e => [
                    e.id,
                    e.date,
                    e.time,
                    e.type,
                    e.mood || '',
                    e.arousalLevel,
                    e.location,
                    e.duration,
                    e.contentUsed ? 'Ð”Ð°' : 'ÐÐµÑ‚',
                    e.orgasm ? 'Ð”Ð°' : 'ÐÐµÑ‚',
                    `"${(e.triggers || []).join('; ')}"`,
                    `"${(e.note || '').replace(/"/g, '""')}"`
                ].join(',')).join('\n');
                const csv = headers + rows;
                const dataBlob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `masturbation-tracker-${formatLocalDate(new Date())}.csv`;
                link.click();
                showSuccessNotification('ðŸ“¥ Ð”Ð°Ð½Ð½Ñ‹Ðµ ÑÐºÑÐ¿Ð¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ñ‹');
            };
            const handleReset = () => {
                if (confirm('Ð’ÐÐ˜ÐœÐÐÐ˜Ð•: Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ Ð’Ð¡Ð• Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¾ Ð¼Ð°ÑÑ‚ÑƒÑ€Ð±Ð°Ñ†Ð¸Ð¸? Ð­Ñ‚Ð¾ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ Ð½ÐµÐ»ÑŒÐ·Ñ Ð¾Ñ‚Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ!')) {
                    if (confirm('Ð¢Ñ‹ Ð°Ð±ÑÐ¾Ð»ÑŽÑ‚Ð½Ð¾ ÑƒÐ²ÐµÑ€ÐµÐ½? Ð’ÑÐµ Ð·Ð°Ð¿Ð¸ÑÐ¸ Ð±ÑƒÐ´ÑƒÑ‚ ÑƒÐ´Ð°Ð»ÐµÐ½Ñ‹ Ð½Ð°Ð²ÑÐµÐ³Ð´Ð°.')) {
                        indexedDB.deleteDatabase(DB_NAME);
                        localStorage.clear();
                        window.location.reload();
                    }
                }
            };
            const handleBackup = () => {
                const backup = {
                    entries: entries,
                    settings: userSettings,
                    achievements: JSON.parse(localStorage.getItem('achievements') || '[]'),
                    nofapMode: localStorage.getItem('nofapMode'),
                    nofapStartDate: localStorage.getItem('nofapStartDate'),
                    nofapHistory: JSON.parse(localStorage.getItem('nofapHistory') || '[]'),
                    timestamp: new Date().toISOString()
                };
                const dataStr = JSON.stringify(backup, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `masturbation-tracker-backup-${formatLocalDate(new Date())}.json`;
                link.click();
                showSuccessNotification('ðŸ’¾ Ð ÐµÐ·ÐµÑ€Ð²Ð½Ð°Ñ ÐºÐ¾Ð¿Ð¸Ñ ÑÐ¾Ð·Ð´Ð°Ð½Ð°');
            };
            return (
                <div className="fade-in">
                    <h2 className="section-title">âš™ï¸ ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Ñ‚Ñ€ÐµÐºÐµÑ€Ð° Ð¼Ð°ÑÑ‚ÑƒÑ€Ð±Ð°Ñ†Ð¸Ð¸</h2>
                    <div className="entry-form">
                        <h3 style={{ marginBottom: '20px', fontSize: '18px' }}>Ð›Ð¸Ð¼Ð¸Ñ‚Ñ‹ Ð¸ Ñ†ÐµÐ»Ð¸</h3>
                        <div className="form-group">
                            <label className="form-label">Ð›Ð¸Ð¼Ð¸Ñ‚ Ð² Ð´ÐµÐ½ÑŒ: {localSettings.dailyLimit}</label>
                            <input type="range" min="0" max="5" value={localSettings.dailyLimit} onChange={(e) => setLocalSettings({ ...localSettings, dailyLimit: parseInt(e.target.value) })} className="slider" />
                        </div>
                        <div className="form-group">
                            <label className="form-label">Ð›Ð¸Ð¼Ð¸Ñ‚ Ð² Ð½ÐµÐ´ÐµÐ»ÑŽ: {localSettings.weeklyLimit}</label>
                            <input type="range" min="0" max="20" value={localSettings.weeklyLimit} onChange={(e) => setLocalSettings({ ...localSettings, weeklyLimit: parseInt(e.target.value) })} className="slider" />
                        </div>
                        <div className="form-group">
                            <label className="form-label">Ð›Ð¸Ð¼Ð¸Ñ‚ Ð² Ð¼ÐµÑÑÑ†: {localSettings.monthlyLimit}</label>
                            <input type="range" min="0" max="50" value={localSettings.monthlyLimit} onChange={(e) => setLocalSettings({ ...localSettings, monthlyLimit: parseInt(e.target.value) })} className="slider" />
                        </div>
                        <div className="form-group">
                            <label className="form-label">Ð¦ÐµÐ»ÑŒ NoFap (Ð´Ð½ÐµÐ¹): {localSettings.goalDays}</label>
                            <input type="range" min="1" max="90" value={localSettings.goalDays} onChange={(e) => setLocalSettings({ ...localSettings, goalDays: parseInt(e.target.value) })} className="slider" />
                        </div>
                        <div className="form-group">
                            <label className="checkbox-label">
                                <input type="checkbox" checked={localSettings.adviceEnabled} onChange={(e) => setLocalSettings({ ...localSettings, adviceEnabled: e.target.checked })} className="checkbox" />
                                ÐŸÐ¾ÐºÐ°Ð·Ñ‹Ð²Ð°Ñ‚ÑŒ ÑÐ¾Ð²ÐµÑ‚Ñ‹ Ð¸ Ð¿Ñ€ÐµÐ´ÑƒÐ¿Ñ€ÐµÐ¶Ð´ÐµÐ½Ð¸Ñ
                            </label>
                        </div>
                        <button className="action-btn" onClick={handleSave}>ðŸ’¾ Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸</button>
                    </div>
                    <div className="entry-form" style={{ marginTop: '30px' }}>
                        <h3 style={{ marginBottom: '20px', fontSize: '18px' }}>Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð´Ð°Ð½Ð½Ñ‹Ð¼Ð¸</h3>
                        <div style={{ display: 'flex', gap: '15px', flexWrap: 'wrap' }}>
                            <button className="nav-btn" onClick={handleExport}>ðŸ“¥ Ð­ÐºÑÐ¿Ð¾Ñ€Ñ‚ Ð² CSV</button>
                            <button className="nav-btn" onClick={handleBackup}>ðŸ’¾ Ð ÐµÐ·ÐµÑ€Ð²Ð½Ð°Ñ ÐºÐ¾Ð¿Ð¸Ñ</button>
                            <button className="delete-btn" onClick={handleReset}>ðŸ—‘ï¸ Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ Ð²ÑÐµ Ð´Ð°Ð½Ð½Ñ‹Ðµ</button>
                        </div>
                    </div>
                    <div style={{ marginTop: '40px', padding: '20px', background: 'var(--bg-secondary)', borderRadius: '12px', fontSize: '14px', color: 'var(--text-secondary)' }}>
                        <p><strong>ðŸ”’ Ðž Ð¿Ñ€Ð¸Ð²Ð°Ñ‚Ð½Ð¾ÑÑ‚Ð¸:</strong></p>
                        <p style={{ marginTop: '10px' }}>Ð’ÑÐµ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ñ…Ñ€Ð°Ð½ÑÑ‚ÑÑ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð² Ñ‚Ð²Ð¾Ñ‘Ð¼ Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€Ðµ. ÐÐ¸Ñ‡ÐµÐ³Ð¾ Ð½Ðµ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÑ‚ÑÑ Ð½Ð° ÑÐµÑ€Ð²ÐµÑ€.</p>
                        <p style={{ marginTop: '20px' }}><strong>ðŸŽ¯ Ðž Ñ‚Ñ€ÐµÐºÐµÑ€Ðµ:</strong></p>
                        <p style={{ marginTop: '10px' }}>Ð­Ñ‚Ð¾Ñ‚ Ñ‚Ñ€ÐµÐºÐµÑ€ Ð¿Ñ€ÐµÐ´Ð½Ð°Ð·Ð½Ð°Ñ‡ÐµÐ½ Ð´Ð»Ñ Ð¾ÑÐ¾Ð·Ð½Ð°Ð½Ð½Ð¾Ð³Ð¾ Ð¾Ñ‚Ð½Ð¾ÑˆÐµÐ½Ð¸Ñ Ðº ÑÐ²Ð¾ÐµÐ¹ ÑÐµÐºÑÑƒÐ°Ð»ÑŒÐ½Ð¾ÑÑ‚Ð¸ Ð¸ ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»Ñ Ð½Ð°Ð´ Ð¿Ñ€Ð¸Ð²Ñ‹Ñ‡ÐºÐ°Ð¼Ð¸.</p>
                        <p style={{ marginTop: '5px' }}><strong></strong></p>
                        <ul style={{ marginTop: '10px', paddingLeft: '20px' }}>
                          
                        </ul>
                    </div>
                </div>
            );
        }
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
