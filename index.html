<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Masturbation Tracker</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Manrope:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        :root[data-theme="dark"] {
            --bg-primary: #0a0a0a;
            --bg-secondary: #141414;
            --bg-tertiary: #1a1a1a;
            --text-primary: #ffffff;
            --text-secondary: #a0a0a0;
            --text-tertiary: #606060;
            --accent: #ff6b9d;
            --accent-dim: #ff4d8d;
            --danger: #ff4444;
            --warning: #ffaa00;
            --success: #4ade80;
            --border: #2a2a2a;
            --shadow: rgba(0, 0, 0, 0.5);
            --chart-1: #ff6b9d;
            --chart-2: #6b8dff;
            --chart-3: #6bffb8;
            --chart-4: #ffaa00;
        }
        :root[data-theme="light"] {
            --bg-primary: #ffffff;
            --bg-secondary: #f5f5f5;
            --bg-tertiary: #ebebeb;
            --text-primary: #0a0a0a;
            --text-secondary: #606060;
            --text-tertiary: #a0a0a0;
            --accent: #ff4d8d;
            --accent-dim: #ff1a75;
            --danger: #dd3333;
            --warning: #e69500;
            --success: #22c55e;
            --border: #e0e0e0;
            --shadow: rgba(0, 0, 0, 0.1);
            --chart-1: #ff4d8d;
            --chart-2: #4d6bff;
            --chart-3: #4dffa6;
            --chart-4: #ff9500;
        }
        

        body.theme-dark {
            --bg-primary: #0a0a0a;
            --bg-secondary: #141414;
            --bg-tertiary: #1a1a1a;
            --text-primary: #ffffff;
            --text-secondary: #a0a0a0;
            --text-tertiary: #606060;
            --accent: #ff6b9d;
            --accent-dim: #ff4d8d;
            --danger: #ff4444;
            --warning: #ffaa00;
            --success: #4ade80;
            --border: #2a2a2a;
            --shadow: rgba(0, 0, 0, 0.5);
            --chart-1: #ff6b9d;
            --chart-2: #6b8dff;
            --chart-3: #6bffb8;
            --chart-4: #ffaa00;
        }
        body.theme-light {
            --bg-primary: #ffffff;
            --bg-secondary: #f5f5f5;
            --bg-tertiary: #ebebeb;
            --text-primary: #0a0a0a;
            --text-secondary: #606060;
            --text-tertiary: #a0a0a0;
            --accent: #ff4d8d;
            --accent-dim: #ff1a75;
            --danger: #dd3333;
            --warning: #e69500;
            --success: #22c55e;
            --border: #e0e0e0;
            --shadow: rgba(0, 0, 0, 0.1);
            --chart-1: #ff4d8d;
            --chart-2: #4d6bff;
            --chart-3: #4dffa6;
            --chart-4: #ff9500;
        }
body {
            font-family: 'Manrope', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
            transition: background 0.3s ease, color 0.3s ease;
        }
        .app-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }
        .header {
            position: sticky;
            top: 0;
            z-index: 500;
            background: rgba(10, 10, 10, 0.85);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border);
            margin-bottom: 20px;
        }
        [data-theme="light"] .header,
        body.theme-light .header {
            background: rgba(255, 255, 255, 0.85);
        }
        .header-bar {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            align-items: center;
            gap: 12px;
            padding: 16px 0;
        }
        .header-left {
            display: flex;
            align-items: center;
            justify-content: flex-start;
        }
        .header-actions {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: 8px;
        }
        .icon-btn {
            width: 44px;
            height: 44px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .icon-btn:hover {
            border-color: var(--accent);
            transform: translateY(-1px);
        }
        .icon-btn:active {
            transform: translateY(0);
        }
        .top-nav {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            padding-bottom: 14px;
        }

        .logo {
            font-family: 'JetBrains Mono', monospace;
            font-size: 24px;
            font-weight: 700;
            letter-spacing: -0.02em;
            background: linear-gradient(135deg, var(--accent) 0%, #ff8e6b 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientShift 3s ease infinite;
        }
        @keyframes gradientShift {
            0%, 100% { filter: hue-rotate(0deg); }
            50% { filter: hue-rotate(10deg); }
        }
        .header-right {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        .theme-toggle {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            color: var(--text-primary);
            padding: 10px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.2s ease;
        }
        .theme-toggle:hover {
            background: var(--accent);
            border-color: var(--accent);
            transform: scale(1.05);
        }
        .nav {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .nav-btn {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-secondary);
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Manrope', sans-serif;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        .nav-btn:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border-color: var(--accent);
            transform: translateY(-2px);
        }
        .nav-btn.active {
            background: var(--accent);
            color: var(--bg-primary);
            border-color: var(--accent);
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(255, 107, 157, 0.3);
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        .stat-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 24px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        .stat-card:hover {
            transform: translateY(-4px);
            border-color: var(--accent);
            box-shadow: 0 10px 40px var(--shadow);
        }
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--accent), #ff8e6b);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .stat-card:hover::before {
            opacity: 1;
        }
        .stat-label {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-tertiary);
            margin-bottom: 8px;
            font-weight: 600;
        }
        .stat-value {
            font-size: 36px;
            font-weight: 800;
            font-family: 'JetBrains Mono', monospace;
            color: var(--accent);
            line-height: 1;
            margin-bottom: 8px;
        }
        .stat-sublabel {
            font-size: 14px;
            color: var(--text-secondary);
        }
        .section-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 20px;
            color: var(--text-primary);
        }
        .action-btn {
            background: var(--accent);
            color: var(--bg-primary);
            border: none;
            padding: 14px 28px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: 'Manrope', sans-serif;
        }
        .action-btn:hover {
            background: var(--accent-dim);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 107, 157, 0.3);
        }
        .action-btn:active {
            transform: translateY(0);
        }
        .delete-btn {
            background: var(--danger);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: 'Manrope', sans-serif;
        }
        .delete-btn:hover {
            background: #cc0000;
            transform: translateY(-2px);
        }
        .entry-form {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 40px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }
        .form-input, .form-select, .form-textarea {
            width: 100%;
            background: var(--bg-primary);
            border: 1px solid var(--border);
            color: var(--text-primary);
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 14px;
            font-family: 'Manrope', sans-serif;
            transition: all 0.2s ease;
        }
        .form-textarea {
            min-height: 80px;
            resize: vertical;
        }
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(255, 107, 157, 0.1);
        }
        .tags-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }
        .tag-btn {
            background: var(--bg-primary);
            border: 2px solid var(--border);
            color: var(--text-secondary);
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.2s ease;
            font-family: 'Manrope', sans-serif;
        }
        .tag-btn:hover {
            border-color: var(--accent);
            color: var(--accent);
            transform: scale(1.05);
        }
        .tag-btn.active {
            background: var(--accent);
            border-color: var(--accent);
            color: var(--bg-primary);
            transform: scale(1.05);
        }
        .filter-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }
        .filter-tag {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            color: var(--text-secondary);
            padding: 6px 12px;
            border-radius: 16px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s ease;
        }
        .filter-tag:hover {
            border-color: var(--accent);
            color: var(--accent);
        }
        .filter-tag.active {
            background: var(--accent);
            border-color: var(--accent);
            color: var(--bg-primary);
        }
        .chart-container {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
        }
        .history-item {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        .history-item:hover {
            border-color: var(--accent);
            transform: translateX(4px);
            box-shadow: 0 4px 12px var(--shadow);
        }
        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .history-date {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
        }
        .history-time {
            font-size: 14px;
            color: var(--text-tertiary);
            font-family: 'JetBrains Mono', monospace;
        }
        .history-details {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        .history-badge {
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }
        .history-field {
            font-size: 13px;
            color: var(--text-secondary);
            margin-top: 4px;
        }
        .nofap-container {
            background: linear-gradient(135deg, #1a1a2e 0%, #2e1a1a 100%);
            border: 2px solid var(--accent);
            border-radius: 24px;
            padding: 40px;
            margin-bottom: 40px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        [data-theme="light"] .nofap-container {
            background: linear-gradient(135deg, #f5e8e8 0%, #e6c8c8 100%);
        }
        .nofap-container::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 107, 157, 0.1) 0%, transparent 70%);
            animation: pulse 3s ease-in-out infinite;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }
        .nofap-day-count {
            font-size: 80px;
            font-weight: 900;
            font-family: 'JetBrains Mono', monospace;
            color: var(--accent);
            line-height: 1;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
            animation: bounceIn 0.5s ease;
        }
        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); opacity: 1; }
        }
        .nofap-label {
            font-size: 18px;
            color: var(--text-secondary);
            margin-bottom: 30px;
            position: relative;
            z-index: 1;
        }
        .nofap-milestone {
            background: rgba(255, 107, 157, 0.1);
            border: 1px solid var(--accent);
            border-radius: 12px;
            padding: 15px;
            margin: 20px 0;
            position: relative;
            z-index: 1;
        }
        .nofap-milestone-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--accent);
            margin-bottom: 8px;
        }
        .nofap-milestone-desc {
            font-size: 14px;
            color: var(--text-secondary);
        }
        .nofap-record {
            font-size: 16px;
            color: var(--text-tertiary);
            margin-bottom: 20px;
            position: relative;
            z-index: 1;
        }
        .nofap-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            position: relative;
            z-index: 1;
        }
        .nofap-reset-btn {
            background: var(--danger);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .nofap-reset-btn:hover {
            background: #cc0000;
            transform: scale(1.05);
        }
        .nofap-history {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 20px;
            margin-top: 30px;
        }
        .nofap-attempt {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid var(--border);
        }
        .nofap-attempt:last-child {
            border-bottom: none;
        }
        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .analytics-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 24px;
            transition: all 0.3s ease;
        }
        .analytics-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px var(--shadow);
        }
        .analytics-card h3 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--text-primary);
        }
        .bar-chart {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .bar-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .bar-label {
            min-width: 80px;
            font-size: 13px;
            color: var(--text-secondary);
        }
        .bar-visual {
            flex: 1;
            height: 24px;
            background: var(--bg-tertiary);
            border-radius: 4px;
            position: relative;
            overflow: hidden;
        }
        .bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), #ff8e6b);
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        .bar-value {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
            min-width: 30px;
        }
        .comparison-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
        }
        .comparison-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--border);
        }
        .comparison-item:last-child {
            border-bottom: none;
        }
        .comparison-label {
            font-size: 14px;
            color: var(--text-secondary);
        }
        .comparison-value {
            font-size: 18px;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
        }
        .comparison-value.positive {
            color: var(--success);
        }
        .comparison-value.negative {
            color: var(--danger);
        }
        .fade-in {
            animation: fadeIn 0.5s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .insights-card {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
        }
        .insight-item {
            display: flex;
            align-items: start;
            gap: 15px;
            padding: 15px 0;
            border-bottom: 1px solid var(--border);
        }
        .insight-item:last-child {
            border-bottom: none;
        }
        .insight-icon {
            font-size: 24px;
        }
        .insight-text {
            flex: 1;
        }
        .insight-title {
            font-size: 15px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }
        .insight-desc {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.5;
        }
        .calendar-container {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
        }
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        .calendar-month {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
        }
        .calendar-nav-btn {
            background: var(--bg-primary);
            border: 1px solid var(--border);
            color: var(--text-secondary);
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        .calendar-nav-btn:hover {
            background: var(--accent);
            color: var(--bg-primary);
            border-color: var(--accent);
        }
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            margin-top: 15px;
        }
        .calendar-day-label {
            text-align: center;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-tertiary);
            padding: 8px 0;
        }
        .calendar-day {
            aspect-ratio: 1;
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }
        .calendar-day:hover {
            border-color: var(--accent);
            transform: scale(1.05);
        }
        .calendar-day.empty {
            background: transparent;
            border: none;
            cursor: default;
        }
        .calendar-day.empty:hover {
            transform: none;
        }
        .calendar-day.today {
            border: 2px solid var(--accent);
            font-weight: 700;
        }
        .calendar-day.low {
            background: rgba(255, 107, 157, 0.1);
        }
        .calendar-day.medium {
            background: rgba(255, 107, 157, 0.3);
        }
        .calendar-day.high {
            background: rgba(255, 107, 157, 0.5);
        }
        .calendar-day-number {
            font-size: 14px;
            font-weight: 500;
            color: var(--text-primary);
        }
        .calendar-day-count {
            position: absolute;
            top: 4px;
            right: 4px;
            background: var(--accent);
            color: var(--bg-primary);
            font-size: 10px;
            font-weight: 700;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .heatmap-container {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
            overflow-x: auto;
        }
        .heatmap-grid {
            display: grid;
            grid-template-columns: auto repeat(53, 12px);
            gap: 3px;
            min-width: 700px;
        }
        .heatmap-month-label {
            font-size: 10px;
            color: var(--text-tertiary);
            padding: 2px 0;
        }
        .heatmap-cell {
            width: 12px;
            height: 12px;
            background: var(--bg-tertiary);
            border-radius: 2px;
            transition: all 0.2s ease;
        }
        .heatmap-cell:hover {
            transform: scale(1.3);
            border: 1px solid var(--accent);
        }
        .heatmap-cell.level-1 {
            background: rgba(255, 107, 157, 0.2);
        }
        .heatmap-cell.level-2 {
            background: rgba(255, 107, 157, 0.4);
        }
        .heatmap-cell.level-3 {
            background: rgba(255, 107, 157, 0.6);
        }
        .heatmap-cell.level-4 {
            background: rgba(255, 107, 157, 0.9);
        }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 999;
            backdrop-filter: blur(4px);
            animation: fadeIn 0.2s ease;
        }
        .day-detail-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 30px;
            z-index: 1000;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px var(--shadow);
            animation: scaleIn 0.3s ease;
        }
        @keyframes scaleIn {
            from { transform: translate(-50%, -50%) scale(0.9); opacity: 0; }
            to { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .modal-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
        }
        .modal-close {
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-size: 32px;
            cursor: pointer;
            line-height: 1;
            transition: color 0.2s ease;
        }
        .modal-close:hover {
            color: var(--danger);
        }
        .modal-entry {
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 12px;
        }
        .modal-entry-time {
            font-size: 13px;
            color: var(--text-tertiary);
            margin-bottom: 8px;
            font-family: 'JetBrains Mono', monospace;
        }
        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            font-size: 14px;
            color: var(--text-secondary);
        }
        .checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        .slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: var(--bg-tertiary);
            outline: none;
            -webkit-appearance: none;
        }
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--accent);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 0 0 8px rgba(255, 107, 157, 0.2);
        }
        .slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--accent);
            cursor: pointer;
            border: none;
        }
        .slider-value {
            text-align: center;
            margin-top: 5px;
            font-size: 14px;
            color: var(--text-secondary);
        }
        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
        }
        .achievement-card {
            background: var(--bg-secondary);
            border: 2px solid var(--border);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
        }
        .achievement-card.unlocked {
            border-color: var(--accent);
            box-shadow: 0 0 20px rgba(255, 107, 157, 0.2);
            animation: achievementUnlock 0.5s ease;
        }
        @keyframes achievementUnlock {
            0% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
        }
        .achievement-card.locked {
            opacity: 0.5;
            filter: grayscale(1);
        }
        .achievement-icon {
            font-size: 48px;
            margin-bottom: 12px;
        }
        .achievement-title {
            font-size: 15px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 6px;
        }
        .achievement-desc {
            font-size: 12px;
            color: var(--text-secondary);
            line-height: 1.4;
        }
        .achievement-progress {
            margin-top: 12px;
            height: 6px;
            background: var(--bg-tertiary);
            border-radius: 3px;
            overflow: hidden;
        }
        .achievement-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), #ff8e6b);
            border-radius: 3px;
            transition: width 0.5s ease;
        }
        .edit-btn {
            background: var(--chart-2);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-left: 10px;
        }
        .edit-btn:hover {
            background: #4a5fff;
            transform: translateY(-2px);
        }
        .goal-progress {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 10px;
        }
        .progress-circle {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: conic-gradient(var(--accent) 0% 0%, var(--bg-tertiary) 0% 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        .progress-circle::before {
            content: '';
            position: absolute;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: var(--bg-secondary);
        }
        .progress-text {
            position: relative;
            z-index: 1;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 700;
            color: var(--text-primary);
            font-size: 16px;
        }
        .goal-label {
            font-size: 14px;
            color: var(--text-secondary);
        }
        .quick-stats {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        .quick-stat {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 15px;
            flex: 1;
            min-width: 150px;
            transition: all 0.3s ease;
        }
        .quick-stat:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--shadow);
        }
        .quick-stat-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--accent);
            font-family: 'JetBrains Mono', monospace;
        }
        .quick-stat-label {
            font-size: 12px;
            color: var(--text-tertiary);
            margin-top: 5px;
        }
        .motivation-quote {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            font-style: italic;
            color: var(--text-secondary);
            border-left: 4px solid var(--accent);
        }
        .trigger-heatmap {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
        }
        .trigger-heatmap-grid {
            display: grid;
            grid-template-columns: auto repeat(7, 1fr);
            gap: 5px;
            margin-top: 15px;
        }
        .trigger-heatmap-label {
            font-size: 11px;
            color: var(--text-tertiary);
            padding: 8px 5px;
            text-align: center;
        }
        .trigger-heatmap-cell {
            height: 30px;
            background: var(--bg-tertiary);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            color: var(--text-primary);
            transition: all 0.2s ease;
        }
        .trigger-heatmap-cell:hover {
            transform: scale(1.1);
        }
        .prediction-card {
            background: linear-gradient(135deg, rgba(107, 141, 255, 0.1) 0%, rgba(107, 255, 184, 0.1) 100%);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
        }
        .prediction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--border);
        }
        .prediction-item:last-child {
            border-bottom: none;
        }
        .energy-tracker {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
        }
        .energy-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }
        .energy-btn {
            background: var(--bg-primary);
            border: 2px solid var(--border);
            padding: 12px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
        }
        .energy-btn:hover {
            border-color: var(--accent);
            transform: scale(1.05);
        }
        .energy-btn.active {
            background: var(--accent);
            border-color: var(--accent);
            color: var(--bg-primary);
        }
        .success-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--success);
            color: white;
            padding: 16px 24px;
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
            z-index: 1001;
            animation: slideInRight 0.3s ease;
        }
        @keyframes slideInRight {
            from { transform: translateX(400px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        /* Bottom navigation (mobile) */
        .bottom-nav {
            display: none;
        }
        .bottom-nav-item {
            -webkit-tap-highlight-color: transparent;
        }

        @media (max-width: 768px) {
            .top-nav {
                display: none;
            }

            .app-container {
                padding-top: 10px;
                padding-bottom: calc(90px + env(safe-area-inset-bottom));
            }

            .header-bar {
                padding: 10px 0;
            }

            .theme-toggle {
                width: 44px;
                height: 44px;
                padding: 0;
                display: inline-flex;
                align-items: center;
                justify-content: center;
            }

            .logo {
                font-size: 16px;
                text-align: center;
            }

            .bottom-nav {
                display: grid;
                grid-template-columns: repeat(5, 1fr);
                position: fixed;
                left: 0;
                right: 0;
                bottom: 0;
                z-index: 1000;
                background: rgba(20, 20, 20, 0.92);
                backdrop-filter: blur(12px);
                border-top: 1px solid var(--border);
                padding: 8px 10px calc(8px + env(safe-area-inset-bottom));
                gap: 8px;
            }

            [data-theme="light"] .bottom-nav,
            body.theme-light .bottom-nav {
                background: rgba(245, 245, 245, 0.92);
            }

            .bottom-nav-item {
                border: 1px solid transparent;
                background: transparent;
                color: var(--text-secondary);
                border-radius: 14px;
                padding: 10px 8px;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                gap: 6px;
                font-family: 'Manrope', sans-serif;
                cursor: pointer;
                transition: all 0.15s ease;
                min-height: 56px;
            }

            .bottom-nav-item:active {
                transform: scale(0.98);
            }

            .bottom-nav-item.active {
                background: rgba(255, 107, 157, 0.16);
                border-color: rgba(255, 107, 157, 0.35);
                color: var(--text-primary);
            }

            /* Center + button */
            .bottom-nav-item.add {
                background: var(--accent);
                border-color: var(--accent);
                color: var(--bg-primary);
                border-radius: 18px;
                box-shadow: 0 10px 24px rgba(0, 0, 0, 0.25);
                transform: translateY(-14px);
            }
            .bottom-nav-item.add:active {
                transform: translateY(-12px) scale(0.98);
            }
            .bottom-nav-item.add .bottom-nav-label {
                font-size: 10px;
                letter-spacing: 0.02em;
            }


            .bottom-nav-label {
                font-size: 11px;
                line-height: 1;
                font-weight: 600;
                letter-spacing: 0.01em;
            }
        }



        @media (max-width: 600px) {
            .nav {
                flex-wrap: nowrap;
                overflow-x: auto;
                padding-bottom: 6px;
            }
            .nav-btn { white-space: nowrap; }
            .entry-form { padding: 20px; }
            .calendar-grid { gap: 4px; }
            .calendar-day { font-size: 12px; }
        }
    
        @media (max-width: 480px) {
            .header { padding: 18px 0; margin-bottom: 20px; }
            .header-right { width: 100%; justify-content: space-between; }
            .nav { flex-wrap: nowrap; overflow-x: auto; -webkit-overflow-scrolling: touch; padding-bottom: 6px; }
            .nav-btn { white-space: nowrap; padding: 10px 14px; font-size: 13px; }
            .stats-grid { gap: 12px; margin-bottom: 22px; }
            .stat-card { padding: 18px; border-radius: 14px; }
            .stat-value { font-size: 28px; }
            .quick-stats { gap: 10px; }
            .quick-stat { min-width: 0; padding: 12px; }
            .quick-stat-value { font-size: 20px; }
            .entry-form { padding: 18px; border-radius: 14px; }
            .action-btn { width: 100%; }
            .nofap-container { padding: 22px; border-radius: 18px; }
            .nofap-day-count { font-size: 56px; }
            .day-detail-modal {
                width: 95%;
                max-height: 88vh;
                padding: 18px;
                border-radius: 16px;
            }
            .calendar-container { padding: 18px; }
            .calendar-grid { gap: 4px; }
            .calendar-day { border-radius: 8px; }
            .calendar-day-number { font-size: 12px; }
        }

</style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        function pad2(n) {
            return String(n).padStart(2, '0');
        }
        // YYYY-MM-DD in local time (no UTC drift)
        function formatLocalDate(d = new Date()) {
            return `${d.getFullYear()}-${pad2(d.getMonth() + 1)}-${pad2(d.getDate())}`;
        }
        // Parse YYYY-MM-DD as local date
        function parseLocalDate(dateStr) {
            return new Date(`${dateStr}T00:00:00`);
        }

        function Icon({ name, size = 24, strokeWidth = 2 }) {
            const common = {
                width: size,
                height: size,
                viewBox: "0 0 24 24",
                fill: "none",
                xmlns: "http://www.w3.org/2000/svg",
                stroke: "currentColor",
                strokeWidth,
                strokeLinecap: "round",
                strokeLinejoin: "round",
            };

            switch (name) {
                case "home":
                    return (
                        <svg {...common}>
                            <path d="M3 9l9-7 9 7" />
                            <path d="M9 22V12h6v10" />
                            <path d="M21 22H3" />
                        </svg>
                    );
                case "chart":
                    return (
                        <svg {...common}>
                            <path d="M3 3v18h18" />
                            <path d="M7 14l3-3 4 4 6-8" />
                        </svg>
                    );
                case "history":
                    return (
                        <svg {...common}>
                            <path d="M3 12a9 9 0 1 0 3-6.7" />
                            <path d="M3 3v6h6" />
                            <path d="M12 7v5l3 3" />
                        </svg>
                    );
                case "calendar":
                    return (
                        <svg {...common}>
                            <rect x="3" y="4" width="18" height="18" rx="2" />
                            <path d="M16 2v4" />
                            <path d="M8 2v4" />
                            <path d="M3 10h18" />
                        </svg>
                    );
                case "trophy":
                    return (
                        <svg {...common}>
                            <path d="M8 21h8" />
                            <path d="M12 17v4" />
                            <path d="M7 4h10v5a5 5 0 0 1-10 0V4z" />
                            <path d="M5 6h2v3a4 4 0 0 1-2-3z" />
                            <path d="M19 6h-2v3a4 4 0 0 0 2-3z" />
                        </svg>
                    );
                case "settings":
                    return (
                        <svg {...common}>
                            <path d="M12 15.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7z" />
                            <path d="M19.4 15a1.8 1.8 0 0 0 .36 1.98l.05.05-1.6 2.77-.07-.02a2 2 0 0 0-2.3.76l-.03.06H8.2l-.03-.06a2 2 0 0 0-2.3-.76l-.07.02-1.6-2.77.05-.05A1.8 1.8 0 0 0 4.6 15l-.02-.07V9.1l.02-.07A1.8 1.8 0 0 0 4.24 7.05l-.05-.05 1.6-2.77.07.02a2 2 0 0 0 2.3-.76l.03-.06h7.6l.03.06a2 2 0 0 0 2.3.76l.07-.02 1.6 2.77-.05.05A1.8 1.8 0 0 0 19.4 9l.02.07v5.86z" />
                        </svg>
                    );
                case "plus":
                    return (
                        <svg {...common}>
                            <path d="M12 5v14" />
                            <path d="M5 12h14" />
                        </svg>
                    );

                default:
                    return null;
            }
        }


        async function normalizeLegacyEntryDates(entries) {
            // One-time migration: fix legacy dates saved via UTC ISO (day shift) using timestamp.
            const MIGRATION_KEY = 'dateMigration_v1_done';
            if (localStorage.getItem(MIGRATION_KEY) === 'true') return entries;

            let changed = 0;
            for (const e of entries) {
                if (!e || !e.timestamp || !e.date) continue;
                const corrected = formatLocalDate(new Date(e.timestamp));
                if (e.date !== corrected) {
                    e.date = corrected;
                    try {
                        await updateEntry(e);
                        changed++;
                    } catch (err) {
                        // ignore per-entry failures; keep going
                    }
                }
            }
            localStorage.setItem(MIGRATION_KEY, 'true');
            if (changed > 0) {
                try { showSuccessNotification(`üõ†Ô∏è –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –¥–∞—Ç: ${changed}`); } catch {}
            }
            return entries;
        }

        const DB_NAME = 'MasturbationTrackerDB';
        const DB_VERSION = 3;
        const STORE_NAME = 'entries';
        const PREDEFINED_TRIGGERS = [
            'üí§ –°—Ç—Ä–µ—Å—Å',
            'üò¥ –°–∫—É–∫–∞',
            'üòî –û–¥–∏–Ω–æ—á–µ—Å—Ç–≤–æ',
            'üç∫ –ê–ª–∫–æ–≥–æ–ª—å',
            'üì± –°–æ—Ü—Å–µ—Ç–∏',
            'üåô –ü–æ–∑–¥–Ω–æ –Ω–æ—á—å—é',
            'üí™ –ü–æ—Å–ª–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏',
            'üéÆ –ü–æ—Å–ª–µ –∏–≥—Ä',
            'üì∫ –ü—Ä–æ—Å–º–æ—Ç—Ä –∫–æ–Ω—Ç–µ–Ω—Ç–∞',
            'üõå –ü–µ—Ä–µ–¥ —Å–Ω–æ–º',
            'üåÖ –£—Ç—Ä–æ–º',
            'üò∞ –¢—Ä–µ–≤–æ–≥–∞',
            'üéµ –ü–æ–¥ –º—É–∑—ã–∫—É',
            'üè† –î–æ–º–∞ –æ–¥–∏–Ω',
            'üíº –ü–æ—Å–ª–µ —Ä–∞–±–æ—Ç—ã',
            'üéâ –í—ã—Ö–æ–¥–Ω—ã–µ',
            'üò§ –†–∞–∑–¥—Ä–∞–∂–µ–Ω–∏–µ',
            'üåÉ –ë–µ—Å—Å–æ–Ω–Ω–∏—Ü–∞'
        ];
        const PREDEFINED_MOODS = [
            'üòä –†–∞—Å—Å–ª–∞–±–ª–µ–Ω–Ω—ã–π',
            'üò¢ –ì—Ä—É—Å—Ç–Ω—ã–π',
            'üò† –†–∞–∑–¥—Ä–∞–∂–µ–Ω–Ω—ã–π',
            'üò¥ –£—Å—Ç–∞–ª—ã–π',
            'üòé –í–æ–∑–±—É–∂–¥–µ–Ω–Ω—ã–π',
            'üòå –£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω—ã–π',
            'üò≥ –í–∏–Ω–æ–≤–Ω—ã–π',
            'üòÑ –†–∞–¥–æ—Å—Ç–Ω—ã–π',
            'üòê –ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π',
            'üòî –†–∞–∑–æ—á–∞—Ä–æ–≤–∞–Ω–Ω—ã–π',
            'üí™ –≠–Ω–µ—Ä–≥–∏—á–Ω—ã–π',
            'üò∞ –¢—Ä–µ–≤–æ–∂–Ω—ã–π'
        ];
        const ACHIEVEMENTS = [
            { id: 'first_entry', icon: 'üåü', title: '–ù–∞—á–∞–ª–æ –ø—É—Ç–∏', desc: '–ü–µ—Ä–≤–∞—è –∑–∞–ø–∏—Å—å –≤ —Ç—Ä–µ–∫–µ—Ä–µ' },
            { id: 'week_streak', icon: 'üî•', title: '–ù–µ–¥–µ–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è', desc: '7 –¥–Ω–µ–π –±–µ–∑ –º–∞—Å—Ç—É—Ä–±–∞—Ü–∏–∏' },
            { id: 'month_control', icon: 'üíé', title: '–ú–µ—Å—è—Ü –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã', desc: '–ú–µ–Ω—å—à–µ –ª–∏–º–∏—Ç–∞ –≤–µ—Å—å –º–µ—Å—è—Ü' },
            { id: 'two_week_streak', icon: '‚ö°', title: '–î–≤–µ –Ω–µ–¥–µ–ª–∏ —Å–∏–ª—ã', desc: '14 –¥–Ω–µ–π –±–µ–∑ –º–∞—Å—Ç—É—Ä–±–∞—Ü–∏–∏' },
            { id: 'month_streak', icon: 'üèÜ', title: '–ú–µ—Å—è—Ü —Å–∏–ª—ã', desc: '30 –¥–Ω–µ–π –±–µ–∑ –º–∞—Å—Ç—É—Ä–±–∞—Ü–∏–∏' },
            { id: 'total_100', icon: 'üìä', title: '–í–µ—Ç–µ—Ä–∞–Ω —Ç—Ä–µ–∫–µ—Ä–∞', desc: '100+ –∑–∞–ø–∏—Å–µ–π –≤ –∏—Å—Ç–æ—Ä–∏–∏' },
            { id: 'low_frequency', icon: 'üéØ', title: '–ö–æ–Ω—Ç—Ä–æ–ª—å —á–∞—Å—Ç–æ—Ç—ã', desc: '–ù–µ–¥–µ–ª—è —Å 0-1 –∑–∞–ø–∏—Å—å—é' },
            { id: 'no_content_week', icon: 'üß†', title: '–°–∏–ª–∞ –≤–æ–æ–±—Ä–∞–∂–µ–Ω–∏—è', desc: '–ù–µ–¥–µ–ª—è –±–µ–∑ –∫–æ–Ω—Ç–µ–Ω—Ç–∞' },
            { id: 'three_month_streak', icon: 'üí´', title: '–ö–≤–∞—Ä—Ç–∞–ª —á–µ–º–ø–∏–æ–Ω–∞', desc: '90 –¥–Ω–µ–π –±–µ–∑ –º–∞—Å—Ç—É—Ä–±–∞—Ü–∏–∏' },
            { id: 'consistent_tracker', icon: 'üìù', title: '–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞ –∑–∞–ø–∏—Å–µ–π', desc: '30 –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥ –≤–µ–¥–µ–Ω–∏—è —Ç—Ä–µ–∫–µ—Ä–∞' },
            { id: 'early_bird', icon: 'üåÖ', title: '–£—Ç—Ä–µ–Ω–Ω–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å', desc: '–ù–µ–¥–µ–ª—è –±–µ–∑ —É—Ç—Ä–µ–Ω–Ω–∏—Ö —Å–µ—Å—Å–∏–π' },
            { id: 'night_owl', icon: 'üåô', title: '–ù–æ—á–Ω–æ–π –∫–æ–Ω—Ç—Ä–æ–ª—å', desc: '–ù–µ–¥–µ–ª—è –±–µ–∑ –Ω–æ—á–Ω—ã—Ö —Å–µ—Å—Å–∏–π' },
        ];
        const MOTIVATION_QUOTES = [
            "–ö–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ —Å–æ–±–æ–π ‚Äî –≤—ã—Å—à–∞—è —Ñ–æ—Ä–º–∞ —Å–∏–ª—ã.",
            "–ö–∞–∂–¥—ã–π –¥–µ–Ω—å –±–µ–∑ ‚Äî —à–∞–≥ –∫ –ª—É—á—à–µ–π –≤–µ—Ä—Å–∏–∏ —Å–µ–±—è.",
            "–°–∏–ª–∞ –≤–æ–ª–∏ –∫–∞–∫ –º—ã—à—Ü–∞: —á–µ–º –±–æ–ª—å—à–µ —Ç—Ä–µ–Ω–∏—Ä—É–µ—à—å, —Ç–µ–º —Å–∏–ª—å–Ω–µ–µ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è.",
            "–¢–≤–æ—è —ç–Ω–µ—Ä–≥–∏—è ‚Äî —Ç–≤–æ–π —Å–∞–º—ã–π —Ü–µ–Ω–Ω—ã–π —Ä–µ—Å—É—Ä—Å.",
            "–ú–∞–ª–µ–Ω—å–∫–∏–µ –ø–æ–±–µ–¥—ã –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –ø—Ä–∏–≤–æ–¥—è—Ç –∫ –±–æ–ª—å—à–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏—è–º.",
            "–°–∞–º–æ–∫–æ–Ω—Ç—Ä–æ–ª—å ‚Äî —ç—Ç–æ —Å–≤–æ–±–æ–¥–∞ –æ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.",
            "–ö–∞–∂–¥—ã–π —Ä–∞–∑, –∫–æ–≥–¥–∞ –≥–æ–≤–æ—Ä–∏—à—å '–Ω–µ—Ç' –∏–º–ø—É–ª—å—Å—É, —Å—Ç–∞–Ω–æ–≤–∏—à—å—Å—è —Å–∏–ª—å–Ω–µ–µ.",
            "–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞ ‚Äî —ç—Ç–æ –≤—ã–±–æ—Ä –º–µ–∂–¥—É —Ç–µ–º, —á—Ç–æ —Ö–æ—á–µ—à—å —Å–µ–π—á–∞—Å, –∏ —Ç–µ–º, —á—Ç–æ —Ö–æ—á–µ—à—å –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ.",
            "–°–µ–≥–æ–¥–Ω—è—à–Ω—è—è –±–æ–ª—å ‚Äî –∑–∞–≤—Ç—Ä–∞—à–Ω—è—è —Å–∏–ª–∞.",
            "–¢—ã —Å–∏–ª—å–Ω–µ–µ —Å–≤–æ–∏—Ö –∏–º–ø—É–ª—å—Å–æ–≤.",
            "–ö–∞–∂–¥—ã–π –¥–µ–Ω—å –±–µ–∑ ‚Äî –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏—è –≤ —Å–µ–±—è.",
            "–ö–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç–∏.",
            "–¢–≤–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å –≤–¥–æ—Ö–Ω–æ–≤–ª—è–µ—Ç. –ü—Ä–æ–¥–æ–ª–∂–∞–π!",
            "–≠–Ω–µ—Ä–≥–∏—è, –∫–æ—Ç–æ—Ä—É—é —Å–æ—Ö—Ä–∞–Ω—è–µ—à—å, –¥–µ–ª–∞–µ—Ç —Ç–µ–±—è –ª—É—á—à–µ.",
            "–ù–∞—Å—Ç–æ—è—â–∞—è —Å–∏–ª–∞ ‚Äî –≤ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ —Å–æ–±–æ–π."
        ];
        const NOFAP_MILESTONES = [
            { days: 1, title: '–ü–µ—Ä–≤—ã–π –¥–µ–Ω—å', desc: '–û—Ç–ª–∏—á–Ω–æ–µ –Ω–∞—á–∞–ª–æ! –¢—ã –ø—Ä–∏–Ω—è–ª —Ä–µ—à–µ–Ω–∏–µ –∏–∑–º–µ–Ω–∏—Ç—å—Å—è.', emoji: 'üéØ' },
            { days: 3, title: '3 –¥–Ω—è', desc: '–ü–µ—Ä–≤—ã–µ –¥–Ω–∏ —Å–∞–º—ã–µ —Å–ª–æ–∂–Ω—ã–µ. –¢—ã —Å–ø—Ä–∞–≤–ª—è–µ—à—å—Å—è!', emoji: 'üí™' },
            { days: 7, title: '–ù–µ–¥–µ–ª—è', desc: '–ù–µ–¥–µ–ª—è –ø–æ–∑–∞–¥–∏! –¢–≤–æ—è —Å–∏–ª–∞ –≤–æ–ª–∏ –≤–ø–µ—á–∞—Ç–ª—è–µ—Ç.', emoji: 'üî•' },
            { days: 14, title: '2 –Ω–µ–¥–µ–ª–∏', desc: '–î–≤–µ –Ω–µ–¥–µ–ª–∏! –ü—Ä–∏–≤—ã—á–∫–∏ –Ω–∞—á–∏–Ω–∞—é—Ç –º–µ–Ω—è—Ç—å—Å—è.', emoji: '‚ö°' },
            { days: 21, title: '3 –Ω–µ–¥–µ–ª–∏', desc: '–ù–æ–≤–∞—è –ø—Ä–∏–≤—ã—á–∫–∞ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è! –ü—Ä–æ–¥–æ–ª–∂–∞–π.', emoji: 'üåü' },
            { days: 30, title: '–ú–µ—Å—è—Ü', desc: '–¶–µ–ª—ã–π –º–µ—Å—è—Ü! –ù–µ–≤–µ—Ä–æ—è—Ç–Ω–æ–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ.', emoji: 'üèÜ' },
            { days: 60, title: '2 –º–µ—Å—è—Ü–∞', desc: '–î–≤–∞ –º–µ—Å—è—Ü–∞ —Å–∏–ª—ã –≤–æ–ª–∏. –¢—ã –≥–µ—Ä–æ–π!', emoji: 'üíé' },
            { days: 90, title: '3 –º–µ—Å—è—Ü–∞', desc: '–ö–≤–∞—Ä—Ç–∞–ª –±–µ–∑ —Å—Ä—ã–≤–æ–≤. –õ–µ–≥–µ–Ω–¥–∞—Ä–Ω–æ!', emoji: 'üëë' },
            { days: 180, title: '–ü–æ–ª–≥–æ–¥–∞', desc: '–ü–æ–ª–≥–æ–¥–∞ –∫–æ–Ω—Ç—Ä–æ–ª—è. –¢—ã –∏–∑–º–µ–Ω–∏–ª —Å–µ–±—è!', emoji: 'üéñÔ∏è' },
            { days: 365, title: '–ì–æ–¥', desc: '–¶–µ–ª—ã–π –≥–æ–¥! –¢—ã –¥–æ—Å—Ç–∏–≥ –Ω–µ–≤–µ—Ä–æ—è—Ç–Ω–æ–≥–æ!', emoji: 'üåà' }
        ];
        function initDB() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open(DB_NAME, DB_VERSION);
               
                request.onerror = () => reject(request.error);
                request.onsuccess = () => resolve(request.result);
               
                request.onupgradeneeded = (event) => {
                    const db = event.target.result;
                    if (!db.objectStoreNames.contains(STORE_NAME)) {
                        const objectStore = db.createObjectStore(STORE_NAME, { keyPath: 'id', autoIncrement: true });
                        objectStore.createIndex('date', 'date', { unique: false });
                        objectStore.createIndex('time', 'time', { unique: false });
                        objectStore.createIndex('type', 'type', { unique: false });
                    }
                };
            });
        }
        function addEntry(entry) {
            return initDB().then(db => {
                return new Promise((resolve, reject) => {
                    const transaction = db.transaction([STORE_NAME], 'readwrite');
                    const objectStore = transaction.objectStore(STORE_NAME);
                    const request = objectStore.add(entry);
                   
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            });
        }
        function updateEntry(entry) {
            return initDB().then(db => {
                return new Promise((resolve, reject) => {
                    const transaction = db.transaction([STORE_NAME], 'readwrite');
                    const objectStore = transaction.objectStore(STORE_NAME);
                    const request = objectStore.put(entry);
                   
                    request.onsuccess = () => resolve();
                    request.onerror = () => reject(request.error);
                });
            });
        }
        function getAllEntries() {
            return initDB().then(db => {
                return new Promise((resolve, reject) => {
                    const transaction = db.transaction([STORE_NAME], 'readonly');
                    const objectStore = transaction.objectStore(STORE_NAME);
                    const request = objectStore.getAll();
                   
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            });
        }
        function deleteEntry(id) {
            return initDB().then(db => {
                return new Promise((resolve, reject) => {
                    const transaction = db.transaction([STORE_NAME], 'readwrite');
                    const objectStore = transaction.objectStore(STORE_NAME);
                    const request = objectStore.delete(id);
                   
                    request.onsuccess = () => resolve();
                    request.onerror = () => reject(request.error);
                });
            });
        }
        function showSuccessNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'success-notification';
            notification.textContent = message;
            document.body.appendChild(notification);
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
        function App() {
            const [activeTab, setActiveTab] = useState('dashboard');
            const [entries, setEntries] = useState([]);
            const [userSettings, setUserSettings] = useState({
                dailyLimit: 1,
                weeklyLimit: 5,
                monthlyLimit: 15,
                adviceEnabled: true,
                theme: 'dark',
                notifications: false,
                goalDays: 30
            });
            const [unlockedAchievements, setUnlockedAchievements] = useState([]);
            const [nofapMode, setNofapMode] = useState(false);
            const [nofapStartDate, setNofapStartDate] = useState(null);
            const [nofapHistory, setNofapHistory] = useState([]);
            const [filterTags, setFilterTags] = useState([]);
            const [editingEntry, setEditingEntry] = useState(null);
            const [motivationQuote, setMotivationQuote] = useState('');
            useEffect(() => {
                const savedSettings = localStorage.getItem('userSettings');
                if (savedSettings) {
                    const parsed = JSON.parse(savedSettings);
                    setUserSettings(parsed);
                    document.documentElement.setAttribute('data-theme', parsed.theme || 'dark');
                    document.body.classList.remove('theme-dark','theme-light');
                    document.body.classList.add(`theme-${(parsed.theme || 'dark')}`);
                }
                else {
                    document.documentElement.setAttribute('data-theme', 'dark');
                    document.body.classList.remove('theme-dark','theme-light');
                    document.body.classList.add('theme-dark');
                }
                const savedAchievements = localStorage.getItem('achievements');
                if (savedAchievements) setUnlockedAchievements(JSON.parse(savedAchievements));
                const savedNofap = localStorage.getItem('nofapMode');
                if (savedNofap === 'true') setNofapMode(true);
                const savedNofapStart = localStorage.getItem('nofapStartDate');
                if (savedNofapStart) setNofapStartDate(new Date(savedNofapStart));
                const savedNofapHistory = localStorage.getItem('nofapHistory');
                if (savedNofapHistory) setNofapHistory(JSON.parse(savedNofapHistory));
                setMotivationQuote(MOTIVATION_QUOTES[Math.floor(Math.random() * MOTIVATION_QUOTES.length)]);
                loadEntries();
            }, []);
            useEffect(() => {
                checkAchievements();
            }, [entries, userSettings]);
            const loadEntries = async () => {
                const data = await getAllEntries();
                await normalizeLegacyEntryDates(data);
                setEntries(data);
            };
            const handleAddEntry = async (newEntry) => {
                const entryWithId = { ...newEntry, id: Date.now() };
                await addEntry(entryWithId);
                await loadEntries();
                showSuccessNotification('‚úÖ –ó–∞–ø–∏—Å—å –¥–æ–±–∞–≤–ª–µ–Ω–∞');
                if (nofapMode) {
                    resetNofap(true);
                }
            };
            const handleEditEntry = async (updatedEntry) => {
                await updateEntry(updatedEntry);
                await loadEntries();
                setEditingEntry(null);
                showSuccessNotification('‚úèÔ∏è –ó–∞–ø–∏—Å—å –æ–±–Ω–æ–≤–ª–µ–Ω–∞');
            };
            const handleDeleteEntry = async (id) => {
                await deleteEntry(id);
                await loadEntries();
                showSuccessNotification('üóëÔ∏è –ó–∞–ø–∏—Å—å —É–¥–∞–ª–µ–Ω–∞');
            };
            const checkAchievements = () => {
                const streak = getStreak();
                const newUnlocked = [];
                ACHIEVEMENTS.forEach(a => {
                    if (unlockedAchievements.includes(a.id)) return;
                    let unlocked = false;
                    switch(a.id) {
                        case 'first_entry':
                            unlocked = entries.length >= 1;
                            break;
                        case 'week_streak':
                            unlocked = streak >= 7;
                            break;
                        case 'month_control':
                            const thisMonth = formatLocalDate(new Date()).slice(0, 7);
                            const monthEntries = entries.filter(entry => entry.date.startsWith(thisMonth));
                            unlocked = monthEntries.length < userSettings.monthlyLimit && monthEntries.length > 0;
                            break;
                        case 'two_week_streak':
                            unlocked = streak >= 14;
                            break;
                        case 'month_streak':
                            unlocked = streak >= 30;
                            break;
                        case 'total_100':
                            unlocked = entries.length >= 100;
                            break;
                        case 'low_frequency':
                            const lastWeekEntries = entries.filter(e => {
                                const weekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);
                                return parseLocalDate(e.date) >= weekAgo;
                            });
                            unlocked = lastWeekEntries.length <= 1;
                            break;
                        case 'no_content_week':
                            const lastWeekNoContent = entries.filter(e => {
                                const weekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);
                                return parseLocalDate(e.date) >= weekAgo && !e.contentUsed;
                            });
                            const weekTotal = entries.filter(e => {
                                const weekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);
                                return parseLocalDate(e.date) >= weekAgo;
                            });
                            unlocked = lastWeekNoContent.length === weekTotal.length && weekTotal.length >= 5;
                            break;
                        case 'three_month_streak':
                            unlocked = streak >= 90;
                            break;
                        case 'consistent_tracker':
                            let consecutiveDays = 0;
                            const today = new Date();
                            for (let i = 0; i < 30; i++) {
                                const checkDate = new Date(today);
                                checkDate.setDate(checkDate.getDate() - i);
                                const dateStr = formatLocalDate(checkDate);
                                const hasEntry = entries.some(e => e.date === dateStr);
                                if (!hasEntry) break;
                                consecutiveDays++;
                            }
                            unlocked = consecutiveDays >= 30;
                            break;
                        case 'early_bird':
                            const morningEntries = entries.filter(e => {
                                const weekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);
                                const hour = parseInt(e.time.split(':')[0]);
                                return parseLocalDate(e.date) >= weekAgo && hour >= 5 && hour < 12;
                            });
                            unlocked = morningEntries.length === 0;
                            break;
                        case 'night_owl':
                            const nightEntries = entries.filter(e => {
                                const weekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);
                                const hour = parseInt(e.time.split(':')[0]);
                                return parseLocalDate(e.date) >= weekAgo && (hour >= 22 || hour < 5);
                            });
                            unlocked = nightEntries.length === 0;
                            break;
                    }
                    if (unlocked) {
                        newUnlocked.push(a.id);
                        if (typeof confetti !== 'undefined') {
                            confetti({
                                particleCount: 100,
                                spread: 70,
                                origin: { y: 0.6 }
                            });
                        }
                    }
                });
                if (newUnlocked.length > 0) {
                    const updated = [...unlockedAchievements, ...newUnlocked];
                    setUnlockedAchievements(updated);
                    localStorage.setItem('achievements', JSON.stringify(updated));
                    showSuccessNotification(`üèÜ –ù–æ–≤–æ–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ!`);
                }
            };
            const getStreak = () => {
                if (entries.length === 0) return 0;
                let streak = 0;
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                for (let i = 0; i < 365; i++) {
                    const checkDate = new Date(today);
                    checkDate.setDate(checkDate.getDate() - i);
                    const dateStr = formatLocalDate(checkDate);
                    const hasEntry = entries.some(e => e.date === dateStr);
                    if (hasEntry) break;
                    streak++;
                }
                return streak;
            };
            const toggleTheme = () => {
                const newTheme = userSettings.theme === 'dark' ? 'light' : 'dark';
                const updated = { ...userSettings, theme: newTheme };
                setUserSettings(updated);
                localStorage.setItem('userSettings', JSON.stringify(updated));
                document.documentElement.setAttribute('data-theme', newTheme);
                document.body.classList.remove('theme-dark','theme-light');
                document.body.classList.add(`theme-${newTheme}`);
            };
            const startNofap = () => {
                setNofapMode(true);
                const now = new Date();
                setNofapStartDate(now);
                localStorage.setItem('nofapMode', 'true');
                localStorage.setItem('nofapStartDate', now.toISOString());
                if (typeof confetti !== 'undefined') {
                    confetti({
                        particleCount: 150,
                        spread: 100,
                        origin: { y: 0.6 }
                    });
                }
                showSuccessNotification('üî• NoFap Challenge –Ω–∞—á–∞–ª—Å—è!');
            };
            const resetNofap = (auto = false) => {
                if (!auto && !confirm('–°–±—Ä–æ—Å–∏—Ç—å —Ç–µ–∫—É—â–∏–π —Å—Ç—Ä–∏–∫? –ü—Ä–æ–≥—Ä–µ—Å—Å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –∏—Å—Ç–æ—Ä–∏–∏.')) return;
                const days = getNofapDays();
                if (days > 0) {
                    const newHistory = [...nofapHistory, { days, date: new Date().toISOString() }];
                    setNofapHistory(newHistory);
                    localStorage.setItem('nofapHistory', JSON.stringify(newHistory));
                }
                const now = new Date();
                setNofapStartDate(now);
                localStorage.setItem('nofapStartDate', now.toISOString());
            };
            const stopNofap = () => {
                if (!confirm('–í—ã–π—Ç–∏ –∏–∑ —Ä–µ–∂–∏–º–∞ NoFap? –¢–µ–∫—É—â–∏–π —Å—Ç—Ä–∏–∫ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è.')) return;
                setNofapMode(false);
                localStorage.removeItem('nofapMode');
                showSuccessNotification('üëã –†–µ–∂–∏–º NoFap –∑–∞–≤–µ—Ä—à—ë–Ω');
            };
            const getNofapDays = () => {
                if (!nofapStartDate) return 0;
                const now = new Date();
                const start = new Date(nofapStartDate);
                const diff = now - start;
                return Math.floor(diff / (1000 * 60 * 60 * 24));
            };
            const getNofapRecord = () => {
                if (nofapHistory.length === 0) return getNofapDays();
                const historyMax = Math.max(...nofapHistory.map(h => h.days));
                return Math.max(historyMax, getNofapDays());
            };
            const getGoalProgress = () => {
                const days = getNofapDays();
                return Math.min((days / userSettings.goalDays) * 100, 100);
            };
            const getWeeklyStats = () => {
                const weekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);
                const weekEntries = entries.filter(e => parseLocalDate(e.date) >= weekAgo);
                const totalDuration = weekEntries.reduce((sum, e) => sum + (e.duration || 0), 0);
                const avgArousal = weekEntries.length > 0 
                    ? weekEntries.reduce((sum, e) => sum + (e.arousalLevel || 5), 0) / weekEntries.length 
                    : 0;
                const withContent = weekEntries.filter(e => e.contentUsed).length;
                return { count: weekEntries.length, totalDuration, avgArousal, withContent };
            };
            const getCurrentMilestone = () => {
                const days = getNofapDays();
                const milestones = [...NOFAP_MILESTONES].reverse();
                return milestones.find(m => days >= m.days) || null;
            };
            return (
                <div className="app-container">
                    <header className="header">
                        <div className="header-bar">
                            <div className="header-left">
                                <button className="theme-toggle" onClick={toggleTheme} aria-label="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">
                                    {userSettings.theme === 'dark' ? '‚òÄÔ∏è' : 'üåô'}
                                </button>
                            </div>

                            <div className="logo">MASTURBATION TRACKER</div>

                            <div className="header-actions">
                                <button className="icon-btn" onClick={() => setActiveTab('achievements')} aria-label="–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è">
                                    <Icon name="trophy" size={22} />
                                </button>
                                <button className="icon-btn" onClick={() => setActiveTab('settings')} aria-label="–ù–∞—Å—Ç—Ä–æ–π–∫–∏">
                                    <Icon name="settings" size={22} />
                                </button>
                            </div>
                        </div>

                        <nav className="nav top-nav">
                            <button className={`nav-btn ${activeTab === 'dashboard' ? 'active' : ''}`} onClick={() => setActiveTab('dashboard')}>üìä –î–∞—à–±–æ—Ä–¥</button>
                            <button className={`nav-btn ${activeTab === 'analytics' ? 'active' : ''}`} onClick={() => setActiveTab('analytics')}>üìà –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</button>
                            <button className={`nav-btn ${activeTab === 'calendar' ? 'active' : ''}`} onClick={() => setActiveTab('calendar')}>üìÖ –ö–∞–ª–µ–Ω–¥–∞—Ä—å</button>
                            <button className={`nav-btn ${activeTab === 'history' ? 'active' : ''}`} onClick={() => setActiveTab('history')}>üìù –ò—Å—Ç–æ—Ä–∏—è</button>
                            <button className={`nav-btn ${activeTab === 'addEntry' ? 'active' : ''}`} onClick={() => setActiveTab('addEntry')}>‚ûï –î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å</button>
                        </nav>
                    </header>
                    {activeTab === 'dashboard' && <Dashboard entries={entries} onAddEntry={handleAddEntry} onEditEntry={handleEditEntry} editingEntry={editingEntry} setEditingEntry={setEditingEntry} userSettings={userSettings} getStreak={getStreak} nofapMode={nofapMode} nofapDays={getNofapDays()} nofapRecord={getNofapRecord()} startNofap={startNofap} resetNofap={resetNofap} stopNofap={stopNofap} goalProgress={getGoalProgress()} weeklyStats={getWeeklyStats()} motivationQuote={motivationQuote} getCurrentMilestone={getCurrentMilestone} />}
                    {activeTab === 'addEntry' && <AddEntryPage onAddEntry={handleAddEntry} onDone={() => setActiveTab('dashboard')} />}

                    {activeTab === 'analytics' && <Analytics entries={entries} filterTags={filterTags} setFilterTags={setFilterTags} />}
                    {activeTab === 'calendar' && <Calendar entries={entries} />}
                    {activeTab === 'history' && <History entries={entries} onDeleteEntry={handleDeleteEntry} onEditEntry={handleEditEntry} editingEntry={editingEntry} setEditingEntry={setEditingEntry} filterTags={filterTags} setFilterTags={setFilterTags} />}
                    {activeTab === 'achievements' && <Achievements entries={entries} unlockedAchievements={unlockedAchievements} userSettings={userSettings} getStreak={getStreak} />}
                    {activeTab === 'settings' && <Settings userSettings={userSettings} setUserSettings={setUserSettings} entries={entries} />}
                    <BottomNav activeTab={activeTab} setActiveTab={setActiveTab} />
                    {editingEntry && <EditEntryModal entry={editingEntry} onSave={handleEditEntry} onCancel={() => setEditingEntry(null)} />}
                </div>
            );
        }
        

        function BottomNav({ activeTab, setActiveTab }) {
            return (
                <div className="bottom-nav" role="navigation" aria-label="–û—Å–Ω–æ–≤–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è">
                    <button
                        className={`bottom-nav-item ${activeTab === 'dashboard' ? 'active' : ''}`}
                        onClick={() => setActiveTab('dashboard')}
                        aria-label="–ì–ª–∞–≤–Ω–∞—è"
                    >
                        <Icon name="home" size={24} />
                        <span className="bottom-nav-label">–ì–ª–∞–≤–Ω–∞—è</span>
                    </button>

                    <button
                        className={`bottom-nav-item ${activeTab === 'analytics' ? 'active' : ''}`}
                        onClick={() => setActiveTab('analytics')}
                        aria-label="–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞"
                    >
                        <Icon name="chart" size={24} />
                        <span className="bottom-nav-label">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</span>
                    </button>

                    <button
                        className={`bottom-nav-item add ${activeTab === 'addEntry' ? 'active' : ''}`}
                        onClick={() => setActiveTab('addEntry')}
                        aria-label="–î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å"
                    >
                        <Icon name="plus" size={26} strokeWidth={2.5} />
                        <span className="bottom-nav-label">–î–æ–±–∞–≤–∏—Ç—å</span>
                    </button>

                    <button
                        className={`bottom-nav-item ${activeTab === 'history' ? 'active' : ''}`}
                        onClick={() => setActiveTab('history')}
                        aria-label="–ò—Å—Ç–æ—Ä–∏—è"
                    >
                        <Icon name="history" size={24} />
                        <span className="bottom-nav-label">–ò—Å—Ç–æ—Ä–∏—è</span>
                    </button>

                    <button
                        className={`bottom-nav-item ${activeTab === 'calendar' ? 'active' : ''}`}
                        onClick={() => setActiveTab('calendar')}
                        aria-label="–ö–∞–ª–µ–Ω–¥–∞—Ä—å"
                    >
                        <Icon name="calendar" size={24} />
                        <span className="bottom-nav-label">–ö–∞–ª–µ–Ω–¥–∞—Ä—å</span>
                    </button>
                </div>
            );
        }
function Dashboard({ entries, onAddEntry, onEditEntry, editingEntry, setEditingEntry, userSettings, getStreak, nofapMode, nofapDays, nofapRecord, startNofap, resetNofap, stopNofap, goalProgress, weeklyStats, motivationQuote, getCurrentMilestone }) {
            const [mood, setMood] = useState('');
            const [customMood, setCustomMood] = useState('');
            const [arousalLevel, setArousalLevel] = useState(5);
            const [location, setLocation] = useState('');
            const [duration, setDuration] = useState(0);
            const [contentUsed, setContentUsed] = useState(false);
            const [orgasm, setOrgasm] = useState(false);
            const [selectedTriggers, setSelectedTriggers] = useState([]);
            const [customTrigger, setCustomTrigger] = useState('');
            const [note, setNote] = useState('');
            const [showForm, setShowForm] = useState(false);
            const today = formatLocalDate(new Date());
            const todayEntries = entries.filter(e => e.date === today);
            const weekAgo = formatLocalDate(new Date(Date.now() - 7 * 24 * 60 * 60 * 1000));
            const weekEntries = entries.filter(e => e.date >= weekAgo);
            const streak = getStreak();
            const handleSubmit = () => {
                const now = new Date();
                const entry = {
                    id: Date.now(),
                    date: formatLocalDate(now),
                    time: now.toTimeString().split(' ')[0].substring(0, 5),
                    type: '–ú–∞—Å—Ç—É—Ä–±–∞—Ü–∏—è',
                    mood,
                    arousalLevel,
                    location: location || '–ù–µ —É–∫–∞–∑–∞–Ω–æ',
                    duration,
                    contentUsed,
                    orgasm,
                    triggers: selectedTriggers,
                    note,
                    timestamp: now.toISOString()
                };
                onAddEntry(entry);
                setMood('');
                setCustomMood('');
                setArousalLevel(5);
                setLocation('');
                setDuration(0);
                setContentUsed(false);
                setOrgasm(false);
                setSelectedTriggers([]);
                setCustomTrigger('');
                setNote('');
                setShowForm(false);
            };
            const toggleTrigger = (trigger) => {
                if (selectedTriggers.includes(trigger)) {
                    setSelectedTriggers(selectedTriggers.filter(t => t !== trigger));
                } else {
                    setSelectedTriggers([...selectedTriggers, trigger]);
                }
            };
            const addCustomTrigger = () => {
                if (customTrigger.trim() && !selectedTriggers.includes(customTrigger.trim())) {
                    setSelectedTriggers([...selectedTriggers, customTrigger.trim()]);
                    setCustomTrigger('');
                }
            };
            const toggleMood = (moodVal) => {
                setMood(moodVal === mood ? '' : moodVal);
            };
            const addCustomMood = () => {
                if (customMood.trim()) {
                    setMood(customMood.trim());
                    setCustomMood('');
                }
            };
            const todayWarning = todayEntries.length >= userSettings.dailyLimit ? '‚ö†Ô∏è –ü—Ä–µ–≤—ã—à–µ–Ω –¥–Ω–µ–≤–Ω–æ–π –ª–∏–º–∏—Ç!' : '';
            const weekWarning = weekEntries.length >= userSettings.weeklyLimit ? '‚ö†Ô∏è –ü—Ä–µ–≤—ã—à–µ–Ω –Ω–µ–¥–µ–ª—å–Ω—ã–π –ª–∏–º–∏—Ç!' : '';
            const advice = userSettings.adviceEnabled ? (todayWarning || weekWarning || '–í—Å—ë –≤ –Ω–æ—Ä–º–µ üëå') : '';
            const totalDuration = entries.reduce((sum, e) => sum + (e.duration || 0), 0);
            const avgDuration = entries.length > 0 ? Math.round(totalDuration / entries.length) : 0;
            const currentMilestone = getCurrentMilestone();
            return (
                <div className="fade-in">
                    <div className="motivation-quote">
                        üí≠ {motivationQuote}
                    </div>
                    {nofapMode && (
                        <div className="nofap-container">
                            <div className="nofap-day-count">–î–µ–Ω—å {nofapDays}</div>
                            <div className="nofap-label">NoFap Challenge</div>
                            {currentMilestone && (
                                <div className="nofap-milestone">
                                    <div className="nofap-milestone-title">{currentMilestone.emoji} {currentMilestone.title}</div>
                                    <div className="nofap-milestone-desc">{currentMilestone.desc}</div>
                                </div>
                            )}
                            <div className="goal-progress">
                                <div className="progress-circle" style={{background: `conic-gradient(var(--accent) 0% ${goalProgress}%, var(--bg-tertiary) ${goalProgress}% 100%)`}}>
                                    <div className="progress-text">{Math.round(goalProgress)}%</div>
                                </div>
                                <div>
                                    <div className="nofap-record">üèÜ –¶–µ–ª—å: {userSettings.goalDays} –¥–Ω–µ–π</div>
                                    <div className="nofap-record">üìà –†–µ–∫–æ—Ä–¥: {nofapRecord} –¥–Ω–µ–π</div>
                                    <div className="nofap-record">üí™ –°–µ–π—á–∞—Å: {nofapDays} –¥–Ω–µ–π</div>
                                </div>
                            </div>
                            <div className="nofap-buttons">
                                <button className="nofap-reset-btn" onClick={() => resetNofap()}>üîÑ –°–±—Ä–æ—Å–∏—Ç—å —Å—Ç—Ä–∏–∫</button>
                                <button className="nav-btn" onClick={stopNofap}>üö™ –í—ã–π—Ç–∏ –∏–∑ —Ä–µ–∂–∏–º–∞</button>
                            </div>
                        </div>
                    )}
                    {!nofapMode && (
                        <div style={{ marginBottom: '30px', textAlign: 'center' }}>
                            <button className="action-btn" onClick={startNofap}>üî• –ù–∞—á–∞—Ç—å NoFap Challenge</button>
                        </div>
                    )}
                    <div className="quick-stats">
                        <div className="quick-stat">
                            <div className="quick-stat-value">{streak}</div>
                            <div className="quick-stat-label">–î–Ω–µ–π –±–µ–∑</div>
                        </div>
                        <div className="quick-stat">
                            <div className="quick-stat-value">{todayEntries.length}/{userSettings.dailyLimit}</div>
                            <div className="quick-stat-label">–°–µ–≥–æ–¥–Ω—è / –ª–∏–º–∏—Ç</div>
                        </div>
                        <div className="quick-stat">
                            <div className="quick-stat-value">{weeklyStats.count}</div>
                            <div className="quick-stat-label">–ó–∞ –Ω–µ–¥–µ–ª—é</div>
                        </div>
                        <div className="quick-stat">
                            <div className="quick-stat-value">{avgDuration} –º–∏–Ω</div>
                            <div className="quick-stat-label">–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è</div>
                        </div>
                    </div>
                    {advice && (
  <div
    style={{
      marginBottom: '20px',
      padding: '15px',
      background: advice.includes('–ü—Ä–µ–≤—ã—à–µ–Ω')
        ? 'var(--danger)'
        : 'var(--success)',
      borderRadius: '10px',
      color: 'white',
      fontWeight: '600'
    }}
  >
    {advice}
  </div>
)}

                    <div className="stats-grid">
                        <div className="stat-card">
                            <div className="stat-label">–ù–µ–¥–µ–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
                            <div className="stat-value">{weeklyStats.count}</div>
                            <div className="stat-sublabel">–ó–∞–ø–∏—Å–µ–π: {weeklyStats.count} | –° –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º: {weeklyStats.withContent}</div>
                            <div className="stat-sublabel">–û–±—â–µ–µ –≤—Ä–µ–º—è: {Math.round(weeklyStats.totalDuration)} –º–∏–Ω</div>
                            <div className="stat-sublabel">–°—Ä–µ–¥–Ω–µ–µ –≤–æ–∑–±—É–∂–¥–µ–Ω–∏–µ: {weeklyStats.avgArousal.toFixed(1)}/10</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-label">–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
                            <div className="stat-value">{entries.length}</div>
                            <div className="stat-sublabel">–í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π</div>
                            <div className="stat-sublabel">–û–±—â–µ–µ –≤—Ä–µ–º—è: {Math.round(totalDuration / 60)} —á–∞—Å–æ–≤</div>
                            <div className="stat-sublabel">–°—Ä–µ–¥–Ω–µ–µ: {avgDuration} –º–∏–Ω –Ω–∞ —Å–µ—Å—Å–∏—é</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-label">–¶–µ–ª–∏ –∏ –ª–∏–º–∏—Ç—ã</div>
                            <div className="stat-value">{userSettings.dailyLimit}/{userSettings.weeklyLimit}</div>
                            <div className="stat-sublabel">–î–µ–Ω—å/–Ω–µ–¥–µ–ª—è</div>
                            <div className="stat-sublabel">–ú–µ—Å—è—á–Ω—ã–π –ª–∏–º–∏—Ç: {userSettings.monthlyLimit}</div>
                            <div className="stat-sublabel">–ü—Ä–æ–≥—Ä–µ—Å—Å NoFap: {Math.round(goalProgress)}%</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-label">–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</div>
                            <div className="stat-value">{Math.round((entries.filter(e => e.orgasm).length / entries.length) * 100 || 0)}%</div>
                            <div className="stat-sublabel">–î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ –æ—Ä–≥–∞–∑–º–∞</div>
                            <div className="stat-sublabel">–° –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º: {Math.round((entries.filter(e => e.contentUsed).length / entries.length) * 100 || 0)}%</div>
                            <div className="stat-sublabel">–°—Ä–µ–¥–Ω–µ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ: {entries.length > 0 ? 'üòä' : 'üòê'}</div>
                        </div>
                    </div>
                                    </div>
            );
        }
        
        function AddEntryPage({ onAddEntry, onDone }) {
            const [mood, setMood] = useState('');
            const [customMood, setCustomMood] = useState('');
            const [arousalLevel, setArousalLevel] = useState(5);
            const [location, setLocation] = useState('');
            const [duration, setDuration] = useState(0);
            const [contentUsed, setContentUsed] = useState(false);
            const [orgasm, setOrgasm] = useState(false);
            const [selectedTriggers, setSelectedTriggers] = useState([]);
            const [customTrigger, setCustomTrigger] = useState('');
            const [note, setNote] = useState('');

            const [showAllMoods, setShowAllMoods] = useState(false);
            const [showAllTriggers, setShowAllTriggers] = useState(false);

            const TOP_MOODS = PREDEFINED_MOODS.slice(0, 4);
            const MORE_MOODS = PREDEFINED_MOODS.slice(4);

            const TOP_TRIGGERS = PREDEFINED_TRIGGERS.slice(0, 4);
            const MORE_TRIGGERS = PREDEFINED_TRIGGERS.slice(4);

            const toggleMood = (moodVal) => {
                setMood(prev => (prev === moodVal ? '' : moodVal));
            };

            const addCustomMood = () => {
                const value = (customMood || '').trim();
                if (!value) return;
                setMood(value);
                setCustomMood('');
            };

            const toggleTrigger = (trigger) => {
                setSelectedTriggers(prev =>
                    prev.includes(trigger) ? prev.filter(t => t !== trigger) : [...prev, trigger]
                );
            };

            const addCustomTrigger = () => {
                const value = (customTrigger || '').trim();
                if (!value) return;
                if (!selectedTriggers.includes(value)) setSelectedTriggers(prev => [...prev, value]);
                setCustomTrigger('');
            };

            const handleSubmit = () => {
                const now = new Date();
                const entry = {
                    id: Date.now(),
                    date: formatLocalDate(now),
                    time: now.toTimeString().split(' ')[0].substring(0, 5),
                    type: '–ú–∞—Å—Ç—É—Ä–±–∞—Ü–∏—è',
                    mood,
                    arousalLevel,
                    location: location || '–ù–µ —É–∫–∞–∑–∞–Ω–æ',
                    duration,
                    contentUsed,
                    orgasm,
                    triggers: selectedTriggers,
                    note,
                    timestamp: now.toISOString()
                };

                onAddEntry(entry);

                // reset (–Ω–∞ –≤—Å—è–∫–∏–π)
                setMood('');
                setCustomMood('');
                setArousalLevel(5);
                setLocation('');
                setDuration(0);
                setContentUsed(false);
                setOrgasm(false);
                setSelectedTriggers([]);
                setCustomTrigger('');
                setNote('');
                setShowAllMoods(false);
                setShowAllTriggers(false);

                if (typeof onDone === 'function') onDone();
            };

            return (
                <div className="fade-in">
                    <div className="entry-form">
                        <h2 className="section-title">‚úçÔ∏è –î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å –æ –º–∞—Å—Ç—É—Ä–±–∞—Ü–∏–∏</h2>

                        <div className="form-group">
                            <label className="form-label">–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –ø–æ—Å–ª–µ</label>
                            <div className="tags-container">
                                {TOP_MOODS.map(moodVal => (
                                    <button
                                        key={moodVal}
                                        className={`tag-btn ${mood === moodVal ? 'active' : ''}`}
                                        onClick={() => toggleMood(moodVal)}
                                    >
                                        {moodVal}
                                    </button>
                                ))}
                                {showAllMoods && MORE_MOODS.map(moodVal => (
                                    <button
                                        key={moodVal}
                                        className={`tag-btn ${mood === moodVal ? 'active' : ''}`}
                                        onClick={() => toggleMood(moodVal)}
                                    >
                                        {moodVal}
                                    </button>
                                ))}
                            </div>

                            <div style={{ display: 'flex', gap: '10px', marginTop: '10px', flexWrap: 'wrap' }}>
                                {MORE_MOODS.length > 0 && (
                                    <button className="nav-btn" onClick={() => setShowAllMoods(v => !v)}>
                                        {showAllMoods ? '–°–∫—Ä—ã—Ç—å' : '–ï—â–µ'}
                                    </button>
                                )}
                                <div style={{ display: 'flex', gap: '10px', flex: 1, minWidth: '240px' }}>
                                    <input
                                        type="text"
                                        className="form-input"
                                        value={customMood}
                                        onChange={(e) => setCustomMood(e.target.value)}
                                        onKeyPress={(e) => e.key === 'Enter' && addCustomMood()}
                                        placeholder="–°–≤–æ—ë –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ."
                                    />
                                    <button className="nav-btn" onClick={addCustomMood}>–î–æ–±–∞–≤–∏—Ç—å</button>
                                </div>
                            </div>
                        </div>

                        <div className="form-group">
                            <label className="form-label">–£—Ä–æ–≤–µ–Ω—å –≤–æ–∑–±—É–∂–¥–µ–Ω–∏—è –ø–µ—Ä–µ–¥: {arousalLevel}/10</label>
                            <input type="range" min="1" max="10" value={arousalLevel} onChange={(e) => setArousalLevel(parseInt(e.target.value))} className="slider" />
                            <div className="slider-value">{arousalLevel}/10</div>
                        </div>

                        <div className="form-group">
                            <label className="form-label">–ú–µ—Å—Ç–æ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                            <input type="text" className="form-input" value={location} onChange={(e) => setLocation(e.target.value)} placeholder="–¥–æ–º, —Ä–∞–±–æ—Ç–∞, –≤–∞–Ω–Ω–∞—è –∏ —Ç.–¥." />
                        </div>

                        <div className="form-group">
                            <label className="form-label">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–º–∏–Ω—É—Ç—ã)</label>
                            <input type="number" className="form-input" min="0" max="180" value={duration} onChange={(e) => setDuration(parseInt(e.target.value) || 0)} placeholder="0" />
                        </div>

                        <div className="form-group">
                            <label className="checkbox-label">
                                <input type="checkbox" checked={contentUsed} onChange={(e) => setContentUsed(e.target.checked)} className="checkbox" />
                                –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –∫–æ–Ω—Ç–µ–Ω—Ç (–ø–æ—Ä–Ω–æ, —Ñ–æ—Ç–æ –∏ —Ç.–¥.)
                            </label>
                        </div>

                        <div className="form-group">
                            <label className="checkbox-label">
                                <input type="checkbox" checked={orgasm} onChange={(e) => setOrgasm(e.target.checked)} className="checkbox" />
                                –î–æ—Å—Ç–∏–≥–Ω—É—Ç –æ—Ä–≥–∞–∑–º
                            </label>
                        </div>

                        <div className="form-group">
                            <label className="form-label">–¢—Ä–∏–≥–≥–µ—Ä—ã / –ø—Ä–∏—á–∏–Ω—ã (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                            <div className="tags-container">
                                {TOP_TRIGGERS.map(trigger => (
                                    <button
                                        key={trigger}
                                        className={`tag-btn ${selectedTriggers.includes(trigger) ? 'active' : ''}`}
                                        onClick={() => toggleTrigger(trigger)}
                                    >
                                        {trigger}
                                    </button>
                                ))}
                                {showAllTriggers && MORE_TRIGGERS.map(trigger => (
                                    <button
                                        key={trigger}
                                        className={`tag-btn ${selectedTriggers.includes(trigger) ? 'active' : ''}`}
                                        onClick={() => toggleTrigger(trigger)}
                                    >
                                        {trigger}
                                    </button>
                                ))}
                            </div>

                            <div style={{ display: 'flex', gap: '10px', marginTop: '10px', flexWrap: 'wrap' }}>
                                {MORE_TRIGGERS.length > 0 && (
                                    <button className="nav-btn" onClick={() => setShowAllTriggers(v => !v)}>
                                        {showAllTriggers ? '–°–∫—Ä—ã—Ç—å' : '–ï—â–µ'}
                                    </button>
                                )}
                                <div style={{ display: 'flex', gap: '10px', flex: 1, minWidth: '240px' }}>
                                    <input
                                        type="text"
                                        className="form-input"
                                        value={customTrigger}
                                        onChange={(e) => setCustomTrigger(e.target.value)}
                                        onKeyPress={(e) => e.key === 'Enter' && addCustomTrigger()}
                                        placeholder="–°–≤–æ–π —Ç—Ä–∏–≥–≥–µ—Ä."
                                    />
                                    <button className="nav-btn" onClick={addCustomTrigger}>–î–æ–±–∞–≤–∏—Ç—å</button>
                                </div>
                            </div>
                        </div>

                        <div className="form-group">
                            <label className="form-label">–ó–∞–º–µ—Ç–∫–∞ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                            <textarea className="form-textarea" value={note} onChange={(e) => setNote(e.target.value)} placeholder="—á—Ç–æ –ø–æ—á—É–≤—Å—Ç–≤–æ–≤–∞–ª, —á—Ç–æ —Å—Ç–∞–ª–æ —Ç—Ä–∏–≥–≥–µ—Ä–æ–º, –º—ã—Å–ª–∏..." />
                        </div>

                        <button className="action-btn" style={{ width: '100%' }} onClick={handleSubmit}>
                            ‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–∞–ø–∏—Å—å
                        </button>
                    </div>
                </div>
            );
        }

function EditEntryModal({ entry, onSave, onCancel }) {
            const [mood, setMood] = useState(entry.mood || '');
            const [arousalLevel, setArousalLevel] = useState(entry.arousalLevel || 5);
            const [location, setLocation] = useState(entry.location || '');
            const [duration, setDuration] = useState(entry.duration || 0);
            const [contentUsed, setContentUsed] = useState(entry.contentUsed || false);
            const [orgasm, setOrgasm] = useState(entry.orgasm || false);
            const [selectedTriggers, setSelectedTriggers] = useState(entry.triggers || []);
            const [customTrigger, setCustomTrigger] = useState('');
            const [note, setNote] = useState(entry.note || '');
            const handleSave = () => {
                onSave({
                    ...entry,
                    mood,
                    arousalLevel,
                    location,
                    duration,
                    contentUsed,
                    orgasm,
                    triggers: selectedTriggers,
                    note
                });
            };
            const toggleTrigger = (trigger) => {
                if (selectedTriggers.includes(trigger)) {
                    setSelectedTriggers(selectedTriggers.filter(t => t !== trigger));
                } else {
                    setSelectedTriggers([...selectedTriggers, trigger]);
                }
            };
            const addCustomTrigger = () => {
                if (customTrigger.trim() && !selectedTriggers.includes(customTrigger.trim())) {
                    setSelectedTriggers([...selectedTriggers, customTrigger.trim()]);
                    setCustomTrigger('');
                }
            };
            const toggleMood = (moodVal) => {
                setMood(moodVal === mood ? '' : moodVal);
            };
            return (
                <>
                    <div className="modal-overlay" onClick={onCancel}></div>
                    <div className="day-detail-modal">
                        <div className="modal-header">
                            <div className="modal-title">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø–∏—Å—å</div>
                            <button className="modal-close" onClick={onCancel}>√ó</button>
                        </div>
                        <div className="form-group">
                            <label className="form-label">–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –ø–æ—Å–ª–µ</label>
                            <div className="tags-container">
                                {PREDEFINED_MOODS.map(moodVal => (
                                    <button
                                        key={moodVal}
                                        className={`tag-btn ${mood === moodVal ? 'active' : ''}`}
                                        onClick={() => toggleMood(moodVal)}
                                    >
                                        {moodVal}
                                    </button>
                                ))}
                            </div>
                        </div>
                        <div className="form-group">
                            <label className="form-label">–£—Ä–æ–≤–µ–Ω—å –≤–æ–∑–±—É–∂–¥–µ–Ω–∏—è: {arousalLevel}/10</label>
                            <input type="range" min="1" max="10" value={arousalLevel} onChange={(e) => setArousalLevel(parseInt(e.target.value))} className="slider" />
                        </div>
                        <div className="form-group">
                            <label className="form-label">–ú–µ—Å—Ç–æ</label>
                            <input type="text" className="form-input" value={location} onChange={(e) => setLocation(e.target.value)} />
                        </div>
                        <div className="form-group">
                            <label className="form-label">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–º–∏–Ω—É—Ç—ã)</label>
                            <input type="number" className="form-input" value={duration} onChange={(e) => setDuration(parseInt(e.target.value) || 0)} />
                        </div>
                        <div className="form-group">
                            <label className="checkbox-label">
                                <input type="checkbox" checked={contentUsed} onChange={(e) => setContentUsed(e.target.checked)} className="checkbox" />
                                –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –∫–æ–Ω—Ç–µ–Ω—Ç
                            </label>
                        </div>
                        <div className="form-group">
                            <label className="checkbox-label">
                                <input type="checkbox" checked={orgasm} onChange={(e) => setOrgasm(e.target.checked)} className="checkbox" />
                                –î–æ—Å—Ç–∏–≥–Ω—É—Ç –æ—Ä–≥–∞–∑–º
                            </label>
                        </div>
                        <div className="form-group">
                            <label className="form-label">–¢—Ä–∏–≥–≥–µ—Ä—ã</label>
                            <div className="tags-container">
                                {PREDEFINED_TRIGGERS.map(trigger => (
                                    <button
                                        key={trigger}
                                        className={`tag-btn ${selectedTriggers.includes(trigger) ? 'active' : ''}`}
                                        onClick={() => toggleTrigger(trigger)}
                                    >
                                        {trigger}
                                    </button>
                                ))}
                            </div>
                            <div style={{ display: 'flex', gap: '10px', marginTop: '10px' }}>
                                <input
                                    type="text"
                                    className="form-input"
                                    value={customTrigger}
                                    onChange={(e) => setCustomTrigger(e.target.value)}
                                    onKeyPress={(e) => e.key === 'Enter' && addCustomTrigger()}
                                    placeholder="–î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–∏–≥–≥–µ—Ä..."
                                />
                                <button className="nav-btn" onClick={addCustomTrigger}>–î–æ–±–∞–≤–∏—Ç—å</button>
                            </div>
                        </div>
                        <div className="form-group">
                            <label className="form-label">–ó–∞–º–µ—Ç–∫–∏</label>
                            <textarea className="form-textarea" value={note} onChange={(e) => setNote(e.target.value)}></textarea>
                        </div>
                        <div style={{ display: 'flex', gap: '10px', marginTop: '20px' }}>
                            <button className="action-btn" onClick={handleSave}>üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                            <button className="nav-btn" onClick={onCancel}>‚ùå –û—Ç–º–µ–Ω–∞</button>
                        </div>
                    </div>
                </>
            );
        }
        function Analytics({ entries, filterTags, setFilterTags }) {
            const allTriggers = [...new Set(entries.flatMap(e => e.triggers || []))];
            const filteredEntries = filterTags.length > 0
                ? entries.filter(e => e.triggers?.some(trigger => filterTags.includes(trigger)))
                : entries;
            const toggleFilterTag = (tag) => {
                if (filterTags.includes(tag)) {
                    setFilterTags(filterTags.filter(t => t !== tag));
                } else {
                    setFilterTags([...filterTags, tag]);
                }
            };
            const timeOfDayData = () => {
                const hours = {};
                for (let i = 0; i < 24; i++) hours[i] = 0;
                filteredEntries.forEach(e => {
                    const hour = parseInt(e.time.split(':')[0]);
                    hours[hour]++;
                });
                const timeRanges = {
                    '–ù–æ—á—å (00-06)': [0,1,2,3,4,5],
                    '–£—Ç—Ä–æ (06-12)': [6,7,8,9,10,11],
                    '–î–µ–Ω—å (12-18)': [12,13,14,15,16,17],
                    '–í–µ—á–µ—Ä (18-24)': [18,19,20,21,22,23]
                };
                return Object.entries(timeRanges).map(([label, hourRange]) => ({
                    label,
                    value: hourRange.reduce((sum, h) => sum + hours[h], 0)
                }));
            };
            const dayOfWeekData = () => {
                const days = ['–í—Å', '–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±'];
                const counts = [0, 0, 0, 0, 0, 0, 0];
                filteredEntries.forEach(e => {
                    const date = new Date(e.date + 'T00:00:00');
                    counts[date.getDay()]++;
                });
                return days.map((day, idx) => ({ label: day, value: counts[idx] }));
            };
            const triggerStats = () => {
                const triggerCounts = {};
                filteredEntries.forEach(e => {
                    (e.triggers || []).forEach(trigger => {
                        triggerCounts[trigger] = (triggerCounts[trigger] || 0) + 1;
                    });
                });
                return Object.entries(triggerCounts)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 10)
                    .map(([trigger, count]) => ({ label: trigger, value: count }));
            };
            const moodStats = () => {
                const moodCounts = {};
                filteredEntries.forEach(e => {
                    if (e.mood) {
                        moodCounts[e.mood] = (moodCounts[e.mood] || 0) + 1;
                    }
                });
                return Object.entries(moodCounts)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 10)
                    .map(([mood, count]) => ({ label: mood, value: count }));
            };
            const periodComparison = () => {
                const now = new Date();
                const thisMonthStart = formatLocalDate(new Date(now.getFullYear(), now.getMonth(), 1));
                const lastMonthStart = formatLocalDate(new Date(now.getFullYear(), now.getMonth() - 1, 1));
                const lastMonthEnd = formatLocalDate(new Date(now.getFullYear(), now.getMonth(), 0));
                const thisMonth = entries.filter(e => e.date >= thisMonthStart).length;
                const lastMonth = entries.filter(e => e.date >= lastMonthStart && e.date <= lastMonthEnd).length;
                const diff = thisMonth - lastMonth;
                const percent = lastMonth > 0 ? ((diff / lastMonth) * 100).toFixed(0) : 0;
                return { thisMonth, lastMonth, diff, percent };
            };
            const monthlyData = () => {
                const months = {};
                filteredEntries.forEach(e => {
                    const monthKey = e.date.slice(0, 7);
                    months[monthKey] = (months[monthKey] || 0) + 1;
                });
                const sortedMonths = Object.keys(months).sort();
                return {
                    labels: sortedMonths.map(m => {
                        const [, month] = m.split('-');
                        return new Date(2000, parseInt(month) - 1).toLocaleString('ru-RU', { month: 'short' });
                    }),
                    values: sortedMonths.map(m => months[m])
                };
            };
            const getTriggerDayHeatmap = () => {
                const topTriggers = triggerStats().slice(0, 5);
                const days = ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–í—Å'];
                const heatmapData = {};
                topTriggers.forEach(t => {
                    heatmapData[t.label] = [0, 0, 0, 0, 0, 0, 0];
                });
                filteredEntries.forEach(e => {
                    const date = new Date(e.date + 'T00:00:00');
                    const dayIndex = (date.getDay() + 6) % 7;
                    (e.triggers || []).forEach(trigger => {
                        if (heatmapData[trigger]) {
                            heatmapData[trigger][dayIndex]++;
                        }
                    });
                });
                return { topTriggers: topTriggers.map(t => t.label), days, data: heatmapData };
            };
            const getWeeklyTrend = () => {
                const weeks = {};
                filteredEntries.forEach(e => {
                    const date = parseLocalDate(e.date);
                    const weekStart = new Date(date);
                    weekStart.setDate(date.getDate() - date.getDay());
                    const weekKey = formatLocalDate(weekStart);
                    weeks[weekKey] = (weeks[weekKey] || 0) + 1;
                });
                const sortedWeeks = Object.keys(weeks).sort().slice(-8);
                return {
                    labels: sortedWeeks.map((w, i) => `–ù–µ–¥ ${i + 1}`),
                    values: sortedWeeks.map(w => weeks[w])
                };
            };
            const getPrediction = () => {
                const last4Weeks = filteredEntries.filter(e => {
                    const fourWeeksAgo = new Date(Date.now() - 28 * 24 * 60 * 60 * 1000);
                    return parseLocalDate(e.date) >= fourWeeksAgo;
                });
                const avgPerWeek = last4Weeks.length / 4;
                const predicted = Math.round(avgPerWeek);
                return predicted;
            };
            const chartRef = useRef(null);
            const durationChartRef = useRef(null);
            const weeklyTrendRef = useRef(null);
            useEffect(() => {
                if (chartRef.current) {
                    const ctx = chartRef.current.getContext('2d');
                    const { labels, values } = monthlyData();
                    new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: labels,
                            datasets: [{
                                label: '–ß–∞—Å—Ç–æ—Ç–∞ –º–∞—Å—Ç—É—Ä–±–∞—Ü–∏–∏ –ø–æ –º–µ—Å—è—Ü–∞–º',
                                data: values,
                                borderColor: 'var(--accent)',
                                backgroundColor: 'rgba(255, 107, 157, 0.2)',
                                fill: true,
                                tension: 0.4
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    grid: { color: 'var(--border)' },
                                    ticks: { color: 'var(--text-secondary)' }
                                },
                                x: {
                                    grid: { color: 'var(--border)' },
                                    ticks: { color: 'var(--text-secondary)' }
                                }
                            },
                            plugins: {
                                legend: { labels: { color: 'var(--text-primary)' } }
                            }
                        }
                    });
                }
                if (durationChartRef.current) {
                    const ctx = durationChartRef.current.getContext('2d');
                    const durations = filteredEntries.slice(-20).map(e => e.duration || 0);
                    new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: durations.map((_, i) => i + 1),
                            datasets: [{
                                label: '–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–µ—Å—Å–∏–π (–º–∏–Ω)',
                                data: durations,
                                backgroundColor: 'rgba(255, 107, 157, 0.5)',
                                borderColor: 'var(--accent)',
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    grid: { color: 'var(--border)' },
                                    ticks: { color: 'var(--text-secondary)' }
                                },
                                x: {
                                    grid: { color: 'var(--border)' },
                                    ticks: { color: 'var(--text-secondary)' }
                                }
                            },
                            plugins: {
                                legend: { labels: { color: 'var(--text-primary)' } }
                            }
                        }
                    });
                }
                if (weeklyTrendRef.current) {
                    const ctx = weeklyTrendRef.current.getContext('2d');
                    const { labels, values } = getWeeklyTrend();
                    new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: labels,
                            datasets: [{
                                label: '–¢—Ä–µ–Ω–¥ –ø–æ –Ω–µ–¥–µ–ª—è–º',
                                data: values,
                                borderColor: 'var(--chart-2)',
                                backgroundColor: 'rgba(107, 141, 255, 0.2)',
                                fill: true,
                                tension: 0.4
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    grid: { color: 'var(--border)' },
                                    ticks: { color: 'var(--text-secondary)' }
                                },
                                x: {
                                    grid: { color: 'var(--border)' },
                                    ticks: { color: 'var(--text-secondary)' }
                                }
                            },
                            plugins: {
                                legend: { labels: { color: 'var(--text-primary)' } }
                            }
                        }
                    });
                }
            }, [filteredEntries]);
            const timeData = timeOfDayData();
            const dayData = dayOfWeekData();
            const triggers = triggerStats();
            const moods = moodStats();
            const comparison = periodComparison();
            const maxTime = Math.max(...timeData.map(d => d.value), 1);
            const maxDay = Math.max(...dayData.map(d => d.value), 1);
            const maxTrigger = Math.max(...triggers.map(d => d.value), 1);
            const maxMood = Math.max(...moods.map(d => d.value), 1);
            const totalDuration = filteredEntries.reduce((sum, e) => sum + (e.duration || 0), 0);
            const avgDuration = filteredEntries.length > 0 ? Math.round(totalDuration / filteredEntries.length) : 0;
            const orgasmRate = filteredEntries.length > 0 ? Math.round((filteredEntries.filter(e => e.orgasm).length / filteredEntries.length) * 100) : 0;
            const contentRate = filteredEntries.length > 0 ? Math.round((filteredEntries.filter(e => e.contentUsed).length / filteredEntries.length) * 100) : 0;
            const avgArousal = filteredEntries.length > 0 
                ? filteredEntries.reduce((sum, e) => sum + (e.arousalLevel || 5), 0) / filteredEntries.length 
                : 0;
            const triggerHeatmap = getTriggerDayHeatmap();
            const prediction = getPrediction();
            const insights = [];
            const topTime = timeData.reduce((a, b) => a.value > b.value ? a : b);
            if (topTime.value > 0) {
                insights.push({
                    icon: '‚è∞',
                    title: '–ü–∏–∫–æ–≤–æ–µ –≤—Ä–µ–º—è',
                    desc: `${topTime.label} ‚Äî ${((topTime.value / filteredEntries.length) * 100).toFixed(0)}% —Ç–≤–æ–∏—Ö —Å–µ—Å—Å–∏–π`
                });
            }
            const topDay = dayData.reduce((a, b) => a.value > b.value ? a : b);
            if (topDay.value > 0) {
                insights.push({
                    icon: 'üìÖ',
                    title: '–°–∞–º—ã–π –∞–∫—Ç–∏–≤–Ω—ã–π –¥–µ–Ω—å',
                    desc: `${topDay.label} ‚Äî ${topDay.value} –∑–∞–ø–∏—Å–µ–π`
                });
            }
            if (triggers.length > 0) {
                insights.push({
                    icon: 'üéØ',
                    title: '–ì–ª–∞–≤–Ω—ã–π —Ç—Ä–∏–≥–≥–µ—Ä',
                    desc: `${triggers[0].label} ‚Äî ${((triggers[0].value / filteredEntries.length) * 100).toFixed(0)}% –∑–∞–ø–∏—Å–µ–π`
                });
            }
            if (comparison.percent < 0) {
                insights.push({
                    icon: 'üìâ',
                    title: '–ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–∞—è –¥–∏–Ω–∞–º–∏–∫–∞',
                    desc: `–≠—Ç–æ—Ç –º–µ—Å—è—Ü: ${comparison.thisMonth} –∑–∞–ø–∏—Å–µ–π (${Math.abs(comparison.percent)}% –º–µ–Ω—å—à–µ)`
                });
            } else if (comparison.percent > 0) {
                insights.push({
                    icon: 'üìà',
                    title: '–†–æ—Å—Ç –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏',
                    desc: `–≠—Ç–æ—Ç –º–µ—Å—è—Ü: ${comparison.thisMonth} –∑–∞–ø–∏—Å–µ–π (+${comparison.percent}%)`
                });
            }
            if (prediction > 0) {
                insights.push({
                    icon: 'üîÆ',
                    title: '–ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ –Ω–µ–¥–µ–ª—é',
                    desc: `–ù–∞ –æ—Å–Ω–æ–≤–µ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 4 –Ω–µ–¥–µ–ª—å, –æ–∂–∏–¥–∞–µ—Ç—Å—è ~${prediction} —Å–µ—Å—Å–∏–π`
                });
            }
            return (
                <div className="fade-in">
                    <h2 className="section-title">üìä –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –º–∞—Å—Ç—É—Ä–±–∞—Ü–∏–∏</h2>
                    {allTriggers.length > 0 && (
                        <div style={{ marginBottom: '30px' }}>
                            <div className="form-label" style={{ marginBottom: '10px' }}>–§–∏–ª—å—Ç—Ä –ø–æ —Ç—Ä–∏–≥–≥–µ—Ä–∞–º</div>
                            <div className="filter-tags">
                                {allTriggers.map(trigger => (
                                    <button
                                        key={trigger}
                                        className={`filter-tag ${filterTags.includes(trigger) ? 'active' : ''}`}
                                        onClick={() => toggleFilterTag(trigger)}
                                    >
                                        {trigger}
                                    </button>
                                ))}
                            </div>
                            {filterTags.length > 0 && (
                                <div style={{ marginTop: '10px', fontSize: '13px', color: 'var(--text-tertiary)' }}>
                                    –ü–æ–∫–∞–∑–∞–Ω–æ —Å–µ—Å—Å–∏–π: {filteredEntries.length} –∏–∑ {entries.length}
                                </div>
                            )}
                        </div>
                    )}
                    <div className="quick-stats">
                        <div className="quick-stat">
                            <div className="quick-stat-value">{avgDuration}</div>
                            <div className="quick-stat-label">–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è (–º–∏–Ω)</div>
                        </div>
                        <div className="quick-stat">
                            <div className="quick-stat-value">{orgasmRate}%</div>
                            <div className="quick-stat-label">–î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ –æ—Ä–≥–∞–∑–º–∞</div>
                        </div>
                        <div className="quick-stat">
                            <div className="quick-stat-value">{contentRate}%</div>
                            <div className="quick-stat-label">–° –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º</div>
                        </div>
                        <div className="quick-stat">
                            <div className="quick-stat-value">{avgArousal.toFixed(1)}</div>
                            <div className="quick-stat-label">–°—Ä–µ–¥–Ω–µ–µ –≤–æ–∑–±—É–∂–¥–µ–Ω–∏–µ</div>
                        </div>
                    </div>
                    {prediction > 0 && (
                        <div className="prediction-card">
                            <h3 className="section-title">üîÆ –ü—Ä–æ–≥–Ω–æ–∑ –∏ —Ç—Ä–µ–Ω–¥—ã</h3>
                            <div className="prediction-item">
                                <div className="comparison-label">–ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ —ç—Ç—É –Ω–µ–¥–µ–ª—é</div>
                                <div className="comparison-value" style={{ color: 'var(--chart-2)' }}>~{prediction}</div>
                            </div>
                            <div className="prediction-item">
                                <div className="comparison-label">–°—Ä–µ–¥–Ω—è—è —á–∞—Å—Ç–æ—Ç–∞ (4 –Ω–µ–¥–µ–ª–∏)</div>
                                <div className="comparison-value" style={{ color: 'var(--chart-3)' }}>{(prediction).toFixed(1)}/–Ω–µ–¥</div>
                            </div>
                        </div>
                    )}
                    {insights.length > 0 && (
                        <div className="insights-card">
                            <h3 className="section-title">üí° –ò–Ω—Å–∞–π—Ç—ã –∏ –ø–∞—Ç—Ç–µ—Ä–Ω—ã</h3>
                            {insights.map((insight, idx) => (
                                <div key={idx} className="insight-item">
                                    <div className="insight-icon">{insight.icon}</div>
                                    <div className="insight-text">
                                        <div className="insight-title">{insight.title}</div>
                                        <div className="insight-desc">{insight.desc}</div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}
                    <div className="comparison-card">
                        <h3 className="section-title">–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –º–µ—Å—è—Ü–µ–≤</h3>
                        <div className="comparison-item">
                            <div className="comparison-label">–≠—Ç–æ—Ç –º–µ—Å—è—Ü</div>
                            <div className="comparison-value">{comparison.thisMonth}</div>
                        </div>
                        <div className="comparison-item">
                            <div className="comparison-label">–ü—Ä–æ—à–ª—ã–π –º–µ—Å—è—Ü</div>
                            <div className="comparison-value">{comparison.lastMonth}</div>
                        </div>
                        <div className="comparison-item">
                            <div className="comparison-label">–ò–∑–º–µ–Ω–µ–Ω–∏–µ</div>
                            <div className={`comparison-value ${comparison.diff < 0 ? 'positive' : comparison.diff > 0 ? 'negative' : ''}`}>
                                {comparison.diff > 0 ? '+' : ''}{comparison.diff} ({comparison.percent > 0 ? '+' : ''}{comparison.percent}%)
                            </div>
                        </div>
                    </div>
                    {triggerHeatmap.topTriggers.length > 0 && (
                        <div className="trigger-heatmap">
                            <h3 className="section-title">üóìÔ∏è –¢—Ä–∏–≥–≥–µ—Ä—ã –ø–æ –¥–Ω—è–º –Ω–µ–¥–µ–ª–∏</h3>
                            <div className="trigger-heatmap-grid">
                                <div></div>
                                {triggerHeatmap.days.map(day => (
                                    <div key={day} className="trigger-heatmap-label">{day}</div>
                                ))}
                                {triggerHeatmap.topTriggers.map(trigger => (
                                    <React.Fragment key={trigger}>
                                        <div className="trigger-heatmap-label" style={{ textAlign: 'left', minWidth: '100px' }}>{trigger}</div>
                                        {triggerHeatmap.data[trigger].map((count, idx) => {
                                            const maxCount = Math.max(...triggerHeatmap.data[trigger]);
                                            const intensity = maxCount > 0 ? count / maxCount : 0;
                                            const bgColor = intensity === 0 ? 'var(--bg-tertiary)' : `rgba(255, 107, 157, ${0.2 + intensity * 0.7})`;
                                            return (
                                                <div key={idx} className="trigger-heatmap-cell" style={{ background: bgColor }}>
                                                    {count > 0 ? count : ''}
                                                </div>
                                            );
                                        })}
                                    </React.Fragment>
                                ))}
                            </div>
                        </div>
                    )}
                    <div className="analytics-grid">
                        <div className="analytics-card">
                            <h3>üìà –ß–∞—Å—Ç–æ—Ç–∞ –ø–æ –º–µ—Å—è—Ü–∞–º</h3>
                            <div style={{ height: '200px' }}>
                                <canvas ref={chartRef}></canvas>
                            </div>
                        </div>
                        <div className="analytics-card">
                            <h3>üìä –¢—Ä–µ–Ω–¥ –ø–æ –Ω–µ–¥–µ–ª—è–º</h3>
                            <div style={{ height: '200px' }}>
                                <canvas ref={weeklyTrendRef}></canvas>
                            </div>
                        </div>
                    </div>
                    <div className="analytics-grid">
                        <div className="analytics-card">
                            <h3>‚è±Ô∏è –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–µ—Å—Å–∏–π</h3>
                            <div style={{ height: '200px' }}>
                                <canvas ref={durationChartRef}></canvas>
                            </div>
                        </div>
                    </div>
                    <div className="analytics-grid">
                        <div className="analytics-card">
                            <h3>‚è∞ –í—Ä–µ–º—è —Å—É—Ç–æ–∫</h3>
                            <div className="bar-chart">
                                {timeData.map(item => (
                                    <div key={item.label} className="bar-item">
                                        <div className="bar-label">{item.label}</div>
                                        <div className="bar-visual">
                                            <div className="bar-fill" style={{ width: `${(item.value / maxTime) * 100}%` }}></div>
                                        </div>
                                        <div className="bar-value">{item.value}</div>
                                    </div>
                                ))}
                            </div>
                        </div>
                        <div className="analytics-card">
                            <h3>üìÖ –î–Ω–∏ –Ω–µ–¥–µ–ª–∏</h3>
                            <div className="bar-chart">
                                {dayData.map(item => (
                                    <div key={item.label} className="bar-item">
                                        <div className="bar-label">{item.label}</div>
                                        <div className="bar-visual">
                                            <div className="bar-fill" style={{ width: `${(item.value / maxDay) * 100}%` }}></div>
                                        </div>
                                        <div className="bar-value">{item.value}</div>
                                    </div>
                                ))}
                            </div>
                        </div>
                        {triggers.length > 0 && (
                            <div className="analytics-card">
                                <h3>üéØ –¢–æ–ø —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤</h3>
                                <div className="bar-chart">
                                    {triggers.map(item => (
                                        <div key={item.label} className="bar-item">
                                            <div className="bar-label" style={{ minWidth: '120px', fontSize: '12px' }}>{item.label}</div>
                                            <div className="bar-visual">
                                                <div className="bar-fill" style={{ width: `${(item.value / maxTrigger) * 100}%` }}></div>
                                            </div>
                                            <div className="bar-value">{item.value}</div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}
                        {moods.length > 0 && (
                            <div className="analytics-card">
                                <h3>üòä –¢–æ–ø –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–π –ø–æ—Å–ª–µ</h3>
                                <div className="bar-chart">
                                    {moods.map(item => (
                                        <div key={item.label} className="bar-item">
                                            <div className="bar-label" style={{ minWidth: '120px', fontSize: '12px' }}>{item.label}</div>
                                            <div className="bar-visual">
                                                <div className="bar-fill" style={{ width: `${(item.value / maxMood) * 100}%` }}></div>
                                            </div>
                                            <div className="bar-value">{item.value}</div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }
        function History({ entries, onDeleteEntry, onEditEntry, editingEntry, setEditingEntry, filterTags, setFilterTags }) {
            const allTriggers = [...new Set(entries.flatMap(e => e.triggers || []))];
            const filteredEntries = filterTags.length > 0
                ? entries.filter(e => e.triggers?.some(trigger => filterTags.includes(trigger)))
                : entries;
            const sortedEntries = [...filteredEntries].sort((a, b) => {
                const dateA = new Date(a.date + 'T' + a.time);
                const dateB = new Date(b.date + 'T' + b.time);
                return dateB - dateA;
            });
            const toggleFilterTag = (tag) => {
                if (filterTags.includes(tag)) {
                    setFilterTags(filterTags.filter(t => t !== tag));
                } else {
                    setFilterTags([...filterTags, tag]);
                }
            };
            return (
                <div className="fade-in">
                    <h2 className="section-title">üìù –ò—Å—Ç–æ—Ä–∏—è –º–∞—Å—Ç—É—Ä–±–∞—Ü–∏–∏ ({filteredEntries.length} –∑–∞–ø–∏—Å–µ–π)</h2>
                    {allTriggers.length > 0 && (
                        <div style={{ marginBottom: '30px' }}>
                            <div className="form-label" style={{ marginBottom: '10px' }}>–§–∏–ª—å—Ç—Ä –ø–æ —Ç—Ä–∏–≥–≥–µ—Ä–∞–º</div>
                            <div className="filter-tags">
                                {allTriggers.map(trigger => (
                                    <button
                                        key={trigger}
                                        className={`filter-tag ${filterTags.includes(trigger) ? 'active' : ''}`}
                                        onClick={() => toggleFilterTag(trigger)}
                                    >
                                        {trigger}
                                    </button>
                                ))}
                            </div>
                        </div>
                    )}
                    {sortedEntries.length === 0 && (
                        <div style={{ textAlign: 'center', padding: '60px 20px', color: 'var(--text-tertiary)' }}>
                            {filterTags.length > 0 ? '–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º–∏ —Ç—Ä–∏–≥–≥–µ—Ä–∞–º–∏' : '–ó–∞–ø–∏—Å–µ–π –ø–æ–∫–∞ –Ω–µ—Ç'}
                        </div>
                    )}
                    {sortedEntries.map(entry => (
                        <div key={entry.id} className="history-item" onClick={() => setEditingEntry(entry)}>
                            <div className="history-header">
                                <div className="history-date">{parseLocalDate(entry.date).toLocaleDateString('ru-RU', { day: 'numeric', month: 'long', year: 'numeric' })}</div>
                                <div className="history-time">‚è∞ {entry.time}</div>
                            </div>
                            <div className="history-details">
                                <span className="history-badge">–ú–∞—Å—Ç—É—Ä–±–∞—Ü–∏—è</span>
                                {entry.triggers && entry.triggers.length > 0 && entry.triggers.map(trigger => (
                                    <span key={trigger} className="history-badge">{trigger}</span>
                                ))}
                            </div>
                            {entry.mood && <div className="history-field">–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –ø–æ—Å–ª–µ: {entry.mood}</div>}
                            <div className="history-field">–í–æ–∑–±—É–∂–¥–µ–Ω–∏–µ –ø–µ—Ä–µ–¥: {entry.arousalLevel}/10</div>
                            <div className="history-field">–ú–µ—Å—Ç–æ: {entry.location}</div>
                            <div className="history-field">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: {entry.duration} –º–∏–Ω</div>
                            <div className="history-field">–ö–æ–Ω—Ç–µ–Ω—Ç: {entry.contentUsed ? '–î–∞' : '–ù–µ—Ç'}</div>
                            <div className="history-field">–û—Ä–≥–∞–∑–º: {entry.orgasm ? '–î–∞' : '–ù–µ—Ç'}</div>
                            {entry.note && <div className="history-field">–ó–∞–º–µ—Ç–∫–∏: {entry.note}</div>}
                            <div style={{ marginTop: '10px', display: 'flex', gap: '10px' }}>
                                <button className="edit-btn" onClick={(e) => { e.stopPropagation(); setEditingEntry(entry); }}>
                                    ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                                </button>
                                <button className="delete-btn" style={{ padding: '8px 16px', fontSize: '12px' }} onClick={(e) => {
                                    e.stopPropagation();
                                    if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –∑–∞–ø–∏—Å—å –æ –º–∞—Å—Ç—É—Ä–±–∞—Ü–∏–∏?')) onDeleteEntry(entry.id);
                                }}>
                                    üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                                </button>
                            </div>
                        </div>
                    ))}
                </div>
            );
        }
        function Calendar({ entries }) {
            const [currentDate, setCurrentDate] = useState(new Date());
            const [showModal, setShowModal] = useState(false);
            const [selectedDay, setSelectedDay] = useState(null);
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            const monthName = currentDate.toLocaleDateString('ru-RU', { month: 'long', year: 'numeric' });
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startDayOfWeek = firstDay.getDay();
            const weekDays = ['–í—Å', '–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±'];
            const calendarDays = [];
            for (let i = 0; i < startDayOfWeek; i++) {
                calendarDays.push({ isEmpty: true, key: `empty-${i}` });
            }
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month, day);
                const dateStr = formatLocalDate(date);
                const dayEntries = entries.filter(e => e.date === dateStr);
                let activityLevel = '';
                if (dayEntries.length > 0) {
                    if (dayEntries.length === 1) activityLevel = 'low';
                    else if (dayEntries.length === 2) activityLevel = 'medium';
                    else activityLevel = 'high';
                }
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                const isToday = date.getTime() === today.getTime();
                calendarDays.push({
                    day,
                    date,
                    dateStr,
                    entries: dayEntries,
                    activityLevel,
                    isToday,
                    isEmpty: false,
                    key: `day-${day}`
                });
            }
            const handleDayClick = (date, dayEntries) => {
                if (dayEntries.length > 0) {
                    setSelectedDay({ date, entries: dayEntries });
                    setShowModal(true);
                }
            };
            const yearlyData = [];
            const startOfYear = new Date(year, 0, 1);
            const endOfYear = new Date(year, 11, 31);
            let currentWeek = [];
            let weekStartDay = startOfYear.getDay();
            for (let i = 0; i < weekStartDay; i++) {
                currentWeek.push(null);
            }
            for (let d = new Date(startOfYear); d <= endOfYear; d.setDate(d.getDate() + 1)) {
                const dateStr = formatLocalDate(d);
                const dayEntries = entries.filter(e => e.date === dateStr);
                currentWeek.push({
                    date: new Date(d),
                    count: dayEntries.length
                });
                if (currentWeek.length === 7) {
                    yearlyData.push(currentWeek);
                    currentWeek = [];
                }
            }
            if (currentWeek.length > 0) {
                while (currentWeek.length < 7) {
                    currentWeek.push(null);
                }
                yearlyData.push(currentWeek);
            }
            const months = ['–Ø–Ω–≤', '–§–µ–≤', '–ú–∞—Ä', '–ê–ø—Ä', '–ú–∞–π', '–ò—é–Ω', '–ò—é–ª', '–ê–≤–≥', '–°–µ–Ω', '–û–∫—Ç', '–ù–æ—è', '–î–µ–∫'];
            return (
                <div className="fade-in">
                    <h2 className="section-title">üìÖ –ö–∞–ª–µ–Ω–¥–∞—Ä—å –º–∞—Å—Ç—É—Ä–±–∞—Ü–∏–∏</h2>
                    <div className="heatmap-container">
                        <h3 style={{ marginBottom: '20px', fontSize: '16px', fontWeight: '600' }}>üî• –ö–∞—Ä—Ç–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ {year} –≥–æ–¥–∞</h3>
                        <div className="heatmap-grid">
                            {months.map(month => <div key={month} className="heatmap-month-label">{month}</div>)}
                            {months.map(() => <div key={Math.random()}></div>)}
                            {yearlyData.map((week, weekIdx) => (
                                <React.Fragment key={weekIdx}>
                                    {weekIdx === 0 && <div></div>}
                                    {week.map((day, dayIdx) => (
                                        day === null ? <div key={`${weekIdx}-${dayIdx}`}></div> :
                                        <div key={`${weekIdx}-${dayIdx}`} className={`heatmap-cell ${day.count === 0 ? '' : `level-${Math.min(day.count, 4)}`}`} title={`${day.date.toLocaleDateString('ru-RU')}: ${day.count} —Å–µ—Å—Å–∏–π –º–∞—Å—Ç—É—Ä–±–∞—Ü–∏–∏`}></div>
                                    ))}
                                </React.Fragment>
                            ))}
                        </div>
                    </div>
                    <div className="calendar-container">
                        <div className="calendar-header">
                            <div className="calendar-month">{monthName}</div>
                            <div style={{ display: 'flex', gap: '10px', flexWrap: 'wrap' }}>
                                <button className="calendar-nav-btn" onClick={() => setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() - 1, 1))}>‚Üê –ù–∞–∑–∞–¥</button>
                                <button className="calendar-nav-btn" onClick={() => setCurrentDate(new Date())}>–°–µ–≥–æ–¥–Ω—è</button>
                                <button className="calendar-nav-btn" onClick={() => setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 1))}>–í–ø–µ—Ä—ë–¥ ‚Üí</button>
                            </div>
                        </div>
                        <div className="calendar-grid">
                            {weekDays.map(day => <div key={day} className="calendar-day-label">{day}</div>)}
                        </div>
                        <div className="calendar-grid">
                            {calendarDays.map(dayInfo => {
                                if (dayInfo.isEmpty) {
                                    return <div key={dayInfo.key} className="calendar-day empty"></div>;
                                }
                                return (
                                    <div key={dayInfo.key} className={`calendar-day ${dayInfo.activityLevel} ${dayInfo.isToday ? 'today' : ''}`} onClick={() => handleDayClick(dayInfo.date, dayInfo.entries)}>
                                        <div className="calendar-day-number">{dayInfo.day}</div>
                                        {dayInfo.entries.length > 0 && <div className="calendar-day-count">{dayInfo.entries.length}</div>}
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                    {showModal && selectedDay && (
                        <>
                            <div className="modal-overlay" onClick={() => setShowModal(false)}></div>
                            <div className="day-detail-modal">
                                <div className="modal-header">
                                    <div className="modal-title">{selectedDay.date.toLocaleDateString('ru-RU', { day: 'numeric', month: 'long', year: 'numeric' })}</div>
                                    <button className="modal-close" onClick={() => setShowModal(false)}>√ó</button>
                                </div>
                                <div style={{ marginBottom: '15px', color: 'var(--text-secondary)' }}>
                                    –°–µ—Å—Å–∏–π –º–∞—Å—Ç—É—Ä–±–∞—Ü–∏–∏: {selectedDay.entries.length}
                                </div>
                                {selectedDay.entries.map(entry => (
                                    <div key={entry.id} className="modal-entry">
                                        <div className="modal-entry-time">‚è∞ {entry.time}</div>
                                        <div className="history-details">
                                            <span className="history-badge">–ú–∞—Å—Ç—É—Ä–±–∞—Ü–∏—è</span>
                                            {entry.triggers && entry.triggers.length > 0 && entry.triggers.map(trigger => (
                                                <span key={trigger} className="history-badge">{trigger}</span>
                                            ))}
                                        </div>
                                        {entry.mood && <div className="history-field">–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ: {entry.mood}</div>}
                                        <div className="history-field">–í–æ–∑–±—É–∂–¥–µ–Ω–∏–µ: {entry.arousalLevel}/10</div>
                                        <div className="history-field">–ú–µ—Å—Ç–æ: {entry.location}</div>
                                        <div className="history-field">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: {entry.duration} –º–∏–Ω</div>
                                        <div className="history-field">–ö–æ–Ω—Ç–µ–Ω—Ç: {entry.contentUsed ? '–î–∞' : '–ù–µ—Ç'}</div>
                                        <div className="history-field">–û—Ä–≥–∞–∑–º: {entry.orgasm ? '–î–∞' : '–ù–µ—Ç'}</div>
                                        {entry.note && <div className="history-field">–ó–∞–º–µ—Ç–∫–∏: {entry.note}</div>}
                                    </div>
                                ))}
                            </div>
                        </>
                    )}
                </div>
            );
        }
        function Achievements({ entries, unlockedAchievements, userSettings, getStreak }) {
            const streak = getStreak();
            const calculateProgress = (achievementId) => {
                switch(achievementId) {
                    case 'first_entry':
                        return entries.length >= 1 ? 100 : 0;
                    case 'week_streak':
                        return Math.min((streak / 7) * 100, 100);
                    case 'month_control':
                        const thisMonth = formatLocalDate(new Date()).slice(0, 7);
                        const monthEntries = entries.filter(entry => entry.date.startsWith(thisMonth));
                        return monthEntries.length > 0 ? Math.min((monthEntries.length / userSettings.monthlyLimit) * 100, 100) : 0;
                    case 'two_week_streak':
                        return Math.min((streak / 14) * 100, 100);
                    case 'month_streak':
                        return Math.min((streak / 30) * 100, 100);
                    case 'total_100':
                        return Math.min((entries.length / 100) * 100, 100);
                    case 'low_frequency':
                        const lastWeekEntries = entries.filter(e => {
                            const weekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);
                            return parseLocalDate(e.date) >= weekAgo;
                        });
                        return lastWeekEntries.length <= 1 ? 100 : 50;
                    case 'no_content_week':
                        const lastWeekNoContent = entries.filter(e => {
                            const weekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);
                            return parseLocalDate(e.date) >= weekAgo && !e.contentUsed;
                        });
                        return Math.min((lastWeekNoContent.length / 5) * 100, 100);
                    case 'three_month_streak':
                        return Math.min((streak / 90) * 100, 100);
                    case 'consistent_tracker':
                        let consecutiveDays = 0;
                        const today = new Date();
                        for (let i = 0; i < 30; i++) {
                            const checkDate = new Date(today);
                            checkDate.setDate(checkDate.getDate() - i);
                            const dateStr = formatLocalDate(checkDate);
                            const hasEntry = entries.some(e => e.date === dateStr);
                            if (!hasEntry) break;
                            consecutiveDays++;
                        }
                        return Math.min((consecutiveDays / 30) * 100, 100);
                    case 'early_bird':
                        return 0;
                    case 'night_owl':
                        return 0;
                    default:
                        return 0;
                }
            };
            return (
                <div className="fade-in">
                    <h2 className="section-title">üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è –≤ –∫–æ–Ω—Ç—Ä–æ–ª–µ ({unlockedAchievements.length}/{ACHIEVEMENTS.length})</h2>
                    <div className="achievements-grid">
                        {ACHIEVEMENTS.map(achievement => {
                            const isUnlocked = unlockedAchievements.includes(achievement.id);
                            const progress = calculateProgress(achievement.id);
                            return (
                                <div key={achievement.id} className={`achievement-card ${isUnlocked ? 'unlocked' : 'locked'}`}>
                                    <div className="achievement-icon">{achievement.icon}</div>
                                    <div className="achievement-title">{achievement.title}</div>
                                    <div className="achievement-desc">{achievement.desc}</div>
                                    {!isUnlocked && (
                                        <div className="achievement-progress">
                                            <div className="achievement-progress-bar" style={{ width: `${progress}%` }}></div>
                                        </div>
                                    )}
                                </div>
                            );
                        })}
                    </div>
                </div>
            );
        }
        function Settings({ userSettings, setUserSettings, entries }) {
            const [localSettings, setLocalSettings] = useState(userSettings);
            const handleSave = () => {
                localStorage.setItem('userSettings', JSON.stringify(localSettings));
                setUserSettings(localSettings);
                document.documentElement.setAttribute('data-theme', localSettings.theme);
                showSuccessNotification('üíæ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
            };
            const handleExport = () => {
                const headers = 'id,date,time,type,mood,arousalLevel,location,duration,contentUsed,orgasm,triggers,note\n';
                const rows = entries.map(e => [
                    e.id,
                    e.date,
                    e.time,
                    e.type,
                    e.mood || '',
                    e.arousalLevel,
                    e.location,
                    e.duration,
                    e.contentUsed ? '–î–∞' : '–ù–µ—Ç',
                    e.orgasm ? '–î–∞' : '–ù–µ—Ç',
                    `"${(e.triggers || []).join('; ')}"`,
                    `"${(e.note || '').replace(/"/g, '""')}"`
                ].join(',')).join('\n');
                const csv = headers + rows;
                const dataBlob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `masturbation-tracker-${formatLocalDate(new Date())}.csv`;
                link.click();
                showSuccessNotification('üì• –î–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã');
            };
            const handleReset = () => {
                if (confirm('–í–ù–ò–ú–ê–ù–ò–ï: –£–¥–∞–ª–∏—Ç—å –í–°–ï –¥–∞–Ω–Ω—ã–µ –æ –º–∞—Å—Ç—É—Ä–±–∞—Ü–∏–∏? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!')) {
                    if (confirm('–¢—ã –∞–±—Å–æ–ª—é—Ç–Ω–æ —É–≤–µ—Ä–µ–Ω? –í—Å–µ –∑–∞–ø–∏—Å–∏ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã –Ω–∞–≤—Å–µ–≥–¥–∞.')) {
                        indexedDB.deleteDatabase(DB_NAME);
                        localStorage.clear();
                        window.location.reload();
                    }
                }
            };
            const handleBackup = () => {
                const backup = {
                    entries: entries,
                    settings: userSettings,
                    achievements: JSON.parse(localStorage.getItem('achievements') || '[]'),
                    nofapMode: localStorage.getItem('nofapMode'),
                    nofapStartDate: localStorage.getItem('nofapStartDate'),
                    nofapHistory: JSON.parse(localStorage.getItem('nofapHistory') || '[]'),
                    timestamp: new Date().toISOString()
                };
                const dataStr = JSON.stringify(backup, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `masturbation-tracker-backup-${formatLocalDate(new Date())}.json`;
                link.click();
                showSuccessNotification('üíæ –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è —Å–æ–∑–¥–∞–Ω–∞');
            };
            return (
                <div className="fade-in">
                    <h2 className="section-title">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç—Ä–µ–∫–µ—Ä–∞ –º–∞—Å—Ç—É—Ä–±–∞—Ü–∏–∏</h2>
                    <div className="entry-form">
                        <h3 style={{ marginBottom: '20px', fontSize: '18px' }}>–õ–∏–º–∏—Ç—ã –∏ —Ü–µ–ª–∏</h3>
                        <div className="form-group">
                            <label className="form-label">–õ–∏–º–∏—Ç –≤ –¥–µ–Ω—å: {localSettings.dailyLimit}</label>
                            <input type="range" min="0" max="5" value={localSettings.dailyLimit} onChange={(e) => setLocalSettings({ ...localSettings, dailyLimit: parseInt(e.target.value) })} className="slider" />
                        </div>
                        <div className="form-group">
                            <label className="form-label">–õ–∏–º–∏—Ç –≤ –Ω–µ–¥–µ–ª—é: {localSettings.weeklyLimit}</label>
                            <input type="range" min="0" max="20" value={localSettings.weeklyLimit} onChange={(e) => setLocalSettings({ ...localSettings, weeklyLimit: parseInt(e.target.value) })} className="slider" />
                        </div>
                        <div className="form-group">
                            <label className="form-label">–õ–∏–º–∏—Ç –≤ –º–µ—Å—è—Ü: {localSettings.monthlyLimit}</label>
                            <input type="range" min="0" max="50" value={localSettings.monthlyLimit} onChange={(e) => setLocalSettings({ ...localSettings, monthlyLimit: parseInt(e.target.value) })} className="slider" />
                        </div>
                        <div className="form-group">
                            <label className="form-label">–¶–µ–ª—å NoFap (–¥–Ω–µ–π): {localSettings.goalDays}</label>
                            <input type="range" min="1" max="90" value={localSettings.goalDays} onChange={(e) => setLocalSettings({ ...localSettings, goalDays: parseInt(e.target.value) })} className="slider" />
                        </div>
                        <div className="form-group">
                            <label className="checkbox-label">
                                <input type="checkbox" checked={localSettings.adviceEnabled} onChange={(e) => setLocalSettings({ ...localSettings, adviceEnabled: e.target.checked })} className="checkbox" />
                                –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å–æ–≤–µ—Ç—ã –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
                            </label>
                        </div>
                        <button className="action-btn" onClick={handleSave}>üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
                    </div>
                    <div className="entry-form" style={{ marginTop: '30px' }}>
                        <h3 style={{ marginBottom: '20px', fontSize: '18px' }}>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏</h3>
                        <div style={{ display: 'flex', gap: '15px', flexWrap: 'wrap' }}>
                            <button className="nav-btn" onClick={handleExport}>üì• –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV</button>
                            <button className="nav-btn" onClick={handleBackup}>üíæ –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è</button>
                            <button className="delete-btn" onClick={handleReset}>üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ</button>
                        </div>
                    </div>
                    <div style={{ marginTop: '40px', padding: '20px', background: 'var(--bg-secondary)', borderRadius: '12px', fontSize: '14px', color: 'var(--text-secondary)' }}>
                        <p><strong>üîí –û –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏:</strong></p>
                        <p style={{ marginTop: '10px' }}>–í—Å–µ –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ —Ç–≤–æ—ë–º –±—Ä–∞—É–∑–µ—Ä–µ. –ù–∏—á–µ–≥–æ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä.</p>
                        <p style={{ marginTop: '20px' }}><strong>üéØ –û —Ç—Ä–µ–∫–µ—Ä–µ:</strong></p>
                        <p style={{ marginTop: '10px' }}>–≠—Ç–æ—Ç —Ç—Ä–µ–∫–µ—Ä –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ–≥–æ –æ—Ç–Ω–æ—à–µ–Ω–∏—è –∫ —Å–≤–æ–µ–π —Å–µ–∫—Å—É–∞–ª—å–Ω–æ—Å—Ç–∏ –∏ –∫–æ–Ω—Ç—Ä–æ–ª—è –Ω–∞–¥ –ø—Ä–∏–≤—ã—á–∫–∞–º–∏.</p>
                        <p style={{ marginTop: '5px' }}><strong></strong></p>
                        <ul style={{ marginTop: '10px', paddingLeft: '20px' }}>
                          
                        </ul>
                    </div>
                </div>
            );
        }
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
